/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.insert_order_with_items;

import static typr.runtime.Fragment.interpolate;

import java.math.BigDecimal;
import java.sql.Connection;
import java.time.LocalDate;
import java.util.Optional;
import testdb.customers.CustomersId;
import typr.runtime.DuckDbTypes;
import typr.runtime.Fragment;

public class InsertOrderWithItemsSqlRepoImpl implements InsertOrderWithItemsSqlRepo {
  @Override
  public Integer apply(
      Integer orderId,
      /* user-picked */ CustomersId customerId,
      Optional<LocalDate> orderDate,
      Optional<BigDecimal> totalAmount,
      Optional<String> status,
      Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Insert a new order and return the generated data\n"
                    + "-- Tests: INSERT with RETURNING, multiple columns, foreign keys, DEFAULT"
                    + " values\n\n"
                    + "INSERT INTO orders (order_id, customer_id, order_date, total_amount,"
                    + " status)\n"
                    + "VALUES (\n"
                    + "    CAST("),
            Fragment.encode(DuckDbTypes.integer, orderId),
            Fragment.lit(" AS INTEGER),\n    CAST("),
            Fragment.encode(CustomersId.duckDbType, customerId),
            Fragment.lit(" AS INTEGER),\n    CAST("),
            Fragment.encode(DuckDbTypes.date.opt(), orderDate),
            Fragment.lit(" AS DATE),\n    CAST("),
            Fragment.encode(DuckDbTypes.numeric.opt(), totalAmount),
            Fragment.lit(" AS DECIMAL),\n    CAST("),
            Fragment.encode(DuckDbTypes.text.opt(), status),
            Fragment.lit(
                " AS VARCHAR)\n"
                    + ")\n"
                    + "RETURNING\n"
                    + "    order_id,\n"
                    + "    customer_id,\n"
                    + "    order_date,\n"
                    + "    total_amount,\n"
                    + "    status"))
        .update()
        .runUnchecked(c);
  }
  ;
}
