/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.order_items_bulk_insert;

import static typr.runtime.Fragment.interpolate;

import java.math.BigDecimal;
import java.sql.Connection;
import testdb.orders.OrdersId;
import testdb.products.ProductsId;
import typr.runtime.DuckDbTypes;
import typr.runtime.Fragment;

public class OrderItemsBulkInsertSqlRepoImpl implements OrderItemsBulkInsertSqlRepo {
  @Override
  public Integer apply(
      /* user-picked */ OrdersId orderId,
      /* user-picked */ ProductsId productId,
      Integer quantity,
      BigDecimal unitPrice,
      Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Insert order items with composite key handling\n"
                    + "-- Tests: composite primary key in INSERT, foreign key types, RETURNING with"
                    + " composite key\n\n"
                    + "INSERT INTO order_items (order_id, product_id, quantity, unit_price)\n"
                    + "VALUES (\n"
                    + "    CAST("),
            Fragment.encode(OrdersId.duckDbType, orderId),
            Fragment.lit(" AS INTEGER),\n    CAST("),
            Fragment.encode(ProductsId.duckDbType, productId),
            Fragment.lit(" AS INTEGER),\n    CAST("),
            Fragment.encode(DuckDbTypes.integer, quantity),
            Fragment.lit(" AS INTEGER),\n    CAST("),
            Fragment.encode(DuckDbTypes.numeric, unitPrice),
            Fragment.lit(
                " AS DECIMAL)\n"
                    + ")\n"
                    + "RETURNING\n"
                    + "    order_id,\n"
                    + "    product_id,\n"
                    + "    quantity,\n"
                    + "    unit_price"))
        .update()
        .runUnchecked(c);
  }
  ;
}
