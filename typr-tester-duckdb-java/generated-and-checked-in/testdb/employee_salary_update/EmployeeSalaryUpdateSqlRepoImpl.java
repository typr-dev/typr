/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.employee_salary_update;

import static typr.runtime.Fragment.interpolate;

import java.math.BigDecimal;
import java.sql.Connection;
import java.util.Optional;
import typr.runtime.DuckDbTypes;
import typr.runtime.Fragment;

public class EmployeeSalaryUpdateSqlRepoImpl implements EmployeeSalaryUpdateSqlRepo {
  @Override
  public Integer apply(
      Optional<BigDecimal> raisePercentage,
      BigDecimal newSalary,
      Integer empNumber,
      String empSuffix,
      Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Update employee salary using composite primary key\n"
                    + "-- Tests: UPDATE with composite primary key, RETURNING, decimal"
                    + " arithmetic\n\n"
                    + "UPDATE employees\n"
                    + "SET salary = CASE\n"
                    + "    WHEN "),
            Fragment.encode(DuckDbTypes.numeric.opt(), raisePercentage),
            Fragment.lit(" IS NOT NULL THEN salary * (1 + CAST("),
            Fragment.encode(DuckDbTypes.numeric.opt(), raisePercentage),
            Fragment.lit(" AS DECIMAL) / 100.0)\n    ELSE CAST("),
            Fragment.encode(DuckDbTypes.numeric, newSalary),
            Fragment.lit(" AS DECIMAL)\nEND\nWHERE emp_number = CAST("),
            Fragment.encode(DuckDbTypes.integer, empNumber),
            Fragment.lit(" AS INTEGER)\n  AND emp_suffix = CAST("),
            Fragment.encode(DuckDbTypes.text, empSuffix),
            Fragment.lit(
                " AS VARCHAR)\n"
                    + "RETURNING\n"
                    + "    emp_number,\n"
                    + "    emp_suffix,\n"
                    + "    dept_code,\n"
                    + "    dept_region,\n"
                    + "    emp_name,\n"
                    + "    salary,\n"
                    + "    hire_date"))
        .update()
        .runUnchecked(c);
  }
  ;
}
