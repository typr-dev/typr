/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.sales.salesorderheader

import adventureworks.customtypes.Defaulted
import adventureworks.customtypes.TypoLocalDateTime
import adventureworks.customtypes.TypoShort
import adventureworks.customtypes.TypoUUID
import adventureworks.person.address.AddressId
import adventureworks.person.businessentity.BusinessentityId
import adventureworks.public.AccountNumber
import adventureworks.public.Flag
import adventureworks.public.OrderNumber
import adventureworks.purchasing.shipmethod.ShipmethodId
import adventureworks.sales.currencyrate.CurrencyrateId
import adventureworks.sales.customer.CustomerId
import adventureworks.sales.salesterritory.SalesterritoryId
import adventureworks.userdefined.CustomCreditcardId
import cats.instances.list.catsStdInstancesForList
import doobie.free.connection.ConnectionIO
import doobie.postgres.syntax.FragmentOps
import doobie.syntax.SqlInterpolator.SingleFragment.fromWrite
import doobie.util.Write
import doobie.util.fragment.Fragment
import doobie.util.meta.Meta
import doobie.util.update.Update
import fs2.Stream
import typr.dsl.DeleteBuilder
import typr.dsl.SelectBuilder
import typr.dsl.UpdateBuilder
import doobie.syntax.string.toSqlInterpolator

class SalesorderheaderRepoImpl extends SalesorderheaderRepo {
  override def delete: DeleteBuilder[SalesorderheaderFields, SalesorderheaderRow] = DeleteBuilder.of(""""sales"."salesorderheader"""", SalesorderheaderFields.structure, SalesorderheaderRow.read)

  override def deleteById(salesorderid: SalesorderheaderId): ConnectionIO[Boolean] = sql"""delete from "sales"."salesorderheader" where "salesorderid" = ${fromWrite(salesorderid)(using new Write.Single(SalesorderheaderId.put))}""".update.run.map(_ > 0)

  override def deleteByIds(salesorderids: Array[SalesorderheaderId]): ConnectionIO[Int] = sql"""delete from "sales"."salesorderheader" where "salesorderid" = ANY(${fromWrite(salesorderids)(using new Write.Single(SalesorderheaderId.arrayPut))})""".update.run

  override def insert(unsaved: SalesorderheaderRow): ConnectionIO[SalesorderheaderRow] = {
    sql"""insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
    values (${fromWrite(unsaved.salesorderid)(using new Write.Single(SalesorderheaderId.put))}::int4, ${fromWrite(unsaved.revisionnumber)(using new Write.Single(TypoShort.put))}::int2, ${fromWrite(unsaved.orderdate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp, ${fromWrite(unsaved.duedate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp, ${fromWrite(unsaved.shipdate)(using new Write.SingleOpt(TypoLocalDateTime.put))}::timestamp, ${fromWrite(unsaved.status)(using new Write.Single(TypoShort.put))}::int2, ${fromWrite(unsaved.onlineorderflag)(using new Write.Single(Flag.put))}::bool, ${fromWrite(unsaved.purchaseordernumber)(using new Write.SingleOpt(OrderNumber.put))}::varchar, ${fromWrite(unsaved.accountnumber)(using new Write.SingleOpt(AccountNumber.put))}::varchar, ${fromWrite(unsaved.customerid)(using new Write.Single(CustomerId.put))}::int4, ${fromWrite(unsaved.salespersonid)(using new Write.SingleOpt(BusinessentityId.put))}::int4, ${fromWrite(unsaved.territoryid)(using new Write.SingleOpt(SalesterritoryId.put))}::int4, ${fromWrite(unsaved.billtoaddressid)(using new Write.Single(AddressId.put))}::int4, ${fromWrite(unsaved.shiptoaddressid)(using new Write.Single(AddressId.put))}::int4, ${fromWrite(unsaved.shipmethodid)(using new Write.Single(ShipmethodId.put))}::int4, ${fromWrite(unsaved.creditcardid)(using new Write.SingleOpt(/* user-picked */ CustomCreditcardId.put))}::int4, ${fromWrite(unsaved.creditcardapprovalcode)(using new Write.SingleOpt(Meta.StringMeta.put))}, ${fromWrite(unsaved.currencyrateid)(using new Write.SingleOpt(CurrencyrateId.put))}::int4, ${fromWrite(unsaved.subtotal)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric, ${fromWrite(unsaved.taxamt)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric, ${fromWrite(unsaved.freight)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric, ${fromWrite(unsaved.totaldue)(using new Write.SingleOpt(Meta.ScalaBigDecimalMeta.put))}::numeric, ${fromWrite(unsaved.comment)(using new Write.SingleOpt(Meta.StringMeta.put))}, ${fromWrite(unsaved.rowguid)(using new Write.Single(TypoUUID.put))}::uuid, ${fromWrite(unsaved.modifieddate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp)
    returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
    """.query(using SalesorderheaderRow.read).unique
  }

  override def insert(unsaved: SalesorderheaderRowUnsaved): ConnectionIO[SalesorderheaderRow] = {
    val fs = List(
      Some((Fragment.const0(s""""duedate""""), fr"${fromWrite(unsaved.duedate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp")),
      Some((Fragment.const0(s""""shipdate""""), fr"${fromWrite(unsaved.shipdate)(using new Write.SingleOpt(TypoLocalDateTime.put))}::timestamp")),
      Some((Fragment.const0(s""""purchaseordernumber""""), fr"${fromWrite(unsaved.purchaseordernumber)(using new Write.SingleOpt(OrderNumber.put))}::varchar")),
      Some((Fragment.const0(s""""accountnumber""""), fr"${fromWrite(unsaved.accountnumber)(using new Write.SingleOpt(AccountNumber.put))}::varchar")),
      Some((Fragment.const0(s""""customerid""""), fr"${fromWrite(unsaved.customerid)(using new Write.Single(CustomerId.put))}::int4")),
      Some((Fragment.const0(s""""salespersonid""""), fr"${fromWrite(unsaved.salespersonid)(using new Write.SingleOpt(BusinessentityId.put))}::int4")),
      Some((Fragment.const0(s""""territoryid""""), fr"${fromWrite(unsaved.territoryid)(using new Write.SingleOpt(SalesterritoryId.put))}::int4")),
      Some((Fragment.const0(s""""billtoaddressid""""), fr"${fromWrite(unsaved.billtoaddressid)(using new Write.Single(AddressId.put))}::int4")),
      Some((Fragment.const0(s""""shiptoaddressid""""), fr"${fromWrite(unsaved.shiptoaddressid)(using new Write.Single(AddressId.put))}::int4")),
      Some((Fragment.const0(s""""shipmethodid""""), fr"${fromWrite(unsaved.shipmethodid)(using new Write.Single(ShipmethodId.put))}::int4")),
      Some((Fragment.const0(s""""creditcardid""""), fr"${fromWrite(unsaved.creditcardid)(using new Write.SingleOpt(/* user-picked */ CustomCreditcardId.put))}::int4")),
      Some((Fragment.const0(s""""creditcardapprovalcode""""), fr"${fromWrite(unsaved.creditcardapprovalcode)(using new Write.SingleOpt(Meta.StringMeta.put))}")),
      Some((Fragment.const0(s""""currencyrateid""""), fr"${fromWrite(unsaved.currencyrateid)(using new Write.SingleOpt(CurrencyrateId.put))}::int4")),
      Some((Fragment.const0(s""""totaldue""""), fr"${fromWrite(unsaved.totaldue)(using new Write.SingleOpt(Meta.ScalaBigDecimalMeta.put))}::numeric")),
      Some((Fragment.const0(s""""comment""""), fr"${fromWrite(unsaved.comment)(using new Write.SingleOpt(Meta.StringMeta.put))}")),
      unsaved.salesorderid match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""salesorderid""""), fr"${fromWrite(value: SalesorderheaderId)(using new Write.Single(SalesorderheaderId.put))}::int4"))
      },
      unsaved.revisionnumber match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""revisionnumber""""), fr"${fromWrite(value: TypoShort)(using new Write.Single(TypoShort.put))}::int2"))
      },
      unsaved.orderdate match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""orderdate""""), fr"${fromWrite(value: TypoLocalDateTime)(using new Write.Single(TypoLocalDateTime.put))}::timestamp"))
      },
      unsaved.status match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""status""""), fr"${fromWrite(value: TypoShort)(using new Write.Single(TypoShort.put))}::int2"))
      },
      unsaved.onlineorderflag match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""onlineorderflag""""), fr"${fromWrite(value: Flag)(using new Write.Single(Flag.put))}::bool"))
      },
      unsaved.subtotal match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""subtotal""""), fr"${fromWrite(value: BigDecimal)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric"))
      },
      unsaved.taxamt match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""taxamt""""), fr"${fromWrite(value: BigDecimal)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric"))
      },
      unsaved.freight match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""freight""""), fr"${fromWrite(value: BigDecimal)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric"))
      },
      unsaved.rowguid match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""rowguid""""), fr"${fromWrite(value: TypoUUID)(using new Write.Single(TypoUUID.put))}::uuid"))
      },
      unsaved.modifieddate match {
        case Defaulted.UseDefault() => None
        case Defaulted.Provided(value) => Some((Fragment.const0(s""""modifieddate""""), fr"${fromWrite(value: TypoLocalDateTime)(using new Write.Single(TypoLocalDateTime.put))}::timestamp"))
      }
    ).flatten
    val q = if (fs.isEmpty) {
      sql"""insert into "sales"."salesorderheader" default values
      returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
      """
    } else {
      val CommaSeparate = Fragment.FragmentMonoid.intercalate(fr", ")
      sql"""insert into "sales"."salesorderheader"(${CommaSeparate.combineAllOption(fs.map { case (n, _) => n }).get})
      values (${CommaSeparate.combineAllOption(fs.map { case (_, f) => f }).get})
      returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
      """
    }
    q.query(using SalesorderheaderRow.read).unique
  }

  override def insertStreaming(
    unsaved: Stream[ConnectionIO, SalesorderheaderRow],
    batchSize: Int = 10000
  ): ConnectionIO[Long] = new FragmentOps(sql"""COPY "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate") FROM STDIN""").copyIn(unsaved, batchSize)(using SalesorderheaderRow.pgText)

  /** NOTE: this functionality requires PostgreSQL 16 or later! */
  override def insertUnsavedStreaming(
    unsaved: Stream[ConnectionIO, SalesorderheaderRowUnsaved],
    batchSize: Int = 10000
  ): ConnectionIO[Long] = new FragmentOps(sql"""COPY "sales"."salesorderheader"("duedate", "shipdate", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "totaldue", "comment", "salesorderid", "revisionnumber", "orderdate", "status", "onlineorderflag", "subtotal", "taxamt", "freight", "rowguid", "modifieddate") FROM STDIN (DEFAULT '__DEFAULT_VALUE__')""").copyIn(unsaved, batchSize)(using SalesorderheaderRowUnsaved.pgText)

  override def select: SelectBuilder[SalesorderheaderFields, SalesorderheaderRow] = SelectBuilder.of(""""sales"."salesorderheader"""", SalesorderheaderFields.structure, SalesorderheaderRow.read)

  override def selectAll: Stream[ConnectionIO, SalesorderheaderRow] = sql"""select "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text from "sales"."salesorderheader"""".query(using SalesorderheaderRow.read).stream

  override def selectById(salesorderid: SalesorderheaderId): ConnectionIO[Option[SalesorderheaderRow]] = sql"""select "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text from "sales"."salesorderheader" where "salesorderid" = ${fromWrite(salesorderid)(using new Write.Single(SalesorderheaderId.put))}""".query(using SalesorderheaderRow.read).option

  override def selectByIds(salesorderids: Array[SalesorderheaderId]): Stream[ConnectionIO, SalesorderheaderRow] = sql"""select "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text from "sales"."salesorderheader" where "salesorderid" = ANY(${fromWrite(salesorderids)(using new Write.Single(SalesorderheaderId.arrayPut))})""".query(using SalesorderheaderRow.read).stream

  override def selectByIdsTracked(salesorderids: Array[SalesorderheaderId]): ConnectionIO[Map[SalesorderheaderId, SalesorderheaderRow]] = {
    selectByIds(salesorderids).compile.toList.map { rows =>
      val byId = rows.view.map(x => (x.salesorderid, x)).toMap
      salesorderids.view.flatMap(id => byId.get(id).map(x => (id, x))).toMap
    }
  }

  override def update: UpdateBuilder[SalesorderheaderFields, SalesorderheaderRow] = UpdateBuilder.of(""""sales"."salesorderheader"""", SalesorderheaderFields.structure, SalesorderheaderRow.read)

  override def update(row: SalesorderheaderRow): ConnectionIO[Option[SalesorderheaderRow]] = {
    val salesorderid = row.salesorderid
    sql"""update "sales"."salesorderheader"
    set "revisionnumber" = ${fromWrite(row.revisionnumber)(using new Write.Single(TypoShort.put))}::int2,
    "orderdate" = ${fromWrite(row.orderdate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp,
    "duedate" = ${fromWrite(row.duedate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp,
    "shipdate" = ${fromWrite(row.shipdate)(using new Write.SingleOpt(TypoLocalDateTime.put))}::timestamp,
    "status" = ${fromWrite(row.status)(using new Write.Single(TypoShort.put))}::int2,
    "onlineorderflag" = ${fromWrite(row.onlineorderflag)(using new Write.Single(Flag.put))}::bool,
    "purchaseordernumber" = ${fromWrite(row.purchaseordernumber)(using new Write.SingleOpt(OrderNumber.put))}::varchar,
    "accountnumber" = ${fromWrite(row.accountnumber)(using new Write.SingleOpt(AccountNumber.put))}::varchar,
    "customerid" = ${fromWrite(row.customerid)(using new Write.Single(CustomerId.put))}::int4,
    "salespersonid" = ${fromWrite(row.salespersonid)(using new Write.SingleOpt(BusinessentityId.put))}::int4,
    "territoryid" = ${fromWrite(row.territoryid)(using new Write.SingleOpt(SalesterritoryId.put))}::int4,
    "billtoaddressid" = ${fromWrite(row.billtoaddressid)(using new Write.Single(AddressId.put))}::int4,
    "shiptoaddressid" = ${fromWrite(row.shiptoaddressid)(using new Write.Single(AddressId.put))}::int4,
    "shipmethodid" = ${fromWrite(row.shipmethodid)(using new Write.Single(ShipmethodId.put))}::int4,
    "creditcardid" = ${fromWrite(row.creditcardid)(using new Write.SingleOpt(/* user-picked */ CustomCreditcardId.put))}::int4,
    "creditcardapprovalcode" = ${fromWrite(row.creditcardapprovalcode)(using new Write.SingleOpt(Meta.StringMeta.put))},
    "currencyrateid" = ${fromWrite(row.currencyrateid)(using new Write.SingleOpt(CurrencyrateId.put))}::int4,
    "subtotal" = ${fromWrite(row.subtotal)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric,
    "taxamt" = ${fromWrite(row.taxamt)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric,
    "freight" = ${fromWrite(row.freight)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric,
    "totaldue" = ${fromWrite(row.totaldue)(using new Write.SingleOpt(Meta.ScalaBigDecimalMeta.put))}::numeric,
    "comment" = ${fromWrite(row.comment)(using new Write.SingleOpt(Meta.StringMeta.put))},
    "rowguid" = ${fromWrite(row.rowguid)(using new Write.Single(TypoUUID.put))}::uuid,
    "modifieddate" = ${fromWrite(row.modifieddate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp
    where "salesorderid" = ${fromWrite(salesorderid)(using new Write.Single(SalesorderheaderId.put))}
    returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text""".query(using SalesorderheaderRow.read).option
  }

  override def upsert(unsaved: SalesorderheaderRow): ConnectionIO[SalesorderheaderRow] = {
    sql"""insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
    values (
      ${fromWrite(unsaved.salesorderid)(using new Write.Single(SalesorderheaderId.put))}::int4,
    ${fromWrite(unsaved.revisionnumber)(using new Write.Single(TypoShort.put))}::int2,
    ${fromWrite(unsaved.orderdate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp,
    ${fromWrite(unsaved.duedate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp,
    ${fromWrite(unsaved.shipdate)(using new Write.SingleOpt(TypoLocalDateTime.put))}::timestamp,
    ${fromWrite(unsaved.status)(using new Write.Single(TypoShort.put))}::int2,
    ${fromWrite(unsaved.onlineorderflag)(using new Write.Single(Flag.put))}::bool,
    ${fromWrite(unsaved.purchaseordernumber)(using new Write.SingleOpt(OrderNumber.put))}::varchar,
    ${fromWrite(unsaved.accountnumber)(using new Write.SingleOpt(AccountNumber.put))}::varchar,
    ${fromWrite(unsaved.customerid)(using new Write.Single(CustomerId.put))}::int4,
    ${fromWrite(unsaved.salespersonid)(using new Write.SingleOpt(BusinessentityId.put))}::int4,
    ${fromWrite(unsaved.territoryid)(using new Write.SingleOpt(SalesterritoryId.put))}::int4,
    ${fromWrite(unsaved.billtoaddressid)(using new Write.Single(AddressId.put))}::int4,
    ${fromWrite(unsaved.shiptoaddressid)(using new Write.Single(AddressId.put))}::int4,
    ${fromWrite(unsaved.shipmethodid)(using new Write.Single(ShipmethodId.put))}::int4,
    ${fromWrite(unsaved.creditcardid)(using new Write.SingleOpt(/* user-picked */ CustomCreditcardId.put))}::int4,
    ${fromWrite(unsaved.creditcardapprovalcode)(using new Write.SingleOpt(Meta.StringMeta.put))},
    ${fromWrite(unsaved.currencyrateid)(using new Write.SingleOpt(CurrencyrateId.put))}::int4,
    ${fromWrite(unsaved.subtotal)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric,
    ${fromWrite(unsaved.taxamt)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric,
    ${fromWrite(unsaved.freight)(using new Write.Single(Meta.ScalaBigDecimalMeta.put))}::numeric,
    ${fromWrite(unsaved.totaldue)(using new Write.SingleOpt(Meta.ScalaBigDecimalMeta.put))}::numeric,
    ${fromWrite(unsaved.comment)(using new Write.SingleOpt(Meta.StringMeta.put))},
    ${fromWrite(unsaved.rowguid)(using new Write.Single(TypoUUID.put))}::uuid,
    ${fromWrite(unsaved.modifieddate)(using new Write.Single(TypoLocalDateTime.put))}::timestamp
    )
    on conflict ("salesorderid")
    do update set
      "revisionnumber" = EXCLUDED."revisionnumber",
    "orderdate" = EXCLUDED."orderdate",
    "duedate" = EXCLUDED."duedate",
    "shipdate" = EXCLUDED."shipdate",
    "status" = EXCLUDED."status",
    "onlineorderflag" = EXCLUDED."onlineorderflag",
    "purchaseordernumber" = EXCLUDED."purchaseordernumber",
    "accountnumber" = EXCLUDED."accountnumber",
    "customerid" = EXCLUDED."customerid",
    "salespersonid" = EXCLUDED."salespersonid",
    "territoryid" = EXCLUDED."territoryid",
    "billtoaddressid" = EXCLUDED."billtoaddressid",
    "shiptoaddressid" = EXCLUDED."shiptoaddressid",
    "shipmethodid" = EXCLUDED."shipmethodid",
    "creditcardid" = EXCLUDED."creditcardid",
    "creditcardapprovalcode" = EXCLUDED."creditcardapprovalcode",
    "currencyrateid" = EXCLUDED."currencyrateid",
    "subtotal" = EXCLUDED."subtotal",
    "taxamt" = EXCLUDED."taxamt",
    "freight" = EXCLUDED."freight",
    "totaldue" = EXCLUDED."totaldue",
    "comment" = EXCLUDED."comment",
    "rowguid" = EXCLUDED."rowguid",
    "modifieddate" = EXCLUDED."modifieddate"
    returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
    """.query(using SalesorderheaderRow.read).unique
  }

  override def upsertBatch(unsaved: List[SalesorderheaderRow]): Stream[ConnectionIO, SalesorderheaderRow] = {
    Update[SalesorderheaderRow](
      s"""insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
      values (?::int4,?::int2,?::timestamp,?::timestamp,?::timestamp,?::int2,?::bool,?::varchar,?::varchar,?::int4,?::int4,?::int4,?::int4,?::int4,?::int4,?::int4,?,?::int4,?::numeric,?::numeric,?::numeric,?::numeric,?,?::uuid,?::timestamp)
      on conflict ("salesorderid")
      do update set
        "revisionnumber" = EXCLUDED."revisionnumber",
      "orderdate" = EXCLUDED."orderdate",
      "duedate" = EXCLUDED."duedate",
      "shipdate" = EXCLUDED."shipdate",
      "status" = EXCLUDED."status",
      "onlineorderflag" = EXCLUDED."onlineorderflag",
      "purchaseordernumber" = EXCLUDED."purchaseordernumber",
      "accountnumber" = EXCLUDED."accountnumber",
      "customerid" = EXCLUDED."customerid",
      "salespersonid" = EXCLUDED."salespersonid",
      "territoryid" = EXCLUDED."territoryid",
      "billtoaddressid" = EXCLUDED."billtoaddressid",
      "shiptoaddressid" = EXCLUDED."shiptoaddressid",
      "shipmethodid" = EXCLUDED."shipmethodid",
      "creditcardid" = EXCLUDED."creditcardid",
      "creditcardapprovalcode" = EXCLUDED."creditcardapprovalcode",
      "currencyrateid" = EXCLUDED."currencyrateid",
      "subtotal" = EXCLUDED."subtotal",
      "taxamt" = EXCLUDED."taxamt",
      "freight" = EXCLUDED."freight",
      "totaldue" = EXCLUDED."totaldue",
      "comment" = EXCLUDED."comment",
      "rowguid" = EXCLUDED."rowguid",
      "modifieddate" = EXCLUDED."modifieddate"
      returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text"""
    )(using SalesorderheaderRow.write)
    .updateManyWithGeneratedKeys[SalesorderheaderRow]("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")(unsaved)(using catsStdInstancesForList, SalesorderheaderRow.read)
  }

  /** NOTE: this functionality is not safe if you use auto-commit mode! it runs 3 SQL statements */
  override def upsertStreaming(
    unsaved: Stream[ConnectionIO, SalesorderheaderRow],
    batchSize: Int = 10000
  ): ConnectionIO[Int] = {
    for {
      _ <- sql"""create temporary table salesorderheader_TEMP (like "sales"."salesorderheader") on commit drop""".update.run
      _ <- new FragmentOps(sql"""copy salesorderheader_TEMP("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate") from stdin""").copyIn(unsaved, batchSize)(using SalesorderheaderRow.pgText)
      res <- sql"""insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
             select * from salesorderheader_TEMP
             on conflict ("salesorderid")
             do update set
               "revisionnumber" = EXCLUDED."revisionnumber",
             "orderdate" = EXCLUDED."orderdate",
             "duedate" = EXCLUDED."duedate",
             "shipdate" = EXCLUDED."shipdate",
             "status" = EXCLUDED."status",
             "onlineorderflag" = EXCLUDED."onlineorderflag",
             "purchaseordernumber" = EXCLUDED."purchaseordernumber",
             "accountnumber" = EXCLUDED."accountnumber",
             "customerid" = EXCLUDED."customerid",
             "salespersonid" = EXCLUDED."salespersonid",
             "territoryid" = EXCLUDED."territoryid",
             "billtoaddressid" = EXCLUDED."billtoaddressid",
             "shiptoaddressid" = EXCLUDED."shiptoaddressid",
             "shipmethodid" = EXCLUDED."shipmethodid",
             "creditcardid" = EXCLUDED."creditcardid",
             "creditcardapprovalcode" = EXCLUDED."creditcardapprovalcode",
             "currencyrateid" = EXCLUDED."currencyrateid",
             "subtotal" = EXCLUDED."subtotal",
             "taxamt" = EXCLUDED."taxamt",
             "freight" = EXCLUDED."freight",
             "totaldue" = EXCLUDED."totaldue",
             "comment" = EXCLUDED."comment",
             "rowguid" = EXCLUDED."rowguid",
             "modifieddate" = EXCLUDED."modifieddate"
             ;
             drop table salesorderheader_TEMP;""".update.run
    } yield res
  }
}