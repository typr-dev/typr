/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.warehouses

import java.sql.Connection
import java.util.ArrayList
import java.util.HashMap
import java.util.Optional
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.FragmentInterpolator.interpolate

class WarehousesRepoImpl extends WarehousesRepo {
  override def delete: DeleteBuilder[WarehousesFields, WarehousesRow] = DeleteBuilder.of("`warehouses`", WarehousesFields.structure, Dialect.MARIADB)

  override def deleteById(warehouseId: WarehousesId)(using c: Connection): java.lang.Boolean = interpolate"delete from `warehouses` where `warehouse_id` = ${WarehousesId.pgType.encode(warehouseId)}".update().runUnchecked(c) > 0

  override def deleteByIds(warehouseIds: Array[WarehousesId])(using c: Connection): Integer = {
    val fragments: ArrayList[Fragment] = new ArrayList[Fragment]()
    warehouseIds.foreach { id => fragments.add(WarehousesId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override def insert(unsaved: WarehousesRow)(using c: Connection): WarehousesRow = {
  interpolate"""insert into `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
    values (${MariaTypes.text.encode(unsaved.code)}, ${MariaTypes.text.encode(unsaved.name)}, ${MariaTypes.text.encode(unsaved.address)}, ${MariaTypes.point.encode(unsaved.location)}, ${MariaTypes.polygon.opt().encode(unsaved.serviceArea)}, ${MariaTypes.text.encode(unsaved.timezone)}, ${MariaTypes.bool.encode(unsaved.isActive)}, ${MariaTypes.text.opt().encode(unsaved.contactEmail)}, ${MariaTypes.text.opt().encode(unsaved.contactPhone)})
    returning `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    """
    .updateReturning(WarehousesRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: WarehousesRowUnsaved)(using c: Connection): WarehousesRow = {
    val columns: ArrayList[Literal] = new ArrayList[Literal]()
    val values: ArrayList[Fragment] = new ArrayList[Fragment]()
    columns.add(Fragment.lit("`code`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.text.encode(unsaved.code)}"): @scala.annotation.nowarn
    columns.add(Fragment.lit("`name`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.text.encode(unsaved.name)}"): @scala.annotation.nowarn
    columns.add(Fragment.lit("`address`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.text.encode(unsaved.address)}"): @scala.annotation.nowarn
    columns.add(Fragment.lit("`location`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.point.encode(unsaved.location)}"): @scala.annotation.nowarn
    unsaved.serviceArea.visit(
      {  },
      value => { columns.add(Fragment.lit("`service_area`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.polygon.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.timezone.visit(
      {  },
      value => { columns.add(Fragment.lit("`timezone`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.isActive.visit(
      {  },
      value => { columns.add(Fragment.lit("`is_active`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.bool.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.contactEmail.visit(
      {  },
      value => { columns.add(Fragment.lit("`contact_email`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.contactPhone.visit(
      {  },
      value => { columns.add(Fragment.lit("`contact_phone`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      interpolate"""insert into `warehouses`(${Fragment.comma(columns)})
      values (${Fragment.comma(values)})
      returning `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      """
    }
    return q.updateReturning(WarehousesRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[WarehousesFields, WarehousesRow] = SelectBuilder.of("`warehouses`", WarehousesFields.structure, WarehousesRow.`_rowParser`, Dialect.MARIADB)

  override def selectAll(using c: Connection): java.util.List[WarehousesRow] = {
    interpolate"""select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
    """.query(WarehousesRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(warehouseId: WarehousesId)(using c: Connection): Optional[WarehousesRow] = {
    interpolate"""select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
    where `warehouse_id` = ${WarehousesId.pgType.encode(warehouseId)}""".query(WarehousesRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(warehouseIds: Array[WarehousesId])(using c: Connection): java.util.List[WarehousesRow] = {
    val fragments: ArrayList[Fragment] = new ArrayList[Fragment]()
    warehouseIds.foreach { id => fragments.add(WarehousesId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone` from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(WarehousesRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(warehouseIds: Array[WarehousesId])(using c: Connection): java.util.Map[WarehousesId, WarehousesRow] = {
    val ret: HashMap[WarehousesId, WarehousesRow] = new HashMap[WarehousesId, WarehousesRow]()
    selectByIds(warehouseIds)(using c).forEach(row => ret.put(row.warehouseId, row): @scala.annotation.nowarn)
    return ret
  }

  override def selectByUniqueCode(code: String)(using c: Connection): Optional[WarehousesRow] = {
    interpolate"""select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
    where `code` = ${MariaTypes.text.encode(code)}
    """.query(WarehousesRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def update: UpdateBuilder[WarehousesFields, WarehousesRow] = UpdateBuilder.of("`warehouses`", WarehousesFields.structure, WarehousesRow.`_rowParser`.all(), Dialect.MARIADB)

  override def update(row: WarehousesRow)(using c: Connection): java.lang.Boolean = {
    val warehouseId: WarehousesId = row.warehouseId
    return interpolate"""update `warehouses`
    set `code` = ${MariaTypes.text.encode(row.code)},
    `name` = ${MariaTypes.text.encode(row.name)},
    `address` = ${MariaTypes.text.encode(row.address)},
    `location` = ${MariaTypes.point.encode(row.location)},
    `service_area` = ${MariaTypes.polygon.opt().encode(row.serviceArea)},
    `timezone` = ${MariaTypes.text.encode(row.timezone)},
    `is_active` = ${MariaTypes.bool.encode(row.isActive)},
    `contact_email` = ${MariaTypes.text.opt().encode(row.contactEmail)},
    `contact_phone` = ${MariaTypes.text.opt().encode(row.contactPhone)}
    where `warehouse_id` = ${WarehousesId.pgType.encode(warehouseId)}""".update().runUnchecked(c) > 0
  }

  override def upsert(unsaved: WarehousesRow)(using c: Connection): WarehousesRow = {
  interpolate"""INSERT INTO `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
    VALUES (${MariaTypes.text.encode(unsaved.code)}, ${MariaTypes.text.encode(unsaved.name)}, ${MariaTypes.text.encode(unsaved.address)}, ${MariaTypes.point.encode(unsaved.location)}, ${MariaTypes.polygon.opt().encode(unsaved.serviceArea)}, ${MariaTypes.text.encode(unsaved.timezone)}, ${MariaTypes.bool.encode(unsaved.isActive)}, ${MariaTypes.text.opt().encode(unsaved.contactEmail)}, ${MariaTypes.text.opt().encode(unsaved.contactPhone)})
    ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
    `name` = VALUES(`name`),
    `address` = VALUES(`address`),
    `location` = VALUES(`location`),
    `service_area` = VALUES(`service_area`),
    `timezone` = VALUES(`timezone`),
    `is_active` = VALUES(`is_active`),
    `contact_email` = VALUES(`contact_email`),
    `contact_phone` = VALUES(`contact_phone`)
    RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`"""
    .updateReturning(WarehousesRow.`_rowParser`.exactlyOne())
    .runUnchecked(c)
  }

  override def upsertBatch(unsaved: java.util.Iterator[WarehousesRow])(using c: Connection): java.util.List[WarehousesRow] = {
    interpolate"""INSERT INTO `warehouses`(`warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
    `name` = VALUES(`name`),
    `address` = VALUES(`address`),
    `location` = VALUES(`location`),
    `service_area` = VALUES(`service_area`),
    `timezone` = VALUES(`timezone`),
    `is_active` = VALUES(`is_active`),
    `contact_email` = VALUES(`contact_email`),
    `contact_phone` = VALUES(`contact_phone`)
    RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`"""
      .updateReturningEach(WarehousesRow.`_rowParser`, unsaved)
      .runUnchecked(c)
  }
}