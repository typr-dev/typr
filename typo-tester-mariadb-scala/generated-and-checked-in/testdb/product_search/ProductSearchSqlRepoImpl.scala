/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.product_search

import java.sql.Connection
import java.util.Optional
import typo.runtime.MariaTypes
import typo.runtime.FragmentInterpolator.interpolate

class ProductSearchSqlRepoImpl extends ProductSearchSqlRepo {
  override def apply(
    brandId: Optional[Integer],
    minPrice: Optional[java.math.BigDecimal],
    maxPrice: Optional[java.math.BigDecimal],
    status: Optional[String],
    limit: java.lang.Long
  )(using c: Connection): java.util.List[ProductSearchSqlRow] = {
    interpolate"""-- Search products with optional filters
    SELECT p.product_id,
           p.sku,
           p.name,
           p.short_description,
           p.base_price,
           p.status,
           b.name AS brand_name
    FROM products p
    LEFT JOIN brands b ON p.brand_id = b.brand_id
    WHERE (${MariaTypes.int_.opt().encode(brandId)} IS NULL OR p.brand_id = ${MariaTypes.int_.opt().encode(brandId)})
      AND (${MariaTypes.numeric.opt().encode(minPrice)} IS NULL OR p.base_price >= ${MariaTypes.numeric.opt().encode(minPrice)})
      AND (${MariaTypes.numeric.opt().encode(maxPrice)} IS NULL OR p.base_price <= ${MariaTypes.numeric.opt().encode(maxPrice)})
      AND (${MariaTypes.text.opt().encode(status)} IS NULL OR p.status = ${MariaTypes.text.opt().encode(status)})
    ORDER BY p.name
    LIMIT ${MariaTypes.bigint.encode(limit)}
    """.query(ProductSearchSqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}