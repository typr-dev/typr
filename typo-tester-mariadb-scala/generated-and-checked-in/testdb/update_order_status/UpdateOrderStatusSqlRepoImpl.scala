/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.update_order_status

import java.sql.Connection
import testdb.orders.OrdersId
import typo.runtime.MariaTypes
import typo.runtime.FragmentInterpolator.interpolate

class UpdateOrderStatusSqlRepoImpl extends UpdateOrderStatusSqlRepo {
  override def apply(
    newStatus: /* user-picked */ String,
    orderId: /* user-picked */ OrdersId
  )(using c: Connection): Integer = {
    interpolate"""-- Update order status
    UPDATE orders
    SET order_status = ${MariaTypes.text.encode(newStatus)},
        confirmed_at = CASE WHEN ${MariaTypes.text.encode(newStatus)} = 'confirmed' THEN NOW(6) ELSE confirmed_at END,
        shipped_at = CASE WHEN ${MariaTypes.text.encode(newStatus)} = 'shipped' THEN NOW(6) ELSE shipped_at END,
        delivered_at = CASE WHEN ${MariaTypes.text.encode(newStatus)} = 'delivered' THEN NOW(6) ELSE delivered_at END
    WHERE order_id = ${/* user-picked */ OrdersId.pgType.encode(orderId)}
    """.update().runUnchecked(c)
  }
}