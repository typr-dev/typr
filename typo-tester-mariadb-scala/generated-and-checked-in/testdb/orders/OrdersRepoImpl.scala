/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.orders

import java.sql.Connection
import java.util.ArrayList
import java.util.HashMap
import java.util.Optional
import testdb.customer_addresses.CustomerAddressesId
import testdb.customers.CustomersId
import testdb.promotions.PromotionsId
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.FragmentInterpolator.interpolate

class OrdersRepoImpl extends OrdersRepo {
  override def delete: DeleteBuilder[OrdersFields, OrdersRow] = DeleteBuilder.of("`orders`", OrdersFields.structure, Dialect.MARIADB)

  override def deleteById(orderId: OrdersId)(using c: Connection): java.lang.Boolean = interpolate"delete from `orders` where `order_id` = ${OrdersId.pgType.encode(orderId)}".update().runUnchecked(c) > 0

  override def deleteByIds(orderIds: Array[OrdersId])(using c: Connection): Integer = {
    val fragments: ArrayList[Fragment] = new ArrayList[Fragment]()
    orderIds.foreach { id => fragments.add(OrdersId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `orders` where `order_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override def insert(unsaved: OrdersRow)(using c: Connection): OrdersRow = {
  interpolate"""insert into `orders`(`order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
    values (${MariaTypes.text.encode(unsaved.orderNumber)}, ${CustomersId.pgType.encode(unsaved.customerId)}, ${MariaTypes.text.encode(unsaved.orderStatus)}, ${MariaTypes.text.encode(unsaved.paymentStatus)}, ${CustomerAddressesId.pgType.opt().encode(unsaved.shippingAddressId)}, ${CustomerAddressesId.pgType.opt().encode(unsaved.billingAddressId)}, ${MariaTypes.numeric.encode(unsaved.subtotal)}, ${MariaTypes.numeric.encode(unsaved.shippingCost)}, ${MariaTypes.numeric.encode(unsaved.taxAmount)}, ${MariaTypes.numeric.encode(unsaved.discountAmount)}, ${MariaTypes.numeric.encode(unsaved.totalAmount)}, ${MariaTypes.text.encode(unsaved.currencyCode)}, ${PromotionsId.pgType.opt().encode(unsaved.promotionId)}, ${MariaTypes.text.opt().encode(unsaved.notes)}, ${MariaTypes.text.opt().encode(unsaved.internalNotes)}, ${MariaTypes.inet6.opt().encode(unsaved.ipAddress)}, ${MariaTypes.text.opt().encode(unsaved.userAgent)}, ${MariaTypes.datetime.encode(unsaved.orderedAt)}, ${MariaTypes.datetime.opt().encode(unsaved.confirmedAt)}, ${MariaTypes.datetime.opt().encode(unsaved.shippedAt)}, ${MariaTypes.datetime.opt().encode(unsaved.deliveredAt)})
    returning `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    """
    .updateReturning(OrdersRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: OrdersRowUnsaved)(using c: Connection): OrdersRow = {
    val columns: ArrayList[Literal] = new ArrayList[Literal]()
    val values: ArrayList[Fragment] = new ArrayList[Fragment]()
    columns.add(Fragment.lit("`order_number`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.text.encode(unsaved.orderNumber)}"): @scala.annotation.nowarn
    columns.add(Fragment.lit("`customer_id`")): @scala.annotation.nowarn
    values.add(interpolate"${CustomersId.pgType.encode(unsaved.customerId)}"): @scala.annotation.nowarn
    columns.add(Fragment.lit("`subtotal`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.numeric.encode(unsaved.subtotal)}"): @scala.annotation.nowarn
    columns.add(Fragment.lit("`total_amount`")): @scala.annotation.nowarn
    values.add(interpolate"${MariaTypes.numeric.encode(unsaved.totalAmount)}"): @scala.annotation.nowarn
    unsaved.orderStatus.visit(
      {  },
      value => { columns.add(Fragment.lit("`order_status`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.paymentStatus.visit(
      {  },
      value => { columns.add(Fragment.lit("`payment_status`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.shippingAddressId.visit(
      {  },
      value => { columns.add(Fragment.lit("`shipping_address_id`")): @scala.annotation.nowarn; values.add(interpolate"${CustomerAddressesId.pgType.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.billingAddressId.visit(
      {  },
      value => { columns.add(Fragment.lit("`billing_address_id`")): @scala.annotation.nowarn; values.add(interpolate"${CustomerAddressesId.pgType.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.shippingCost.visit(
      {  },
      value => { columns.add(Fragment.lit("`shipping_cost`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.numeric.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.taxAmount.visit(
      {  },
      value => { columns.add(Fragment.lit("`tax_amount`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.numeric.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.discountAmount.visit(
      {  },
      value => { columns.add(Fragment.lit("`discount_amount`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.numeric.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.currencyCode.visit(
      {  },
      value => { columns.add(Fragment.lit("`currency_code`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.promotionId.visit(
      {  },
      value => { columns.add(Fragment.lit("`promotion_id`")): @scala.annotation.nowarn; values.add(interpolate"${PromotionsId.pgType.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.notes.visit(
      {  },
      value => { columns.add(Fragment.lit("`notes`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.internalNotes.visit(
      {  },
      value => { columns.add(Fragment.lit("`internal_notes`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.ipAddress.visit(
      {  },
      value => { columns.add(Fragment.lit("`ip_address`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.inet6.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.userAgent.visit(
      {  },
      value => { columns.add(Fragment.lit("`user_agent`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.text.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.orderedAt.visit(
      {  },
      value => { columns.add(Fragment.lit("`ordered_at`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.datetime.encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.confirmedAt.visit(
      {  },
      value => { columns.add(Fragment.lit("`confirmed_at`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.datetime.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.shippedAt.visit(
      {  },
      value => { columns.add(Fragment.lit("`shipped_at`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.datetime.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    unsaved.deliveredAt.visit(
      {  },
      value => { columns.add(Fragment.lit("`delivered_at`")): @scala.annotation.nowarn; values.add(interpolate"${MariaTypes.datetime.opt().encode(value)}"): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      interpolate"""insert into `orders`(${Fragment.comma(columns)})
      values (${Fragment.comma(values)})
      returning `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
      """
    }
    return q.updateReturning(OrdersRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[OrdersFields, OrdersRow] = SelectBuilder.of("`orders`", OrdersFields.structure, OrdersRow.`_rowParser`, Dialect.MARIADB)

  override def selectAll(using c: Connection): java.util.List[OrdersRow] = {
    interpolate"""select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
    """.query(OrdersRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(orderId: OrdersId)(using c: Connection): Optional[OrdersRow] = {
    interpolate"""select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
    where `order_id` = ${OrdersId.pgType.encode(orderId)}""".query(OrdersRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(orderIds: Array[OrdersId])(using c: Connection): java.util.List[OrdersRow] = {
    val fragments: ArrayList[Fragment] = new ArrayList[Fragment]()
    orderIds.foreach { id => fragments.add(OrdersId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at` from `orders` where `order_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(OrdersRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(orderIds: Array[OrdersId])(using c: Connection): java.util.Map[OrdersId, OrdersRow] = {
    val ret: HashMap[OrdersId, OrdersRow] = new HashMap[OrdersId, OrdersRow]()
    selectByIds(orderIds)(using c).forEach(row => ret.put(row.orderId, row): @scala.annotation.nowarn)
    return ret
  }

  override def selectByUniqueOrderNumber(orderNumber: String)(using c: Connection): Optional[OrdersRow] = {
    interpolate"""select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
    where `order_number` = ${MariaTypes.text.encode(orderNumber)}
    """.query(OrdersRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def update: UpdateBuilder[OrdersFields, OrdersRow] = UpdateBuilder.of("`orders`", OrdersFields.structure, OrdersRow.`_rowParser`.all(), Dialect.MARIADB)

  override def update(row: OrdersRow)(using c: Connection): java.lang.Boolean = {
    val orderId: OrdersId = row.orderId
    return interpolate"""update `orders`
    set `order_number` = ${MariaTypes.text.encode(row.orderNumber)},
    `customer_id` = ${CustomersId.pgType.encode(row.customerId)},
    `order_status` = ${MariaTypes.text.encode(row.orderStatus)},
    `payment_status` = ${MariaTypes.text.encode(row.paymentStatus)},
    `shipping_address_id` = ${CustomerAddressesId.pgType.opt().encode(row.shippingAddressId)},
    `billing_address_id` = ${CustomerAddressesId.pgType.opt().encode(row.billingAddressId)},
    `subtotal` = ${MariaTypes.numeric.encode(row.subtotal)},
    `shipping_cost` = ${MariaTypes.numeric.encode(row.shippingCost)},
    `tax_amount` = ${MariaTypes.numeric.encode(row.taxAmount)},
    `discount_amount` = ${MariaTypes.numeric.encode(row.discountAmount)},
    `total_amount` = ${MariaTypes.numeric.encode(row.totalAmount)},
    `currency_code` = ${MariaTypes.text.encode(row.currencyCode)},
    `promotion_id` = ${PromotionsId.pgType.opt().encode(row.promotionId)},
    `notes` = ${MariaTypes.text.opt().encode(row.notes)},
    `internal_notes` = ${MariaTypes.text.opt().encode(row.internalNotes)},
    `ip_address` = ${MariaTypes.inet6.opt().encode(row.ipAddress)},
    `user_agent` = ${MariaTypes.text.opt().encode(row.userAgent)},
    `ordered_at` = ${MariaTypes.datetime.encode(row.orderedAt)},
    `confirmed_at` = ${MariaTypes.datetime.opt().encode(row.confirmedAt)},
    `shipped_at` = ${MariaTypes.datetime.opt().encode(row.shippedAt)},
    `delivered_at` = ${MariaTypes.datetime.opt().encode(row.deliveredAt)}
    where `order_id` = ${OrdersId.pgType.encode(orderId)}""".update().runUnchecked(c) > 0
  }

  override def upsert(unsaved: OrdersRow)(using c: Connection): OrdersRow = {
  interpolate"""INSERT INTO `orders`(`order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
    VALUES (${MariaTypes.text.encode(unsaved.orderNumber)}, ${CustomersId.pgType.encode(unsaved.customerId)}, ${MariaTypes.text.encode(unsaved.orderStatus)}, ${MariaTypes.text.encode(unsaved.paymentStatus)}, ${CustomerAddressesId.pgType.opt().encode(unsaved.shippingAddressId)}, ${CustomerAddressesId.pgType.opt().encode(unsaved.billingAddressId)}, ${MariaTypes.numeric.encode(unsaved.subtotal)}, ${MariaTypes.numeric.encode(unsaved.shippingCost)}, ${MariaTypes.numeric.encode(unsaved.taxAmount)}, ${MariaTypes.numeric.encode(unsaved.discountAmount)}, ${MariaTypes.numeric.encode(unsaved.totalAmount)}, ${MariaTypes.text.encode(unsaved.currencyCode)}, ${PromotionsId.pgType.opt().encode(unsaved.promotionId)}, ${MariaTypes.text.opt().encode(unsaved.notes)}, ${MariaTypes.text.opt().encode(unsaved.internalNotes)}, ${MariaTypes.inet6.opt().encode(unsaved.ipAddress)}, ${MariaTypes.text.opt().encode(unsaved.userAgent)}, ${MariaTypes.datetime.encode(unsaved.orderedAt)}, ${MariaTypes.datetime.opt().encode(unsaved.confirmedAt)}, ${MariaTypes.datetime.opt().encode(unsaved.shippedAt)}, ${MariaTypes.datetime.opt().encode(unsaved.deliveredAt)})
    ON DUPLICATE KEY UPDATE `order_number` = VALUES(`order_number`),
    `customer_id` = VALUES(`customer_id`),
    `order_status` = VALUES(`order_status`),
    `payment_status` = VALUES(`payment_status`),
    `shipping_address_id` = VALUES(`shipping_address_id`),
    `billing_address_id` = VALUES(`billing_address_id`),
    `subtotal` = VALUES(`subtotal`),
    `shipping_cost` = VALUES(`shipping_cost`),
    `tax_amount` = VALUES(`tax_amount`),
    `discount_amount` = VALUES(`discount_amount`),
    `total_amount` = VALUES(`total_amount`),
    `currency_code` = VALUES(`currency_code`),
    `promotion_id` = VALUES(`promotion_id`),
    `notes` = VALUES(`notes`),
    `internal_notes` = VALUES(`internal_notes`),
    `ip_address` = VALUES(`ip_address`),
    `user_agent` = VALUES(`user_agent`),
    `ordered_at` = VALUES(`ordered_at`),
    `confirmed_at` = VALUES(`confirmed_at`),
    `shipped_at` = VALUES(`shipped_at`),
    `delivered_at` = VALUES(`delivered_at`)
    RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`"""
    .updateReturning(OrdersRow.`_rowParser`.exactlyOne())
    .runUnchecked(c)
  }

  override def upsertBatch(unsaved: java.util.Iterator[OrdersRow])(using c: Connection): java.util.List[OrdersRow] = {
    interpolate"""INSERT INTO `orders`(`order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ON DUPLICATE KEY UPDATE `order_number` = VALUES(`order_number`),
    `customer_id` = VALUES(`customer_id`),
    `order_status` = VALUES(`order_status`),
    `payment_status` = VALUES(`payment_status`),
    `shipping_address_id` = VALUES(`shipping_address_id`),
    `billing_address_id` = VALUES(`billing_address_id`),
    `subtotal` = VALUES(`subtotal`),
    `shipping_cost` = VALUES(`shipping_cost`),
    `tax_amount` = VALUES(`tax_amount`),
    `discount_amount` = VALUES(`discount_amount`),
    `total_amount` = VALUES(`total_amount`),
    `currency_code` = VALUES(`currency_code`),
    `promotion_id` = VALUES(`promotion_id`),
    `notes` = VALUES(`notes`),
    `internal_notes` = VALUES(`internal_notes`),
    `ip_address` = VALUES(`ip_address`),
    `user_agent` = VALUES(`user_agent`),
    `ordered_at` = VALUES(`ordered_at`),
    `confirmed_at` = VALUES(`confirmed_at`),
    `shipped_at` = VALUES(`shipped_at`),
    `delivered_at` = VALUES(`delivered_at`)
    RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`"""
      .updateReturningEach(OrdersRow.`_rowParser`, unsaved)
      .runUnchecked(c)
  }
}