/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.customer_orders

import java.sql.Connection
import java.util.Optional
import testdb.customers.CustomersId
import typo.runtime.MariaTypes
import typo.runtime.FragmentInterpolator.interpolate

class CustomerOrdersSqlRepoImpl extends CustomerOrdersSqlRepo {
  override def apply(
    customerId: /* user-picked */ CustomersId,
    orderStatus: Optional[String]
  )(using c: Connection): java.util.List[CustomerOrdersSqlRow] = {
    interpolate"""-- Query customers with their orders
    SELECT c.customer_id,
           c.email,
           c.first_name,
           c.last_name,
           c.tier,
           o.order_id,
           o.order_number,
           o.order_status,
           o.total_amount,
           o.ordered_at
    FROM customers c
    LEFT JOIN orders o ON c.customer_id = o.customer_id
    WHERE c.customer_id = ${/* user-picked */ CustomersId.pgType.encode(customerId)}
      AND (${MariaTypes.text.opt().encode(orderStatus)} IS NULL OR o.order_status = ${MariaTypes.text.opt().encode(orderStatus)})
    """.query(CustomerOrdersSqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}