/**
 * File automatically generated by `typo` for its own test suite.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN
 */
package testdb.hardcoded.myschema.person

import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try
import testdb.hardcoded.Text
import testdb.hardcoded.customtypes.Defaulted
import testdb.hardcoded.customtypes.Defaulted.UseDefault
import testdb.hardcoded.myschema.Number
import testdb.hardcoded.myschema.Sector
import testdb.hardcoded.myschema.football_club.FootballClubId
import testdb.hardcoded.myschema.marital_status.MaritalStatusId

/** This class corresponds to a row in table `myschema.person` which has not been persisted yet */
case class PersonRowUnsaved(
  /** Points to [[testdb.hardcoded.myschema.football_club.FootballClubRow.id]] */
  favouriteFootballClubId: FootballClubId,
  name: String,
  nickName: Option[/* max 30 chars */ String] = None,
  blogUrl: Option[/* max 100 chars */ String] = None,
  email: String,
  phone: String,
  likesPizza: Boolean,
  workEmail: Option[/* max 254 chars */ String] = None,
  /** Default: auto-increment */
  id: Defaulted[PersonId] = new UseDefault(),
  /** Default: some-value
   * Points to [[testdb.hardcoded.myschema.marital_status.MaritalStatusRow.id]]
   */
  maritalStatusId: Defaulted[MaritalStatusId] = new UseDefault(),
  /** Default: one */
  favoriteNumber: Defaulted[Number] = new UseDefault()
) {
  def toRow(
    idDefault: => PersonId,
    maritalStatusIdDefault: => MaritalStatusId,
    favoriteNumberDefault: => Number,
    sectorDefault: => Sector
  ): PersonRow = {
    new PersonRow(
      id = id.getOrElse(idDefault),
      favouriteFootballClubId = favouriteFootballClubId,
      name = name,
      nickName = nickName,
      blogUrl = blogUrl,
      email = email,
      phone = phone,
      likesPizza = likesPizza,
      maritalStatusId = maritalStatusId.getOrElse(maritalStatusIdDefault),
      workEmail = workEmail,
      sector = sectorDefault,
      favoriteNumber = favoriteNumber.getOrElse(favoriteNumberDefault)
    )
  }
}

object PersonRowUnsaved {
  given pgText: Text[PersonRowUnsaved] = {
    Text.instance[PersonRowUnsaved]{ (row, sb) =>
      FootballClubId.pgText.unsafeEncode(row.favouriteFootballClubId, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.name, sb)
      sb.append(Text.DELIMETER)
      Text.option(using Text.stringInstance).unsafeEncode(row.nickName, sb)
      sb.append(Text.DELIMETER)
      Text.option(using Text.stringInstance).unsafeEncode(row.blogUrl, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.email, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.phone, sb)
      sb.append(Text.DELIMETER)
      Text.booleanInstance.unsafeEncode(row.likesPizza, sb)
      sb.append(Text.DELIMETER)
      Text.option(using Text.stringInstance).unsafeEncode(row.workEmail, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using PersonId.pgText).unsafeEncode(row.id, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using MaritalStatusId.pgText).unsafeEncode(row.maritalStatusId, sb)
      sb.append(Text.DELIMETER)
      Defaulted.pgText(using Number.pgText).unsafeEncode(row.favoriteNumber, sb)
    }
  }

  given reads: Reads[PersonRowUnsaved] = {
    Reads[PersonRowUnsaved](json => JsResult.fromTry(
        Try(
          PersonRowUnsaved(
            favouriteFootballClubId = json.\("favourite_football_club_id").as(using FootballClubId.reads),
            name = json.\("name").as(using Reads.StringReads),
            nickName = json.\("nick_name").toOption.map(_.as(using Reads.StringReads)),
            blogUrl = json.\("blog_url").toOption.map(_.as(using Reads.StringReads)),
            email = json.\("email").as(using Reads.StringReads),
            phone = json.\("phone").as(using Reads.StringReads),
            likesPizza = json.\("likes_pizza").as(using Reads.BooleanReads),
            workEmail = json.\("work_email").toOption.map(_.as(using Reads.StringReads)),
            id = json.\("id").as(using Defaulted.reads(using PersonId.reads)),
            maritalStatusId = json.\("marital_status_id").as(using Defaulted.reads(using MaritalStatusId.reads)),
            favoriteNumber = json.\("favorite_number").as(using Defaulted.reads(using Number.reads))
          )
        )
      ),
    )
  }

  given writes: OWrites[PersonRowUnsaved] = {
    OWrites[PersonRowUnsaved](o =>
      new JsObject(ListMap[String, JsValue](
        "favourite_football_club_id" -> FootballClubId.writes.writes(o.favouriteFootballClubId),
        "name" -> Writes.StringWrites.writes(o.name),
        "nick_name" -> Writes.OptionWrites(using Writes.StringWrites).writes(o.nickName),
        "blog_url" -> Writes.OptionWrites(using Writes.StringWrites).writes(o.blogUrl),
        "email" -> Writes.StringWrites.writes(o.email),
        "phone" -> Writes.StringWrites.writes(o.phone),
        "likes_pizza" -> Writes.BooleanWrites.writes(o.likesPizza),
        "work_email" -> Writes.OptionWrites(using Writes.StringWrites).writes(o.workEmail),
        "id" -> Defaulted.writes(using PersonId.writes).writes(o.id),
        "marital_status_id" -> Defaulted.writes(using MaritalStatusId.writes).writes(o.maritalStatusId),
        "favorite_number" -> Defaulted.writes(using Number.writes).writes(o.favoriteNumber)
      ))
    )
  }
}