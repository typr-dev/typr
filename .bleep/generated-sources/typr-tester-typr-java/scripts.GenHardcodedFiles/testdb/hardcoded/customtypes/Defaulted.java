/**
 * File automatically generated by `typo` for its own test suite.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN
 */
package testdb.hardcoded.customtypes;

import com.fasterxml.jackson.databind.annotation.JsonDeserialize;
import com.fasterxml.jackson.databind.annotation.JsonSerialize;
import testdb.hardcoded.DefaultedDeserializer;
import testdb.hardcoded.DefaultedSerializer;
import typr.runtime.PgText;

/** This signals a value where if you don't provide it, postgres will generate it for you */
@JsonSerialize(using = DefaultedSerializer.class)
@JsonDeserialize(using = DefaultedDeserializer.class)
public sealed interface Defaulted<T> permits Defaulted.Provided, Defaulted.UseDefault {
  record Provided<T>(T value) implements Defaulted<T> {
    public Provided<T> withValue(T value) {
      return new Provided<>(value);
    };

    @Override
    public <U>U fold(
      java.util.function.Supplier<U> onDefault,
      java.util.function.Function<T, U> onProvided
    ) {
      return onProvided.apply(value);
    };

    @Override
    public T getOrElse(java.util.function.Supplier<T> onDefault) {
      return value;
    };

    @Override
    public void visit(
      java.lang.Runnable onDefault,
      java.util.function.Consumer<T> onProvided
    ) {
      onProvided.accept(value);
    };
  };

  record UseDefault<T>() implements Defaulted<T> {
    @Override
    public <U>U fold(
      java.util.function.Supplier<U> onDefault,
      java.util.function.Function<T, U> onProvided
    ) {
      return onDefault.get();
    };

    @Override
    public T getOrElse(java.util.function.Supplier<T> onDefault) {
      return onDefault.get();
    };

    @Override
    public void visit(
      java.lang.Runnable onDefault,
      java.util.function.Consumer<T> onProvided
    ) {
      onDefault.run();
    };
  };

  static <T> PgText<Defaulted<T>> pgText(PgText<T> t) {
    return PgText.instance((ot, sb) -> ot.visit(() -> {
             sb.append("__DEFAULT_VALUE__");
           }, value -> t.unsafeEncode(value, sb)));
  };

  <U>U fold(
    java.util.function.Supplier<U> onDefault,
    java.util.function.Function<T, U> onProvided
  );

  T getOrElse(java.util.function.Supplier<T> onDefault);

  void visit(
    java.lang.Runnable onDefault,
    java.util.function.Consumer<T> onProvided
  );
}