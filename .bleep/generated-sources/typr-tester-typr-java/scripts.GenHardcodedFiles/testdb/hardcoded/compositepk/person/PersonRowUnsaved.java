/**
 * File automatically generated by `typo` for its own test suite.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN
 */
package testdb.hardcoded.compositepk.person;

import java.util.Optional;
import testdb.hardcoded.customtypes.Defaulted;
import testdb.hardcoded.customtypes.Defaulted.UseDefault;
import typr.runtime.PgText;
import typr.runtime.PgTypes;

/** This class corresponds to a row in table `compositepk.person` which has not been persisted yet */
public record PersonRowUnsaved(
  Optional<String> name,
  /** Default: auto-increment */
  Defaulted<Long> one,
  /** Default: auto-increment */
  Defaulted<Optional<String>> two
) {
  public PersonRowUnsaved() {
    this(Optional.empty(), new UseDefault<>(), new UseDefault<>());
  };

  public PersonRowUnsaved withName(Optional<String> name) {
    return new PersonRowUnsaved(name, one, two);
  };

  /** Default: auto-increment */
  public PersonRowUnsaved withOne(Defaulted<Long> one) {
    return new PersonRowUnsaved(name, one, two);
  };

  /** Default: auto-increment */
  public PersonRowUnsaved withTwo(Defaulted<Optional<String>> two) {
    return new PersonRowUnsaved(name, one, two);
  };

  static public PgText<PersonRowUnsaved> pgText =
    PgText.instance((row, sb) -> {
      PgTypes.text.opt().pgText().unsafeEncode(row.name, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(PgTypes.int8.pgText()).unsafeEncode(row.one, sb);
      sb.append(PgText.DELIMETER);
      Defaulted.pgText(PgTypes.text.opt().pgText()).unsafeEncode(row.two, sb);
    });

  public PersonRow toRow(
    java.util.function.Supplier<Long> oneDefault,
    java.util.function.Supplier<Optional<String>> twoDefault
  ) {
    return new PersonRow(one.getOrElse(oneDefault), two.getOrElse(twoDefault), name);
  };
}