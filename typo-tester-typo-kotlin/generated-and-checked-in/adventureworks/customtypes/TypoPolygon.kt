/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes

import com.fasterxml.jackson.annotation.JsonValue
import kotlin.collections.List
import org.postgresql.geometric.PGpoint
import org.postgresql.geometric.PGpolygon
import typo.dsl.Bijection
import typo.runtime.PgRead
import typo.runtime.PgText
import typo.runtime.PgType
import typo.runtime.PgWrite
import typo.runtime.internal.arrayMap
import typo.runtime.internal.stringInterpolator.str

/** Polygon datatype in PostgreSQL */
data class TypoPolygon(@JsonValue val points: List<TypoPoint>) {
  companion object {
    val bijection: Bijection<TypoPolygon, List<TypoPoint>> =
      Bijection.of(TypoPolygon::points, ::TypoPolygon)

    val pgText: PgText<TypoPolygon> =
      PgText.textString.contramap({ v -> "(" + v.points.map({ p -> str(p.x.toString(), ", ", p.y.toString(), "") }).joinToString(",") + ")" })

    val pgType: PgType<TypoPolygon> =
      PgType.of<TypoPolygon>(
        "polygon",
        PgRead.castJdbcObjectTo(PGpolygon::class.java).map({ v: PGpolygon -> TypoPolygon(v.points!!.map({ p -> TypoPoint(p.x, p.y) }).toList()) }),
        PgWrite.passObjectToJdbc<PGpolygon>().contramap({ v: TypoPolygon -> PGpolygon(v.points.map({ p -> PGpoint(p.x, p.y) }).toTypedArray()) }),
        TypoPolygon.pgText
      )

    val pgTypeArray: PgType<Array<TypoPolygon>> =
      TypoPolygon.pgType.array(PgRead.castJdbcArrayTo(PGpolygon::class.java).map({ xs: Array<PGpolygon> -> arrayMap.map(xs, { v: PGpolygon -> TypoPolygon(v.points!!.map({ p -> TypoPoint(p.x, p.y) }).toList()) }, TypoPolygon::class.java) }), PgWrite.passObjectToJdbc<PGpolygon>().array(TypoPolygon.pgType.typename().`as`<PGpolygon>()).contramap({ xs: Array<TypoPolygon> -> arrayMap.map(xs, { v: TypoPolygon -> PGpolygon(v.points.map({ p -> PGpoint(p.x, p.y) }).toTypedArray()) }, PGpolygon::class.java) }))
  }
}