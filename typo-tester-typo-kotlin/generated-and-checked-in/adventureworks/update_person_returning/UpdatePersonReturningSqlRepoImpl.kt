/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.update_person_returning

import adventureworks.customtypes.TypoLocalDateTime
import java.sql.Connection
import java.util.Optional
import kotlin.collections.List
import typo.runtime.PgTypes
import typo.runtime.Fragment.interpolate

class UpdatePersonReturningSqlRepoImpl() : UpdatePersonReturningSqlRepo {
  override fun apply(
    suffix: /* nullability unknown */ Optional<String>,
    cutoff: /* nullability unknown */ Optional<TypoLocalDateTime>,
    c: Connection
  ): List<UpdatePersonReturningSqlRow> = interpolate(
    typo.runtime.Fragment.lit("""
      with row as (
        update person.person
      set firstname = firstname || '-' || """.trimMargin()),
    PgTypes.text.opt().encode(suffix),
    typo.runtime.Fragment.lit("""
  
      where modifieddate < """.trimMargin()),
    TypoLocalDateTime.pgType.opt().encode(cutoff),
    typo.runtime.Fragment.lit("""
      ::timestamp
      returning firstname, modifieddate
      )
      select row."firstname", row."modifieddate"::text
      from row""".trimMargin())
  ).query(UpdatePersonReturningSqlRow._rowParser.all()).runUnchecked(c)
}