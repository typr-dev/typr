/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.person_detail

import adventureworks.customtypes.TypoLocalDateTime
import adventureworks.person.businessentity.BusinessentityId
import java.sql.Connection
import kotlin.collections.List
import typo.runtime.Fragment.interpolate

class PersonDetailSqlRepoImpl() : PersonDetailSqlRepo {
  override fun apply(
    businessentityid: /* user-picked */ BusinessentityId,
    modifiedAfter: TypoLocalDateTime,
    c: Connection
  ): List<PersonDetailSqlRow> = interpolate(
    typo.runtime.Fragment.lit("""
      SELECT s.businessentityid,
             p.title,
             p.firstname,
             p.middlename,
             p.lastname,
             e.jobtitle,
             a.addressline1,
             a.city,
             a.postalcode,
             a.rowguid
      FROM sales.salesperson s
               JOIN humanresources.employee e ON e.businessentityid = s.businessentityid
               JOIN person.person p ON p.businessentityid = s.businessentityid
               JOIN person.businessentityaddress bea ON bea.businessentityid = s.businessentityid
               LEFT JOIN person.address a ON a.addressid = bea.addressid
      where s.businessentityid = """.trimMargin()),
    /* user-picked */ BusinessentityId.pgType.encode(businessentityid),
    typo.runtime.Fragment.lit("""
      ::int4
        and p.modifieddate > """.trimMargin()),
    TypoLocalDateTime.pgType.encode(modifiedAfter),
    typo.runtime.Fragment.lit("::timestamp")
  ).query(PersonDetailSqlRow._rowParser.all()).runUnchecked(c)
}