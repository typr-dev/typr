/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.sales.salesorderheader

import adventureworks.customtypes.TypoLocalDateTime
import adventureworks.customtypes.TypoShort
import adventureworks.customtypes.TypoUUID
import adventureworks.person.address.AddressId
import adventureworks.person.businessentity.BusinessentityId
import adventureworks.public.AccountNumber
import adventureworks.public.Flag
import adventureworks.public.OrderNumber
import adventureworks.purchasing.shipmethod.ShipmethodId
import adventureworks.sales.currencyrate.CurrencyrateId
import adventureworks.sales.customer.CustomerId
import adventureworks.sales.salesterritory.SalesterritoryId
import adventureworks.userdefined.CustomCreditcardId
import java.sql.Connection
import java.util.ArrayList
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableIterator
import kotlin.collections.MutableMap
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.PgTypes
import typo.runtime.streamingInsert
import typo.runtime.Fragment.interpolate
import typo.runtime.internal.stringInterpolator.str

class SalesorderheaderRepoImpl() : SalesorderheaderRepo {
  override fun delete(): DeleteBuilder<SalesorderheaderFields, SalesorderheaderRow> = DeleteBuilder.of("\"sales\".\"salesorderheader\"", SalesorderheaderFields.structure, Dialect.POSTGRESQL)

  override fun deleteById(
    salesorderid: SalesorderheaderId,
    c: Connection
  ): Boolean = interpolate(
    typo.runtime.Fragment.lit("""
    delete from "sales"."salesorderheader" where "salesorderid" = 
    """.trimMargin()),
    SalesorderheaderId.pgType.encode(salesorderid),
    typo.runtime.Fragment.lit("")
  ).update().runUnchecked(c) > 0

  override fun deleteByIds(
    salesorderids: Array<SalesorderheaderId>,
    c: Connection
  ): Int = interpolate(
             typo.runtime.Fragment.lit("""
               delete
               from "sales"."salesorderheader"
               where "salesorderid" = ANY(""".trimMargin()),
             SalesorderheaderId.pgTypeArray.encode(salesorderids),
             typo.runtime.Fragment.lit(")")
           )
    .update()
    .runUnchecked(c)

  override fun insert(
    unsaved: SalesorderheaderRow,
    c: Connection
  ): SalesorderheaderRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
      values (""".trimMargin()),
    SalesorderheaderId.pgType.encode(unsaved.salesorderid),
    typo.runtime.Fragment.lit("::int4, "),
    TypoShort.pgType.encode(unsaved.revisionnumber),
    typo.runtime.Fragment.lit("::int2, "),
    TypoLocalDateTime.pgType.encode(unsaved.orderdate),
    typo.runtime.Fragment.lit("::timestamp, "),
    TypoLocalDateTime.pgType.encode(unsaved.duedate),
    typo.runtime.Fragment.lit("::timestamp, "),
    TypoLocalDateTime.pgType.opt().encode(unsaved.shipdate),
    typo.runtime.Fragment.lit("::timestamp, "),
    TypoShort.pgType.encode(unsaved.status),
    typo.runtime.Fragment.lit("::int2, "),
    Flag.pgType.encode(unsaved.onlineorderflag),
    typo.runtime.Fragment.lit("::bool, "),
    OrderNumber.pgType.opt().encode(unsaved.purchaseordernumber),
    typo.runtime.Fragment.lit("::varchar, "),
    AccountNumber.pgType.opt().encode(unsaved.accountnumber),
    typo.runtime.Fragment.lit("::varchar, "),
    CustomerId.pgType.encode(unsaved.customerid),
    typo.runtime.Fragment.lit("::int4, "),
    BusinessentityId.pgType.opt().encode(unsaved.salespersonid),
    typo.runtime.Fragment.lit("::int4, "),
    SalesterritoryId.pgType.opt().encode(unsaved.territoryid),
    typo.runtime.Fragment.lit("::int4, "),
    AddressId.pgType.encode(unsaved.billtoaddressid),
    typo.runtime.Fragment.lit("::int4, "),
    AddressId.pgType.encode(unsaved.shiptoaddressid),
    typo.runtime.Fragment.lit("::int4, "),
    ShipmethodId.pgType.encode(unsaved.shipmethodid),
    typo.runtime.Fragment.lit("::int4, "),
    CustomCreditcardId.pgType.opt().encode(unsaved.creditcardid),
    typo.runtime.Fragment.lit("::int4, "),
    PgTypes.text.opt().encode(unsaved.creditcardapprovalcode),
    typo.runtime.Fragment.lit(", "),
    CurrencyrateId.pgType.opt().encode(unsaved.currencyrateid),
    typo.runtime.Fragment.lit("::int4, "),
    PgTypes.numeric.encode(unsaved.subtotal),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.numeric.encode(unsaved.taxamt),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.numeric.encode(unsaved.freight),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.numeric.opt().encode(unsaved.totaldue),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.text.opt().encode(unsaved.comment),
    typo.runtime.Fragment.lit(", "),
    TypoUUID.pgType.encode(unsaved.rowguid),
    typo.runtime.Fragment.lit("::uuid, "),
    TypoLocalDateTime.pgType.encode(unsaved.modifieddate),
    typo.runtime.Fragment.lit("""
      ::timestamp)
      returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
    """.trimMargin())
  )
    .updateReturning(SalesorderheaderRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: SalesorderheaderRowUnsaved,
    c: Connection
  ): SalesorderheaderRow {
    val columns: ArrayList<Literal> = ArrayList<Literal>()
    val values: ArrayList<Fragment> = ArrayList<Fragment>()
    columns.add(Fragment.lit("\"duedate\""))
    values.add(interpolate(
      TypoLocalDateTime.pgType.encode(unsaved.duedate),
      typo.runtime.Fragment.lit("::timestamp")
    ))
    columns.add(Fragment.lit("\"shipdate\""))
    values.add(interpolate(
      TypoLocalDateTime.pgType.opt().encode(unsaved.shipdate),
      typo.runtime.Fragment.lit("::timestamp")
    ))
    columns.add(Fragment.lit("\"purchaseordernumber\""))
    values.add(interpolate(
      OrderNumber.pgType.opt().encode(unsaved.purchaseordernumber),
      typo.runtime.Fragment.lit("::varchar")
    ))
    columns.add(Fragment.lit("\"accountnumber\""))
    values.add(interpolate(
      AccountNumber.pgType.opt().encode(unsaved.accountnumber),
      typo.runtime.Fragment.lit("::varchar")
    ))
    columns.add(Fragment.lit("\"customerid\""))
    values.add(interpolate(
      CustomerId.pgType.encode(unsaved.customerid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"salespersonid\""))
    values.add(interpolate(
      BusinessentityId.pgType.opt().encode(unsaved.salespersonid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"territoryid\""))
    values.add(interpolate(
      SalesterritoryId.pgType.opt().encode(unsaved.territoryid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"billtoaddressid\""))
    values.add(interpolate(
      AddressId.pgType.encode(unsaved.billtoaddressid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"shiptoaddressid\""))
    values.add(interpolate(
      AddressId.pgType.encode(unsaved.shiptoaddressid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"shipmethodid\""))
    values.add(interpolate(
      ShipmethodId.pgType.encode(unsaved.shipmethodid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"creditcardid\""))
    values.add(interpolate(
      CustomCreditcardId.pgType.opt().encode(unsaved.creditcardid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"creditcardapprovalcode\""))
    values.add(interpolate(
      PgTypes.text.opt().encode(unsaved.creditcardapprovalcode),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("\"currencyrateid\""))
    values.add(interpolate(
      CurrencyrateId.pgType.opt().encode(unsaved.currencyrateid),
      typo.runtime.Fragment.lit("::int4")
    ))
    columns.add(Fragment.lit("\"totaldue\""))
    values.add(interpolate(
      PgTypes.numeric.opt().encode(unsaved.totaldue),
      typo.runtime.Fragment.lit("::numeric")
    ))
    columns.add(Fragment.lit("\"comment\""))
    values.add(interpolate(
      PgTypes.text.opt().encode(unsaved.comment),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    unsaved.salesorderid.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"salesorderid\""))
      values.add(interpolate(
        SalesorderheaderId.pgType.encode(value),
        typo.runtime.Fragment.lit("::int4")
      )) }
    );
    unsaved.revisionnumber.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"revisionnumber\""))
      values.add(interpolate(
        TypoShort.pgType.encode(value),
        typo.runtime.Fragment.lit("::int2")
      )) }
    );
    unsaved.orderdate.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"orderdate\""))
      values.add(interpolate(
        TypoLocalDateTime.pgType.encode(value),
        typo.runtime.Fragment.lit("::timestamp")
      )) }
    );
    unsaved.status.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"status\""))
      values.add(interpolate(
        TypoShort.pgType.encode(value),
        typo.runtime.Fragment.lit("::int2")
      )) }
    );
    unsaved.onlineorderflag.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"onlineorderflag\""))
      values.add(interpolate(
        Flag.pgType.encode(value),
        typo.runtime.Fragment.lit("::bool")
      )) }
    );
    unsaved.subtotal.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"subtotal\""))
      values.add(interpolate(
        PgTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("::numeric")
      )) }
    );
    unsaved.taxamt.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"taxamt\""))
      values.add(interpolate(
        PgTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("::numeric")
      )) }
    );
    unsaved.freight.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"freight\""))
      values.add(interpolate(
        PgTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("::numeric")
      )) }
    );
    unsaved.rowguid.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"rowguid\""))
      values.add(interpolate(
        TypoUUID.pgType.encode(value),
        typo.runtime.Fragment.lit("::uuid")
      )) }
    );
    unsaved.modifieddate.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"modifieddate\""))
      values.add(interpolate(
        TypoLocalDateTime.pgType.encode(value),
        typo.runtime.Fragment.lit("::timestamp")
      )) }
    );
    val q: Fragment = interpolate(
      typo.runtime.Fragment.lit("""
      insert into "sales"."salesorderheader"(
      """.trimMargin()),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
        )
        values (""".trimMargin()),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
        )
        returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
      """.trimMargin())
    )
    return q.updateReturning(SalesorderheaderRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun insertStreaming(
    unsaved: MutableIterator<SalesorderheaderRow>,
    batchSize: Int,
    c: Connection
  ): Long = streamingInsert.insertUnchecked(str("""
  COPY "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate") FROM STDIN
  """.trimMargin()), batchSize, unsaved, c, SalesorderheaderRow.pgText)

  /** NOTE: this functionality requires PostgreSQL 16 or later! */
  override fun insertUnsavedStreaming(
    unsaved: MutableIterator<SalesorderheaderRowUnsaved>,
    batchSize: Int,
    c: Connection
  ): Long = streamingInsert.insertUnchecked(str("""
  COPY "sales"."salesorderheader"("duedate", "shipdate", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "totaldue", "comment", "salesorderid", "revisionnumber", "orderdate", "status", "onlineorderflag", "subtotal", "taxamt", "freight", "rowguid", "modifieddate") FROM STDIN (DEFAULT '__DEFAULT_VALUE__')
  """.trimMargin()), batchSize, unsaved, c, SalesorderheaderRowUnsaved.pgText)

  override fun select(): SelectBuilder<SalesorderheaderFields, SalesorderheaderRow> = SelectBuilder.of("\"sales\".\"salesorderheader\"", SalesorderheaderFields.structure, SalesorderheaderRow._rowParser, Dialect.POSTGRESQL)

  override fun selectAll(c: Connection): List<SalesorderheaderRow> = interpolate(typo.runtime.Fragment.lit("""
    select "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
    from "sales"."salesorderheader"
  """.trimMargin())).query(SalesorderheaderRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    salesorderid: SalesorderheaderId,
    c: Connection
  ): Optional<SalesorderheaderRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
      from "sales"."salesorderheader"
      where "salesorderid" = """.trimMargin()),
    SalesorderheaderId.pgType.encode(salesorderid),
    typo.runtime.Fragment.lit("")
  ).query(SalesorderheaderRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    salesorderids: Array<SalesorderheaderId>,
    c: Connection
  ): List<SalesorderheaderRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text
      from "sales"."salesorderheader"
      where "salesorderid" = ANY(""".trimMargin()),
    SalesorderheaderId.pgTypeArray.encode(salesorderids),
    typo.runtime.Fragment.lit(")")
  ).query(SalesorderheaderRow._rowParser.all()).runUnchecked(c)

  override fun selectByIdsTracked(
    salesorderids: Array<SalesorderheaderId>,
    c: Connection
  ): Map<SalesorderheaderId, SalesorderheaderRow> {
    val ret: MutableMap<SalesorderheaderId, SalesorderheaderRow> = mutableMapOf<SalesorderheaderId, SalesorderheaderRow>()
    selectByIds(salesorderids, c).forEach({ row -> ret.put(row.salesorderid, row) })
    return ret
  }

  override fun update(): UpdateBuilder<SalesorderheaderFields, SalesorderheaderRow> = UpdateBuilder.of("\"sales\".\"salesorderheader\"", SalesorderheaderFields.structure, SalesorderheaderRow._rowParser.all(), Dialect.POSTGRESQL)

  override fun update(
    row: SalesorderheaderRow,
    c: Connection
  ): Boolean {
    val salesorderid: SalesorderheaderId = row.salesorderid
    return interpolate(
      typo.runtime.Fragment.lit("""
        update "sales"."salesorderheader"
        set "revisionnumber" = """.trimMargin()),
      TypoShort.pgType.encode(row.revisionnumber),
      typo.runtime.Fragment.lit("""
        ::int2,
        "orderdate" = """.trimMargin()),
      TypoLocalDateTime.pgType.encode(row.orderdate),
      typo.runtime.Fragment.lit("""
        ::timestamp,
        "duedate" = """.trimMargin()),
      TypoLocalDateTime.pgType.encode(row.duedate),
      typo.runtime.Fragment.lit("""
        ::timestamp,
        "shipdate" = """.trimMargin()),
      TypoLocalDateTime.pgType.opt().encode(row.shipdate),
      typo.runtime.Fragment.lit("""
        ::timestamp,
        "status" = """.trimMargin()),
      TypoShort.pgType.encode(row.status),
      typo.runtime.Fragment.lit("""
        ::int2,
        "onlineorderflag" = """.trimMargin()),
      Flag.pgType.encode(row.onlineorderflag),
      typo.runtime.Fragment.lit("""
        ::bool,
        "purchaseordernumber" = """.trimMargin()),
      OrderNumber.pgType.opt().encode(row.purchaseordernumber),
      typo.runtime.Fragment.lit("""
        ::varchar,
        "accountnumber" = """.trimMargin()),
      AccountNumber.pgType.opt().encode(row.accountnumber),
      typo.runtime.Fragment.lit("""
        ::varchar,
        "customerid" = """.trimMargin()),
      CustomerId.pgType.encode(row.customerid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "salespersonid" = """.trimMargin()),
      BusinessentityId.pgType.opt().encode(row.salespersonid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "territoryid" = """.trimMargin()),
      SalesterritoryId.pgType.opt().encode(row.territoryid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "billtoaddressid" = """.trimMargin()),
      AddressId.pgType.encode(row.billtoaddressid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "shiptoaddressid" = """.trimMargin()),
      AddressId.pgType.encode(row.shiptoaddressid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "shipmethodid" = """.trimMargin()),
      ShipmethodId.pgType.encode(row.shipmethodid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "creditcardid" = """.trimMargin()),
      CustomCreditcardId.pgType.opt().encode(row.creditcardid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "creditcardapprovalcode" = """.trimMargin()),
      PgTypes.text.opt().encode(row.creditcardapprovalcode),
      typo.runtime.Fragment.lit("""
        ,
        "currencyrateid" = """.trimMargin()),
      CurrencyrateId.pgType.opt().encode(row.currencyrateid),
      typo.runtime.Fragment.lit("""
        ::int4,
        "subtotal" = """.trimMargin()),
      PgTypes.numeric.encode(row.subtotal),
      typo.runtime.Fragment.lit("""
        ::numeric,
        "taxamt" = """.trimMargin()),
      PgTypes.numeric.encode(row.taxamt),
      typo.runtime.Fragment.lit("""
        ::numeric,
        "freight" = """.trimMargin()),
      PgTypes.numeric.encode(row.freight),
      typo.runtime.Fragment.lit("""
        ::numeric,
        "totaldue" = """.trimMargin()),
      PgTypes.numeric.opt().encode(row.totaldue),
      typo.runtime.Fragment.lit("""
        ::numeric,
        "comment" = """.trimMargin()),
      PgTypes.text.opt().encode(row.comment),
      typo.runtime.Fragment.lit("""
        ,
        "rowguid" = """.trimMargin()),
      TypoUUID.pgType.encode(row.rowguid),
      typo.runtime.Fragment.lit("""
        ::uuid,
        "modifieddate" = """.trimMargin()),
      TypoLocalDateTime.pgType.encode(row.modifieddate),
      typo.runtime.Fragment.lit("""
        ::timestamp
        where "salesorderid" = """.trimMargin()),
      SalesorderheaderId.pgType.encode(salesorderid),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0
  }

  override fun upsert(
    unsaved: SalesorderheaderRow,
    c: Connection
  ): SalesorderheaderRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
      values (""".trimMargin()),
    SalesorderheaderId.pgType.encode(unsaved.salesorderid),
    typo.runtime.Fragment.lit("::int4, "),
    TypoShort.pgType.encode(unsaved.revisionnumber),
    typo.runtime.Fragment.lit("::int2, "),
    TypoLocalDateTime.pgType.encode(unsaved.orderdate),
    typo.runtime.Fragment.lit("::timestamp, "),
    TypoLocalDateTime.pgType.encode(unsaved.duedate),
    typo.runtime.Fragment.lit("::timestamp, "),
    TypoLocalDateTime.pgType.opt().encode(unsaved.shipdate),
    typo.runtime.Fragment.lit("::timestamp, "),
    TypoShort.pgType.encode(unsaved.status),
    typo.runtime.Fragment.lit("::int2, "),
    Flag.pgType.encode(unsaved.onlineorderflag),
    typo.runtime.Fragment.lit("::bool, "),
    OrderNumber.pgType.opt().encode(unsaved.purchaseordernumber),
    typo.runtime.Fragment.lit("::varchar, "),
    AccountNumber.pgType.opt().encode(unsaved.accountnumber),
    typo.runtime.Fragment.lit("::varchar, "),
    CustomerId.pgType.encode(unsaved.customerid),
    typo.runtime.Fragment.lit("::int4, "),
    BusinessentityId.pgType.opt().encode(unsaved.salespersonid),
    typo.runtime.Fragment.lit("::int4, "),
    SalesterritoryId.pgType.opt().encode(unsaved.territoryid),
    typo.runtime.Fragment.lit("::int4, "),
    AddressId.pgType.encode(unsaved.billtoaddressid),
    typo.runtime.Fragment.lit("::int4, "),
    AddressId.pgType.encode(unsaved.shiptoaddressid),
    typo.runtime.Fragment.lit("::int4, "),
    ShipmethodId.pgType.encode(unsaved.shipmethodid),
    typo.runtime.Fragment.lit("::int4, "),
    CustomCreditcardId.pgType.opt().encode(unsaved.creditcardid),
    typo.runtime.Fragment.lit("::int4, "),
    PgTypes.text.opt().encode(unsaved.creditcardapprovalcode),
    typo.runtime.Fragment.lit(", "),
    CurrencyrateId.pgType.opt().encode(unsaved.currencyrateid),
    typo.runtime.Fragment.lit("::int4, "),
    PgTypes.numeric.encode(unsaved.subtotal),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.numeric.encode(unsaved.taxamt),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.numeric.encode(unsaved.freight),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.numeric.opt().encode(unsaved.totaldue),
    typo.runtime.Fragment.lit("::numeric, "),
    PgTypes.text.opt().encode(unsaved.comment),
    typo.runtime.Fragment.lit(", "),
    TypoUUID.pgType.encode(unsaved.rowguid),
    typo.runtime.Fragment.lit("::uuid, "),
    TypoLocalDateTime.pgType.encode(unsaved.modifieddate),
    typo.runtime.Fragment.lit("""
      ::timestamp)
      on conflict ("salesorderid")
      do update set
        "revisionnumber" = EXCLUDED."revisionnumber",
      "orderdate" = EXCLUDED."orderdate",
      "duedate" = EXCLUDED."duedate",
      "shipdate" = EXCLUDED."shipdate",
      "status" = EXCLUDED."status",
      "onlineorderflag" = EXCLUDED."onlineorderflag",
      "purchaseordernumber" = EXCLUDED."purchaseordernumber",
      "accountnumber" = EXCLUDED."accountnumber",
      "customerid" = EXCLUDED."customerid",
      "salespersonid" = EXCLUDED."salespersonid",
      "territoryid" = EXCLUDED."territoryid",
      "billtoaddressid" = EXCLUDED."billtoaddressid",
      "shiptoaddressid" = EXCLUDED."shiptoaddressid",
      "shipmethodid" = EXCLUDED."shipmethodid",
      "creditcardid" = EXCLUDED."creditcardid",
      "creditcardapprovalcode" = EXCLUDED."creditcardapprovalcode",
      "currencyrateid" = EXCLUDED."currencyrateid",
      "subtotal" = EXCLUDED."subtotal",
      "taxamt" = EXCLUDED."taxamt",
      "freight" = EXCLUDED."freight",
      "totaldue" = EXCLUDED."totaldue",
      "comment" = EXCLUDED."comment",
      "rowguid" = EXCLUDED."rowguid",
      "modifieddate" = EXCLUDED."modifieddate"
      returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text""".trimMargin())
  )
    .updateReturning(SalesorderheaderRow._rowParser.exactlyOne())
    .runUnchecked(c)

  override fun upsertBatch(
    unsaved: MutableIterator<SalesorderheaderRow>,
    c: Connection
  ): List<SalesorderheaderRow> = interpolate(typo.runtime.Fragment.lit("""
                                   insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
                                   values (?::int4, ?::int2, ?::timestamp, ?::timestamp, ?::timestamp, ?::int2, ?::bool, ?::varchar, ?::varchar, ?::int4, ?::int4, ?::int4, ?::int4, ?::int4, ?::int4, ?::int4, ?, ?::int4, ?::numeric, ?::numeric, ?::numeric, ?::numeric, ?, ?::uuid, ?::timestamp)
                                   on conflict ("salesorderid")
                                   do update set
                                     "revisionnumber" = EXCLUDED."revisionnumber",
                                   "orderdate" = EXCLUDED."orderdate",
                                   "duedate" = EXCLUDED."duedate",
                                   "shipdate" = EXCLUDED."shipdate",
                                   "status" = EXCLUDED."status",
                                   "onlineorderflag" = EXCLUDED."onlineorderflag",
                                   "purchaseordernumber" = EXCLUDED."purchaseordernumber",
                                   "accountnumber" = EXCLUDED."accountnumber",
                                   "customerid" = EXCLUDED."customerid",
                                   "salespersonid" = EXCLUDED."salespersonid",
                                   "territoryid" = EXCLUDED."territoryid",
                                   "billtoaddressid" = EXCLUDED."billtoaddressid",
                                   "shiptoaddressid" = EXCLUDED."shiptoaddressid",
                                   "shipmethodid" = EXCLUDED."shipmethodid",
                                   "creditcardid" = EXCLUDED."creditcardid",
                                   "creditcardapprovalcode" = EXCLUDED."creditcardapprovalcode",
                                   "currencyrateid" = EXCLUDED."currencyrateid",
                                   "subtotal" = EXCLUDED."subtotal",
                                   "taxamt" = EXCLUDED."taxamt",
                                   "freight" = EXCLUDED."freight",
                                   "totaldue" = EXCLUDED."totaldue",
                                   "comment" = EXCLUDED."comment",
                                   "rowguid" = EXCLUDED."rowguid",
                                   "modifieddate" = EXCLUDED."modifieddate"
                                   returning "salesorderid", "revisionnumber", "orderdate"::text, "duedate"::text, "shipdate"::text, "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate"::text""".trimMargin()))
    .updateManyReturning(SalesorderheaderRow._rowParser, unsaved)
    .runUnchecked(c)

  /** NOTE: this functionality is not safe if you use auto-commit mode! it runs 3 SQL statements */
  override fun upsertStreaming(
    unsaved: MutableIterator<SalesorderheaderRow>,
    batchSize: Int,
    c: Connection
  ): Int {
    interpolate(typo.runtime.Fragment.lit("""
    create temporary table salesorderheader_TEMP (like "sales"."salesorderheader") on commit drop
    """.trimMargin())).update().runUnchecked(c)
    streamingInsert.insertUnchecked(str("""
    copy salesorderheader_TEMP("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate") from stdin
    """.trimMargin()), batchSize, unsaved, c, SalesorderheaderRow.pgText)
    return interpolate(typo.runtime.Fragment.lit("""
      insert into "sales"."salesorderheader"("salesorderid", "revisionnumber", "orderdate", "duedate", "shipdate", "status", "onlineorderflag", "purchaseordernumber", "accountnumber", "customerid", "salespersonid", "territoryid", "billtoaddressid", "shiptoaddressid", "shipmethodid", "creditcardid", "creditcardapprovalcode", "currencyrateid", "subtotal", "taxamt", "freight", "totaldue", "comment", "rowguid", "modifieddate")
      select * from salesorderheader_TEMP
      on conflict ("salesorderid")
      do update set
        "revisionnumber" = EXCLUDED."revisionnumber",
      "orderdate" = EXCLUDED."orderdate",
      "duedate" = EXCLUDED."duedate",
      "shipdate" = EXCLUDED."shipdate",
      "status" = EXCLUDED."status",
      "onlineorderflag" = EXCLUDED."onlineorderflag",
      "purchaseordernumber" = EXCLUDED."purchaseordernumber",
      "accountnumber" = EXCLUDED."accountnumber",
      "customerid" = EXCLUDED."customerid",
      "salespersonid" = EXCLUDED."salespersonid",
      "territoryid" = EXCLUDED."territoryid",
      "billtoaddressid" = EXCLUDED."billtoaddressid",
      "shiptoaddressid" = EXCLUDED."shiptoaddressid",
      "shipmethodid" = EXCLUDED."shipmethodid",
      "creditcardid" = EXCLUDED."creditcardid",
      "creditcardapprovalcode" = EXCLUDED."creditcardapprovalcode",
      "currencyrateid" = EXCLUDED."currencyrateid",
      "subtotal" = EXCLUDED."subtotal",
      "taxamt" = EXCLUDED."taxamt",
      "freight" = EXCLUDED."freight",
      "totaldue" = EXCLUDED."totaldue",
      "comment" = EXCLUDED."comment",
      "rowguid" = EXCLUDED."rowguid",
      "modifieddate" = EXCLUDED."modifieddate"
      ;
      drop table salesorderheader_TEMP;""".trimMargin())).update().runUnchecked(c)
  }
}