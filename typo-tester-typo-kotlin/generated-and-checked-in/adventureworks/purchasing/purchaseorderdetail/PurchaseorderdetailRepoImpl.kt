/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId
import java.sql.Connection
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableMap
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.runtime.PgTypes
import typo.runtime.internal.arrayMap
import typo.runtime.Fragment.interpolate

class PurchaseorderdetailRepoImpl() : PurchaseorderdetailRepo {
  override fun select(): SelectBuilder<PurchaseorderdetailFields, PurchaseorderdetailRow> = SelectBuilder.of("\"purchasing\".\"purchaseorderdetail\"", PurchaseorderdetailFields.structure, PurchaseorderdetailRow._rowParser, Dialect.POSTGRESQL)

  override fun selectAll(c: Connection): List<PurchaseorderdetailRow> = interpolate(typo.runtime.Fragment.lit("""
    select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
    from "purchasing"."purchaseorderdetail"
  """.trimMargin())).query(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    compositeId: PurchaseorderdetailId,
    c: Connection
  ): Optional<PurchaseorderdetailRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
      from "purchasing"."purchaseorderdetail"
      where "purchaseorderid" = """.trimMargin()),
    PurchaseorderheaderId.pgType.encode(compositeId.purchaseorderid),
    typo.runtime.Fragment.lit("""
     AND "purchaseorderdetailid" = 
    """.trimMargin()),
    PgTypes.int4.encode(compositeId.purchaseorderdetailid),
    typo.runtime.Fragment.lit("")
  ).query(PurchaseorderdetailRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    compositeIds: Array<PurchaseorderdetailId>,
    c: Connection
  ): List<PurchaseorderdetailRow> {
    val purchaseorderid: Array<PurchaseorderheaderId> = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderid, PurchaseorderheaderId::class.java)
    val purchaseorderdetailid: Array<Int> = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderdetailid, Int::class.javaObjectType)
    return interpolate(
      typo.runtime.Fragment.lit("""
        select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
        from "purchasing"."purchaseorderdetail"
        where ("purchaseorderid", "purchaseorderdetailid")
        in (select unnest(""".trimMargin()),
      PurchaseorderheaderId.pgTypeArray.encode(purchaseorderid),
      typo.runtime.Fragment.lit("::int4[]), unnest("),
      PgTypes.int4Array.encode(purchaseorderdetailid),
      typo.runtime.Fragment.lit("""
      ::int4[]))

      """.trimMargin())
    ).query(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    compositeIds: Array<PurchaseorderdetailId>,
    c: Connection
  ): Map<PurchaseorderdetailId, PurchaseorderdetailRow> {
    val ret: MutableMap<PurchaseorderdetailId, PurchaseorderdetailRow> = mutableMapOf<PurchaseorderdetailId, PurchaseorderdetailRow>()
    selectByIds(compositeIds, c).forEach({ row -> ret.put(row.compositeId(), row) })
    return ret
  }
}