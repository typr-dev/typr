/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.titledperson

import adventureworks.public.title.TitleId
import adventureworks.public.title_domain.TitleDomainId
import java.sql.Connection
import kotlin.collections.Iterator
import kotlin.collections.List
import typo.kotlindsl.DeleteBuilder
import typo.kotlindsl.Dialect
import typo.kotlindsl.Fragment
import typo.kotlindsl.SelectBuilder
import typo.kotlindsl.UpdateBuilder
import typo.runtime.PgTypes
import typo.runtime.streamingInsert

class TitledpersonRepoImpl() : TitledpersonRepo {
  override fun delete(): DeleteBuilder<TitledpersonFields, TitledpersonRow> = DeleteBuilder.of("\"public\".\"titledperson\"", TitledpersonFields.structure, Dialect.POSTGRESQL)

  override fun insert(
    unsaved: TitledpersonRow,
    c: Connection
  ): TitledpersonRow = Fragment.interpolate(Fragment.lit("insert into \"public\".\"titledperson\"(\"title_short\", \"title\", \"name\")\nvalues ("), Fragment.encode(TitleDomainId.pgType, unsaved.titleShort), Fragment.lit("::text, "), Fragment.encode(TitleId.pgType, unsaved.title), Fragment.lit(", "), Fragment.encode(PgTypes.text, unsaved.name), Fragment.lit(")\nreturning \"title_short\", \"title\", \"name\"\n"))
    .updateReturning(TitledpersonRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insertStreaming(
    unsaved: Iterator<TitledpersonRow>,
    batchSize: Int,
    c: Connection
  ): Long = streamingInsert.insertUnchecked("COPY \"public\".\"titledperson\"(\"title_short\", \"title\", \"name\") FROM STDIN", batchSize, unsaved, c, TitledpersonRow.pgText)

  override fun select(): SelectBuilder<TitledpersonFields, TitledpersonRow> = SelectBuilder.of("\"public\".\"titledperson\"", TitledpersonFields.structure, TitledpersonRow._rowParser, Dialect.POSTGRESQL)

  override fun selectAll(c: Connection): List<TitledpersonRow> = Fragment.interpolate(Fragment.lit("select \"title_short\", \"title\", \"name\"\nfrom \"public\".\"titledperson\"\n")).query(TitledpersonRow._rowParser.all()).runUnchecked(c)

  override fun update(): UpdateBuilder<TitledpersonFields, TitledpersonRow> = UpdateBuilder.of("\"public\".\"titledperson\"", TitledpersonFields.structure, TitledpersonRow._rowParser, Dialect.POSTGRESQL)
}