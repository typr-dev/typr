/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.titledperson

import adventureworks.public.title.TitleId
import adventureworks.public.title_domain.TitleDomainId
import java.sql.Connection
import kotlin.collections.List
import kotlin.collections.MutableIterator
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.PgTypes
import typo.runtime.streamingInsert
import typo.runtime.Fragment.interpolate
import typo.runtime.internal.stringInterpolator.str

class TitledpersonRepoImpl() : TitledpersonRepo {
  override fun delete(): DeleteBuilder<TitledpersonFields, TitledpersonRow> = DeleteBuilder.of("\"public\".\"titledperson\"", TitledpersonFields.structure, Dialect.POSTGRESQL)

  override fun insert(
    unsaved: TitledpersonRow,
    c: Connection
  ): TitledpersonRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into "public"."titledperson"("title_short", "title", "name")
      values (""".trimMargin()),
    TitleDomainId.pgType.encode(unsaved.titleShort),
    typo.runtime.Fragment.lit("::text, "),
    TitleId.pgType.encode(unsaved.title),
    typo.runtime.Fragment.lit(", "),
    PgTypes.text.encode(unsaved.name),
    typo.runtime.Fragment.lit("""
      )
      returning "title_short", "title", "name"
    """.trimMargin())
  )
    .updateReturning(TitledpersonRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insertStreaming(
    unsaved: MutableIterator<TitledpersonRow>,
    batchSize: Int,
    c: Connection
  ): Long = streamingInsert.insertUnchecked(str("""
  COPY "public"."titledperson"("title_short", "title", "name") FROM STDIN
  """.trimMargin()), batchSize, unsaved, c, TitledpersonRow.pgText)

  override fun select(): SelectBuilder<TitledpersonFields, TitledpersonRow> = SelectBuilder.of("\"public\".\"titledperson\"", TitledpersonFields.structure, TitledpersonRow._rowParser, Dialect.POSTGRESQL)

  override fun selectAll(c: Connection): List<TitledpersonRow> = interpolate(typo.runtime.Fragment.lit("""
    select "title_short", "title", "name"
    from "public"."titledperson"
  """.trimMargin())).query(TitledpersonRow._rowParser.all()).runUnchecked(c)

  override fun update(): UpdateBuilder<TitledpersonFields, TitledpersonRow> = UpdateBuilder.of("\"public\".\"titledperson\"", TitledpersonFields.structure, TitledpersonRow._rowParser.all(), Dialect.POSTGRESQL)
}