/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes

import adventureworks.DefaultedDeserializer
import adventureworks.DefaultedSerializer
import com.fasterxml.jackson.databind.annotation.JsonDeserialize
import com.fasterxml.jackson.databind.annotation.JsonSerialize
import typr.runtime.PgText

@JsonSerialize(using = DefaultedSerializer::class)
@JsonDeserialize(using = DefaultedDeserializer::class)
/** This signals a value where if you don't provide it, postgres will generate it for you */
sealed interface Defaulted<T> {
  data class Provided<T>(val value: T) : Defaulted<T> {
    override fun <U>fold(
      onDefault: () -> U,
      onProvided: (T) -> U
    ): U = onProvided(value)

    override fun getOrElse(onDefault: () -> T): T = value

    override fun visit(
      onDefault: () -> Unit,
      onProvided: (T) -> Unit
    ) {
      onProvided(value)
    }
  }

  class UseDefault<T> : Defaulted<T> {
    override fun <U>fold(
      onDefault: () -> U,
      onProvided: (T) -> U
    ): U = onDefault()

    override fun getOrElse(onDefault: () -> T): T = onDefault()

    override fun visit(
      onDefault: () -> Unit,
      onProvided: (T) -> Unit
    ) {
      onDefault()
    }
  }

  companion object {
    fun <T> pgText(t: PgText<T>): PgText<Defaulted<T>> {
      return PgText.instance({ ot, sb -> ot.visit({ sb.append("__DEFAULT_VALUE__") }, { value -> t.unsafeEncode(value, sb) }) })
    }
  }

  abstract fun <U>fold(
    onDefault: () -> U,
    onProvided: (T) -> U
  ): U

  abstract fun getOrElse(onDefault: () -> T): T

  abstract fun visit(
    onDefault: () -> Unit,
    onProvided: (T) -> Unit
  )
}