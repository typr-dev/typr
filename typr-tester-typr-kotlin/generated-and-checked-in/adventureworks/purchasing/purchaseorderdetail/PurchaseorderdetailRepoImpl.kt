/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId
import java.sql.Connection
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableMap
import typr.kotlindsl.Dialect
import typr.kotlindsl.Fragment
import typr.kotlindsl.KotlinDbTypes
import typr.kotlindsl.SelectBuilder
import typr.runtime.PgTypes
import typr.runtime.internal.arrayMap

class PurchaseorderdetailRepoImpl() : PurchaseorderdetailRepo {
  override fun select(): SelectBuilder<PurchaseorderdetailFields, PurchaseorderdetailRow> = SelectBuilder.of("\"purchasing\".\"purchaseorderdetail\"", PurchaseorderdetailFields.structure, PurchaseorderdetailRow._rowParser, Dialect.POSTGRESQL)

  override fun selectAll(c: Connection): List<PurchaseorderdetailRow> = Fragment.interpolate(Fragment.lit("select \"purchaseorderid\", \"purchaseorderdetailid\", \"duedate\", \"orderqty\", \"productid\", \"unitprice\", \"receivedqty\", \"rejectedqty\", \"modifieddate\"\nfrom \"purchasing\".\"purchaseorderdetail\"\n")).query(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    compositeId: PurchaseorderdetailId,
    c: Connection
  ): PurchaseorderdetailRow? = Fragment.interpolate(Fragment.lit("select \"purchaseorderid\", \"purchaseorderdetailid\", \"duedate\", \"orderqty\", \"productid\", \"unitprice\", \"receivedqty\", \"rejectedqty\", \"modifieddate\"\nfrom \"purchasing\".\"purchaseorderdetail\"\nwhere \"purchaseorderid\" = "), Fragment.encode(PurchaseorderheaderId.pgType, compositeId.purchaseorderid), Fragment.lit(" AND \"purchaseorderdetailid\" = "), Fragment.encode(KotlinDbTypes.PgTypes.int4, compositeId.purchaseorderdetailid), Fragment.lit("")).query(PurchaseorderdetailRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    compositeIds: Array<PurchaseorderdetailId>,
    c: Connection
  ): List<PurchaseorderdetailRow> {
    val purchaseorderid: Array<PurchaseorderheaderId> = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderid, PurchaseorderheaderId::class.java)
    val purchaseorderdetailid: Array<Int> = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderdetailid, Int::class.javaObjectType)
    return Fragment.interpolate(Fragment.lit("select \"purchaseorderid\", \"purchaseorderdetailid\", \"duedate\", \"orderqty\", \"productid\", \"unitprice\", \"receivedqty\", \"rejectedqty\", \"modifieddate\"\nfrom \"purchasing\".\"purchaseorderdetail\"\nwhere (\"purchaseorderid\", \"purchaseorderdetailid\")\nin (select * from unnest("), Fragment.encode(PurchaseorderheaderId.pgTypeArray, purchaseorderid), Fragment.lit(", "), Fragment.encode(PgTypes.int4Array, purchaseorderdetailid), Fragment.lit("))\n")).query(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    compositeIds: Array<PurchaseorderdetailId>,
    c: Connection
  ): Map<PurchaseorderdetailId, PurchaseorderdetailRow> {
    val ret: MutableMap<PurchaseorderdetailId, PurchaseorderdetailRow> = mutableMapOf<PurchaseorderdetailId, PurchaseorderdetailRow>()
    selectByIds(compositeIds, c).forEach({ row -> ret.put(row.compositeId(), row) })
    return ret.toMap()
  }
}