/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.sales.currencyrate

import adventureworks.customtypes.Defaulted
import adventureworks.customtypes.Defaulted.UseDefault
import adventureworks.sales.currency.CurrencyId
import java.math.BigDecimal
import java.time.LocalDateTime
import typr.runtime.PgText
import typr.runtime.PgTypes

/** This class corresponds to a row in table `sales.currencyrate` which has not been persisted yet */
data class CurrencyrateRowUnsaved(
  /** Date and time the exchange rate was obtained. */
  val currencyratedate: LocalDateTime,
  /** Exchange rate was converted from this currency code.
    * Points to [adventureworks.sales.currency.CurrencyRow.currencycode]
    */
  val fromcurrencycode: CurrencyId,
  /** Exchange rate was converted to this currency code.
    * Points to [adventureworks.sales.currency.CurrencyRow.currencycode]
    */
  val tocurrencycode: CurrencyId,
  /** Average exchange rate for the day. */
  val averagerate: BigDecimal,
  /** Final exchange rate for the day. */
  val endofdayrate: BigDecimal,
  /** Default: nextval('sales.currencyrate_currencyrateid_seq'::regclass)
    * Primary key for CurrencyRate records.
    */
  val currencyrateid: Defaulted<CurrencyrateId> = UseDefault(),
  /** Default: now() */
  val modifieddate: Defaulted<LocalDateTime> = UseDefault()
) {
  fun toRow(
    currencyrateidDefault: () -> CurrencyrateId,
    modifieddateDefault: () -> LocalDateTime
  ): CurrencyrateRow = CurrencyrateRow(currencyrateid = currencyrateid.getOrElse(currencyrateidDefault), currencyratedate = currencyratedate, fromcurrencycode = fromcurrencycode, tocurrencycode = tocurrencycode, averagerate = averagerate, endofdayrate = endofdayrate, modifieddate = modifieddate.getOrElse(modifieddateDefault))

  companion object {
    val pgText: PgText<CurrencyrateRowUnsaved> =
      PgText.instance({ row, sb -> PgTypes.timestamp.pgText().unsafeEncode(row.currencyratedate, sb)
      sb.append(PgText.DELIMETER)
      CurrencyId.pgType.pgText().unsafeEncode(row.fromcurrencycode, sb)
      sb.append(PgText.DELIMETER)
      CurrencyId.pgType.pgText().unsafeEncode(row.tocurrencycode, sb)
      sb.append(PgText.DELIMETER)
      PgTypes.numeric.pgText().unsafeEncode(row.averagerate, sb)
      sb.append(PgText.DELIMETER)
      PgTypes.numeric.pgText().unsafeEncode(row.endofdayrate, sb)
      sb.append(PgText.DELIMETER)
      Defaulted.pgText(CurrencyrateId.pgType.pgText()).unsafeEncode(row.currencyrateid, sb)
      sb.append(PgText.DELIMETER)
      Defaulted.pgText(PgTypes.timestamp.pgText()).unsafeEncode(row.modifieddate, sb) })
  }
}