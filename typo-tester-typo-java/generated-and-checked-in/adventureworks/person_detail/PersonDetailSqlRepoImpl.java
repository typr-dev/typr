/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.person_detail;

import adventureworks.customtypes.TypoLocalDateTime;
import adventureworks.person.businessentity.BusinessentityId;
import java.sql.Connection;
import java.util.List;
import static typo.runtime.Fragment.interpolate;

public class PersonDetailSqlRepoImpl implements PersonDetailSqlRepo {
  @Override
  public List<PersonDetailSqlRow> apply(
    /* user-picked */ BusinessentityId businessentityid,
    TypoLocalDateTime modifiedAfter,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         SELECT s.businessentityid,
                p.title,
                p.firstname,
                p.middlename,
                p.lastname,
                e.jobtitle,
                a.addressline1,
                a.city,
                a.postalcode,
                a.rowguid
         FROM sales.salesperson s
                  JOIN humanresources.employee e ON e.businessentityid = s.businessentityid
                  JOIN person.person p ON p.businessentityid = s.businessentityid
                  JOIN person.businessentityaddress bea ON bea.businessentityid = s.businessentityid
                  LEFT JOIN person.address a ON a.addressid = bea.addressid
         where s.businessentityid = """),
      /* user-picked */ BusinessentityId.pgType.encode(businessentityid),
      typo.runtime.Fragment.lit("""
         ::int4
           and p.modifieddate > """),
      TypoLocalDateTime.pgType.encode(modifiedAfter),
      typo.runtime.Fragment.lit("::timestamp")
    ).query(PersonDetailSqlRow._rowParser.all()).runUnchecked(c);
  };
}