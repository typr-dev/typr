/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.update_person_returning;

import adventureworks.customtypes.TypoLocalDateTime;
import java.sql.Connection;
import java.util.List;
import java.util.Optional;
import typo.runtime.PgTypes;
import static typo.runtime.Fragment.interpolate;

public class UpdatePersonReturningSqlRepoImpl implements UpdatePersonReturningSqlRepo {
  @Override
  public List<UpdatePersonReturningSqlRow> apply(
    /* nullability unknown */ Optional<String> suffix,
    /* nullability unknown */ Optional<TypoLocalDateTime> cutoff,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         with row as (
           update person.person
         set firstname = firstname || '-' || """),
      PgTypes.text.opt().encode(suffix),
      typo.runtime.Fragment.lit("""
   
         where modifieddate < """),
      TypoLocalDateTime.pgType.opt().encode(cutoff),
      typo.runtime.Fragment.lit("""
         ::timestamp
         returning firstname, modifieddate
         )
         select row."firstname", row."modifieddate"::text
         from row""")
    ).query(UpdatePersonReturningSqlRow._rowParser.all()).runUnchecked(c);
  };
}