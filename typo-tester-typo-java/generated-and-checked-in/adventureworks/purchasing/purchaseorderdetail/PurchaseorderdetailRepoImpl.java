/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail;

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId;
import java.sql.Connection;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.runtime.PgTypes;
import typo.runtime.internal.arrayMap;
import static typo.runtime.Fragment.interpolate;

public class PurchaseorderdetailRepoImpl implements PurchaseorderdetailRepo {
  @Override
  public SelectBuilder<PurchaseorderdetailFields, PurchaseorderdetailRow> select() {
    return SelectBuilder.of("\"purchasing\".\"purchaseorderdetail\"", PurchaseorderdetailFields.structure(), PurchaseorderdetailRow._rowParser, Dialect.POSTGRESQL);
  };

  @Override
  public List<PurchaseorderdetailRow> selectAll(Connection c) {
    return interpolate(typo.runtime.Fragment.lit("""
       select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
       from "purchasing"."purchaseorderdetail"
    """)).query(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Optional<PurchaseorderdetailRow> selectById(
    PurchaseorderdetailId compositeId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
         from "purchasing"."purchaseorderdetail"
         where "purchaseorderid" = """),
      PurchaseorderheaderId.pgType.encode(compositeId.purchaseorderid()),
      typo.runtime.Fragment.lit("""
       AND "purchaseorderdetailid" = 
      """),
      PgTypes.int4.encode(compositeId.purchaseorderdetailid()),
      typo.runtime.Fragment.lit("")
    ).query(PurchaseorderdetailRow._rowParser.first()).runUnchecked(c);
  };

  @Override
  public List<PurchaseorderdetailRow> selectByIds(
    PurchaseorderdetailId[] compositeIds,
    Connection c
  ) {
    PurchaseorderheaderId[] purchaseorderid = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderid, PurchaseorderheaderId.class);;
    Integer[] purchaseorderdetailid = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderdetailid, Integer.class);;
    return interpolate(
      typo.runtime.Fragment.lit("""
         select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
         from "purchasing"."purchaseorderdetail"
         where ("purchaseorderid", "purchaseorderdetailid")
         in (select unnest("""),
      PurchaseorderheaderId.pgTypeArray.encode(purchaseorderid),
      typo.runtime.Fragment.lit("::int4[]), unnest("),
      PgTypes.int4Array.encode(purchaseorderdetailid),
      typo.runtime.Fragment.lit("""
      ::int4[]))

      """)
    ).query(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Map<PurchaseorderdetailId, PurchaseorderdetailRow> selectByIdsTracked(
    PurchaseorderdetailId[] compositeIds,
    Connection c
  ) {
    HashMap<PurchaseorderdetailId, PurchaseorderdetailRow> ret = new HashMap<PurchaseorderdetailId, PurchaseorderdetailRow>();
    selectByIds(compositeIds, c).forEach(row -> ret.put(row.compositeId(), row));
    return ret;
  };
}