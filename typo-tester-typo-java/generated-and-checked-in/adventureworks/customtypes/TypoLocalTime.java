/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes;

import com.fasterxml.jackson.annotation.JsonValue;
import java.time.LocalTime;
import java.time.temporal.ChronoUnit;
import typo.dsl.Bijection;
import typo.runtime.PgRead;
import typo.runtime.PgText;
import typo.runtime.PgType;
import typo.runtime.PgTypes;
import typo.runtime.PgWrite;
import typo.runtime.internal.arrayMap;

/** This is `java.time.LocalTime`, but with microsecond precision and transferred to and from postgres as strings. The reason is that postgres driver and db libs are broken */
public record TypoLocalTime(@JsonValue LocalTime value) {
  public TypoLocalTime withValue(LocalTime value) {
    return new TypoLocalTime(value);
  };

  static public TypoLocalTime apply(LocalTime value) {
    return new TypoLocalTime(value.truncatedTo(ChronoUnit.MICROS));
  };

  static public TypoLocalTime apply(String str) {
    return TypoLocalTime.apply(LocalTime.parse(str));
  };

  static public Bijection<TypoLocalTime, LocalTime> bijection =
    Bijection.of(TypoLocalTime::value, TypoLocalTime::new);

  static public TypoLocalTime now() {
    return TypoLocalTime.apply(LocalTime.now());
  };

  static public PgText<TypoLocalTime> pgText =
    PgText.textString.contramap(v -> v.value().toString());

  static public PgType<TypoLocalTime> pgType =
    PgTypes.text.bimap((String v) -> new TypoLocalTime(LocalTime.parse(v)), (TypoLocalTime v) -> v.value().toString()).renamed("time");

  static public PgType<TypoLocalTime[]> pgTypeArray =
    TypoLocalTime.pgType.array(PgRead.massageJdbcArrayTo(String[].class).map((String[] xs) -> arrayMap.map(xs, (String v) -> new TypoLocalTime(LocalTime.parse(v)), TypoLocalTime.class)), PgWrite.<String>passObjectToJdbc().array(TypoLocalTime.pgType.typename().<String>as()).contramap((TypoLocalTime[] xs) -> arrayMap.map(xs, (TypoLocalTime v) -> v.value().toString(), String.class)));
}