/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes;

import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;
import org.postgresql.geometric.PGpath;
import org.postgresql.geometric.PGpoint;
import typo.runtime.PgRead;
import typo.runtime.PgText;
import typo.runtime.PgType;
import typo.runtime.PgWrite;
import typo.runtime.internal.arrayMap;
import static typo.runtime.internal.stringInterpolator.str;

/** This implements a path (a multiple segmented line, which may be closed) */
public record TypoPath(
  Boolean open,
  List<TypoPoint> points
) {
  public TypoPath withOpen(Boolean open) {
    return new TypoPath(open, points);
  };

  public TypoPath withPoints(List<TypoPoint> points) {
    return new TypoPath(open, points);
  };

  static public PgText<TypoPath> pgText =
    PgText.textString.contramap(v -> (v.open() ? "[" : "(") + v.points().stream().map(p -> str(java.lang.String.valueOf(p.x()), ", ", java.lang.String.valueOf(p.y()), "")).collect(Collectors.joining(",")) + (v.open() ? "]" : ")"));

  static public PgType<TypoPath> pgType =
    PgType.of(
      "path",
      PgRead.castJdbcObjectTo(PGpath.class).map((PGpath v) -> new TypoPath(v.isOpen(), Arrays.stream(v.points).map(p -> new TypoPoint(p.x, p.y)).toList())),
      PgWrite.<PGpath>passObjectToJdbc().contramap((TypoPath v) -> new PGpath(v.points().stream().map(p -> new PGpoint(p.x(), p.y())).toArray(PGpoint[]::new), v.open())),
      TypoPath.pgText
    );

  static public PgType<TypoPath[]> pgTypeArray =
    TypoPath.pgType.array(PgRead.castJdbcArrayTo(PGpath.class).map((PGpath[] xs) -> arrayMap.map(xs, (PGpath v) -> new TypoPath(v.isOpen(), Arrays.stream(v.points).map(p -> new TypoPoint(p.x, p.y)).toList()), TypoPath.class)), PgWrite.<PGpath>passObjectToJdbc().array(TypoPath.pgType.typename().<PGpath>as()).contramap((TypoPath[] xs) -> arrayMap.map(xs, (TypoPath v) -> new PGpath(v.points().stream().map(p -> new PGpoint(p.x(), p.y())).toArray(PGpoint[]::new), v.open()), PGpath.class)));
}