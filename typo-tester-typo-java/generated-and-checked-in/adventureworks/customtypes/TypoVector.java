/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes;

import com.fasterxml.jackson.annotation.JsonValue;
import java.util.Arrays;
import java.util.stream.Collectors;
import org.postgresql.jdbc.PgArray;
import typo.dsl.Bijection;
import typo.runtime.PgRead;
import typo.runtime.PgText;
import typo.runtime.PgType;
import typo.runtime.PgWrite;

/** extension: https://github.com/pgvector/pgvector */
public record TypoVector(@JsonValue Float[] value) {
  public TypoVector withValue(Float[] value) {
    return new TypoVector(value);
  };

  static public Bijection<TypoVector, Float[]> bijection =
    Bijection.of(TypoVector::value, TypoVector::new);

  static public PgText<TypoVector> pgText =
    PgText.textString.contramap(v -> "[" + Arrays.stream(v.value()).map(String::valueOf).collect(Collectors.joining(",")) + "]");

  static public PgType<TypoVector> pgType =
    PgType.of(
      "vector",
      PgRead.castJdbcObjectTo(PgArray.class).map(v -> new TypoVector((Float[]) v.getArray())),
      PgWrite.passObjectToJdbc().contramap((TypoVector v) -> v.value()),
      TypoVector.pgText
    );
}