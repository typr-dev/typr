/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes;

import com.fasterxml.jackson.annotation.JsonValue;
import java.time.LocalDate;
import typo.dsl.Bijection;
import typo.runtime.PgRead;
import typo.runtime.PgText;
import typo.runtime.PgType;
import typo.runtime.PgTypes;
import typo.runtime.PgWrite;
import typo.runtime.internal.arrayMap;

/** This is `java.time.LocalDate`, but transferred to and from postgres as strings. The reason is that postgres driver and db libs are broken */
public record TypoLocalDate(@JsonValue LocalDate value) {
  public TypoLocalDate withValue(LocalDate value) {
    return new TypoLocalDate(value);
  };

  static public TypoLocalDate apply(String str) {
    return new TypoLocalDate(LocalDate.parse(str));
  };

  static public Bijection<TypoLocalDate, LocalDate> bijection =
    Bijection.of(TypoLocalDate::value, TypoLocalDate::new);

  static public TypoLocalDate now() {
    return new TypoLocalDate(LocalDate.now());
  };

  static public PgText<TypoLocalDate> pgText =
    PgText.textString.contramap(v -> v.value().toString());

  static public PgType<TypoLocalDate> pgType =
    PgTypes.text.bimap(v -> new TypoLocalDate(LocalDate.parse(v)), v -> v.value().toString()).renamed("date");

  static public PgType<TypoLocalDate[]> pgTypeArray =
    TypoLocalDate.pgType.array(PgRead.massageJdbcArrayTo(String[].class).map(xs -> arrayMap.map(xs, v -> new TypoLocalDate(LocalDate.parse(v)), TypoLocalDate.class)), PgWrite.<String>passObjectToJdbc().array(TypoLocalDate.pgType.typename().<String>as()).contramap(xs -> arrayMap.map(xs, (TypoLocalDate v) -> v.value().toString(), String.class)));
}