/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes;

import com.fasterxml.jackson.annotation.JsonValue;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;
import org.postgresql.geometric.PGpoint;
import org.postgresql.geometric.PGpolygon;
import typo.dsl.Bijection;
import typo.runtime.PgRead;
import typo.runtime.PgText;
import typo.runtime.PgType;
import typo.runtime.PgWrite;
import typo.runtime.internal.arrayMap;
import static typo.runtime.internal.stringInterpolator.str;

/** Polygon datatype in PostgreSQL */
public record TypoPolygon(@JsonValue List<TypoPoint> points) {
  public TypoPolygon withPoints(List<TypoPoint> points) {
    return new TypoPolygon(points);
  };

  static public Bijection<TypoPolygon, List<TypoPoint>> bijection =
    Bijection.of(TypoPolygon::points, TypoPolygon::new);

  static public PgText<TypoPolygon> pgText =
    PgText.textString.contramap(v -> "(" + v.points().stream().map(p -> str(java.lang.String.valueOf(p.x()), ", ", java.lang.String.valueOf(p.y()), "")).collect(Collectors.joining(",")) + ")");

  static public PgType<TypoPolygon> pgType =
    PgType.of(
      "polygon",
      PgRead.castJdbcObjectTo(PGpolygon.class).map((PGpolygon v) -> new TypoPolygon(Arrays.stream(v.points).map(p -> new TypoPoint(p.x, p.y)).toList())),
      PgWrite.<PGpolygon>passObjectToJdbc().contramap((TypoPolygon v) -> new PGpolygon(v.points().stream().map(p -> new PGpoint(p.x(), p.y())).toArray(PGpoint[]::new))),
      TypoPolygon.pgText
    );

  static public PgType<TypoPolygon[]> pgTypeArray =
    TypoPolygon.pgType.array(PgRead.castJdbcArrayTo(PGpolygon.class).map((PGpolygon[] xs) -> arrayMap.map(xs, (PGpolygon v) -> new TypoPolygon(Arrays.stream(v.points).map(p -> new TypoPoint(p.x, p.y)).toList()), TypoPolygon.class)), PgWrite.<PGpolygon>passObjectToJdbc().array(TypoPolygon.pgType.typename().<PGpolygon>as()).contramap((TypoPolygon[] xs) -> arrayMap.map(xs, (TypoPolygon v) -> new PGpolygon(v.points().stream().map(p -> new PGpoint(p.x(), p.y())).toArray(PGpoint[]::new)), PGpolygon.class)));
}