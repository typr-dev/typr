/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes;

import com.fasterxml.jackson.annotation.JsonValue;
import java.lang.SuppressWarnings;
import java.util.HashMap;
import java.util.Map;
import typo.dsl.Bijection;
import typo.runtime.PgRead;
import typo.runtime.PgText;
import typo.runtime.PgType;
import typo.runtime.PgWrite;

/** The text representation of an hstore, used for input and output, includes zero or more key => value pairs separated by commas */
public record TypoHStore(@JsonValue Map<String, String> value) {
  public TypoHStore withValue(Map<String, String> value) {
    return new TypoHStore(value);
  };

  static public Bijection<TypoHStore, Map<String, String>> bijection =
    Bijection.of(TypoHStore::value, TypoHStore::new);

  static public PgText<TypoHStore> pgText =
    PgText.textString.contramap(v -> String.join(",", v.value().entrySet().stream().map(e -> e.getKey() + " => " + e.getValue()).toList()));

  @SuppressWarnings("unchecked")
  static public PgType<TypoHStore> pgType =
    PgType.of(
      "hstore",
      PgRead.castJdbcObjectTo(Map.class).map((Map v) -> new TypoHStore((Map<String, String>) v)),
      PgWrite.<Map<String, String>>passObjectToJdbc().contramap((TypoHStore v) -> new HashMap<String, String>(v.value())),
      TypoHStore.pgText
    );
}