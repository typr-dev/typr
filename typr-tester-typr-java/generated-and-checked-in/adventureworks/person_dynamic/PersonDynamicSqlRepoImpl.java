/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.person_dynamic;

import static typr.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.List;
import java.util.Optional;
import typr.runtime.Fragment;
import typr.runtime.PgTypes;

public class PersonDynamicSqlRepoImpl implements PersonDynamicSqlRepo {
  @Override
  public List<PersonDynamicSqlRow> apply(Optional<String> firstName, Connection c) {
    return interpolate(
            Fragment.lit(
                "SELECT p.title, p.firstname, p.middlename, p.lastname\n"
                    + "FROM person.person p\n"
                    + "WHERE "),
            Fragment.encode(PgTypes.text.opt(), firstName),
            Fragment.lit("::text IS NULL OR p.firstname = "),
            Fragment.encode(PgTypes.text.opt(), firstName),
            Fragment.lit("\n"))
        .query(PersonDynamicSqlRow._rowParser.all())
        .runUnchecked(c);
  }
  ;
}
