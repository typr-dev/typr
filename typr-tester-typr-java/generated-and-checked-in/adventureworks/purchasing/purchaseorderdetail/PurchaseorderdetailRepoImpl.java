/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail;

import static typr.runtime.Fragment.interpolate;

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId;
import java.sql.Connection;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import typr.dsl.Dialect;
import typr.dsl.SelectBuilder;
import typr.runtime.Fragment;
import typr.runtime.PgTypes;
import typr.runtime.internal.arrayMap;

public class PurchaseorderdetailRepoImpl implements PurchaseorderdetailRepo {
  @Override
  public SelectBuilder<PurchaseorderdetailFields, PurchaseorderdetailRow> select() {
    return SelectBuilder.of(
        "\"purchasing\".\"purchaseorderdetail\"",
        PurchaseorderdetailFields.structure(),
        PurchaseorderdetailRow._rowParser,
        Dialect.POSTGRESQL);
  }
  ;

  @Override
  public List<PurchaseorderdetailRow> selectAll(Connection c) {
    return interpolate(
            Fragment.lit(
                "select \"purchaseorderid\", \"purchaseorderdetailid\", \"duedate\", \"orderqty\","
                    + " \"productid\", \"unitprice\", \"receivedqty\", \"rejectedqty\","
                    + " \"modifieddate\"\n"
                    + "from \"purchasing\".\"purchaseorderdetail\"\n"))
        .query(PurchaseorderdetailRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Optional<PurchaseorderdetailRow> selectById(
      PurchaseorderdetailId compositeId, Connection c) {
    return interpolate(
            Fragment.lit(
                "select \"purchaseorderid\", \"purchaseorderdetailid\", \"duedate\", \"orderqty\","
                    + " \"productid\", \"unitprice\", \"receivedqty\", \"rejectedqty\","
                    + " \"modifieddate\"\n"
                    + "from \"purchasing\".\"purchaseorderdetail\"\n"
                    + "where \"purchaseorderid\" = "),
            Fragment.encode(PurchaseorderheaderId.pgType, compositeId.purchaseorderid()),
            Fragment.lit(" AND \"purchaseorderdetailid\" = "),
            Fragment.encode(PgTypes.int4, compositeId.purchaseorderdetailid()),
            Fragment.lit(""))
        .query(PurchaseorderdetailRow._rowParser.first())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<PurchaseorderdetailRow> selectByIds(
      PurchaseorderdetailId[] compositeIds, Connection c) {
    PurchaseorderheaderId[] purchaseorderid =
        arrayMap.map(
            compositeIds, PurchaseorderdetailId::purchaseorderid, PurchaseorderheaderId.class);
    ;
    Integer[] purchaseorderdetailid =
        arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderdetailid, Integer.class);
    ;
    return interpolate(
            Fragment.lit(
                "select \"purchaseorderid\", \"purchaseorderdetailid\", \"duedate\", \"orderqty\","
                    + " \"productid\", \"unitprice\", \"receivedqty\", \"rejectedqty\","
                    + " \"modifieddate\"\n"
                    + "from \"purchasing\".\"purchaseorderdetail\"\n"
                    + "where (\"purchaseorderid\", \"purchaseorderdetailid\")\n"
                    + "in (select * from unnest("),
            Fragment.encode(PurchaseorderheaderId.pgTypeArray, purchaseorderid),
            Fragment.lit(", "),
            Fragment.encode(PgTypes.int4Array, purchaseorderdetailid),
            Fragment.lit("))\n"))
        .query(PurchaseorderdetailRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Map<PurchaseorderdetailId, PurchaseorderdetailRow> selectByIdsTracked(
      PurchaseorderdetailId[] compositeIds, Connection c) {
    HashMap<PurchaseorderdetailId, PurchaseorderdetailRow> ret =
        new HashMap<PurchaseorderdetailId, PurchaseorderdetailRow>();
    selectByIds(compositeIds, c).forEach(row -> ret.put(row.compositeId(), row));
    return ret;
  }
  ;
}
