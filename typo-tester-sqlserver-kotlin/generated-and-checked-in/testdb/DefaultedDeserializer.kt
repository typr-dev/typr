/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb

import com.fasterxml.jackson.core.JsonParser
import com.fasterxml.jackson.core.JsonToken
import com.fasterxml.jackson.databind.BeanProperty
import com.fasterxml.jackson.databind.DeserializationContext
import com.fasterxml.jackson.databind.JavaType
import com.fasterxml.jackson.databind.JsonDeserializer
import com.fasterxml.jackson.databind.deser.ContextualDeserializer
import java.io.IOException
import java.lang.Class
import java.lang.RuntimeException
import testdb.customtypes.Defaulted
import testdb.customtypes.Defaulted.Provided
import testdb.customtypes.Defaulted.UseDefault

/** Jackson deserializer for Defaulted types */
data class DefaultedDeserializer(
  val valueType: JavaType,
  val defaultedClass: Class<*>
) : JsonDeserializer<Defaulted<*>>(), ContextualDeserializer {
  override fun createContextual(
    ctxt: DeserializationContext,
    property: BeanProperty
  ): JsonDeserializer<*> {
    val contextType: JavaType = ctxt.getContextualType()
    val type: JavaType = (if (contextType == null && property != null) property.getType() else contextType)
    if (type != null && type.containedTypeCount() > 0) {
      return DefaultedDeserializer(type.containedType(0), type.getRawClass());
    }
    throw RuntimeException("unexpected")
  }

  @Throws(IOException::class)
  override fun deserialize(
    p: JsonParser,
    ctxt: DeserializationContext
  ): Defaulted<*> {
    if (p.currentToken() == JsonToken.VALUE_STRING) {
      val text: String = p.getText();
      if ("defaulted".equals(text)) {
        return UseDefault<Any>();
      }
      throw IOException("Expected 'defaulted' but got: " + text);
    }
    if (p.currentToken() == JsonToken.START_OBJECT) {
      p.nextToken();
      if (p.currentToken() == JsonToken.FIELD_NAME && "provided".equals(p.currentName())) {
        p.nextToken();
        val value: Any = ctxt.readValue(p, valueType);
        p.nextToken();
        return Provided<Any>(value);
      }

    }
    throw IOException("Expected 'provided' field but got: " + p.currentName())
  }
}