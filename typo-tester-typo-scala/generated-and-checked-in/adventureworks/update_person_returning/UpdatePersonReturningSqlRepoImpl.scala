/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.update_person_returning

import adventureworks.customtypes.TypoLocalDateTime
import java.sql.Connection
import java.util.Optional
import typo.runtime.PgTypes
import typo.runtime.FragmentInterpolator.interpolate

class UpdatePersonReturningSqlRepoImpl extends UpdatePersonReturningSqlRepo {
  override def apply(
    suffix: /* nullability unknown */ Optional[String],
    cutoff: /* nullability unknown */ Optional[TypoLocalDateTime]
  )(using c: Connection): java.util.List[UpdatePersonReturningSqlRow] = {
    interpolate"""with row as (
      update person.person
    set firstname = firstname || '-' || ${PgTypes.text.opt().encode(suffix)}
    where modifieddate < ${TypoLocalDateTime.pgType.opt().encode(cutoff)}::timestamp
    returning firstname, modifieddate
    )
    select row."firstname", row."modifieddate"::text
    from row""".query(UpdatePersonReturningSqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}