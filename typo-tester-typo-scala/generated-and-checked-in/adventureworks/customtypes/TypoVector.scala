/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes

import com.fasterxml.jackson.annotation.JsonValue
import org.postgresql.jdbc.PgArray
import typo.dsl.Bijection
import typo.runtime.PgRead
import typo.runtime.PgText
import typo.runtime.PgType
import typo.runtime.PgWrite

/** extension: https://github.com/pgvector/pgvector */
case class TypoVector(@JsonValue value: Array[java.lang.Float])

object TypoVector {
  given bijection: Bijection[TypoVector, Array[java.lang.Float]] = Bijection.apply[TypoVector, Array[java.lang.Float]](_.value)(TypoVector.apply)

  given pgText: PgText[TypoVector] = PgText.textString.contramap(v => v.value.mkString("[", ",", "]"))

  given pgType: PgType[TypoVector] = {
    PgType.of(
      "vector",
      PgRead.castJdbcObjectTo(classOf[PgArray]).map((v: PgArray) => TypoVector(v.getArray.asInstanceOf[Array[java.lang.Float]].map(Float2float))),
      PgWrite.passObjectToJdbc[Array[java.lang.Float]]().contramap((v: TypoVector) => v.value.map(x => x: java.lang.Float)),
      TypoVector.pgText
    )
  }
}