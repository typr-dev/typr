/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes

import java.util.Arrays
import java.util.stream.Collectors
import org.postgresql.geometric.PGpath
import org.postgresql.geometric.PGpoint
import typo.runtime.PgRead
import typo.runtime.PgText
import typo.runtime.PgType
import typo.runtime.PgWrite

/** This implements a path (a multiple segmented line, which may be closed) */
case class TypoPath(
  open: java.lang.Boolean,
  points: java.util.List[TypoPoint]
)

object TypoPath {
  given pgText: PgText[TypoPath] = PgText.textString.contramap(v => (if (v.open) "[" else "(") + v.points.stream().map(p => s"${p.x}, ${p.y}").collect(Collectors.joining(",")) + (if (v.open) "]" else ")"))

  given pgType: PgType[TypoPath] = {
    PgType.of(
      "path",
      PgRead.castJdbcObjectTo(classOf[PGpath]).map((v: PGpath) => new TypoPath(v.isOpen, Arrays.stream(v.points).map(p => new TypoPoint(p.x, p.y)).toList())),
      PgWrite.passObjectToJdbc[PGpath]().contramap((v: TypoPath) => new PGpath(v.points.stream().map(p => new PGpoint(p.x, p.y)).toArray((n => new Array[PGpoint](n))), v.open)),
      TypoPath.pgText
    )
  }

  given pgTypeArray: PgType[Array[TypoPath]] = TypoPath.pgType.array(PgRead.castJdbcArrayTo(classOf[PGpath]).map((xs: Array[PGpath]) => xs.map((v: PGpath) => new TypoPath(v.isOpen, Arrays.stream(v.points).map(p => new TypoPoint(p.x, p.y)).toList()))), PgWrite.passObjectToJdbc[PGpath]().array(TypoPath.pgType.typename().as[PGpath]()).contramap((xs: Array[TypoPath]) => xs.map((v: TypoPath) => new PGpath(v.points.stream().map(p => new PGpoint(p.x, p.y)).toArray((n => new Array[PGpoint](n))), v.open))))
}