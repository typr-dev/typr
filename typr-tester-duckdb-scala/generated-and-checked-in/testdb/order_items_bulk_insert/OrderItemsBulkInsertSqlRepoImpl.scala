/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.order_items_bulk_insert

import java.sql.Connection
import testdb.orders.OrdersId
import testdb.products.ProductsId
import typr.scaladsl.Fragment
import typr.scaladsl.ScalaDbTypes
import typr.scaladsl.Fragment.sql

class OrderItemsBulkInsertSqlRepoImpl extends OrderItemsBulkInsertSqlRepo {
  override def apply(
    orderId: /* user-picked */ OrdersId,
    productId: /* user-picked */ ProductsId,
    quantity: Int,
    unitPrice: BigDecimal
  )(using c: Connection): Int = {
    sql"""-- Insert order items with composite key handling
    -- Tests: composite primary key in INSERT, foreign key types, RETURNING with composite key
  
    INSERT INTO order_items (order_id, product_id, quantity, unit_price)
    VALUES (
        CAST(${Fragment.encode(OrdersId.duckDbType, orderId)} AS INTEGER),
        CAST(${Fragment.encode(ProductsId.duckDbType, productId)} AS INTEGER),
        CAST(${Fragment.encode(ScalaDbTypes.DuckDbTypes.integer, quantity)} AS INTEGER),
        CAST(${Fragment.encode(ScalaDbTypes.DuckDbTypes.numeric, unitPrice)} AS DECIMAL)
    )
    RETURNING
        order_id,
        product_id,
        quantity,
        unit_price""".update().runUnchecked(c)
  }
}