/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.update_customer_priority

import java.sql.Connection
import testdb.Priority
import testdb.customers.CustomersId
import typr.scaladsl.Fragment
import typr.scaladsl.Fragment.sql

class UpdateCustomerPrioritySqlRepoImpl extends UpdateCustomerPrioritySqlRepo {
  override def apply(
    newPriority: /* user-picked */ Priority,
    customerId: /* user-picked */ CustomersId
  )(using c: Connection): Int = {
    sql"""-- Update customer priority based on spending and return updated rows
    -- Tests: UPDATE with RETURNING, enum parameters
  
    UPDATE customers
    SET priority = ${Fragment.encode(Priority.duckDbType, newPriority)}
    WHERE customer_id = ${Fragment.encode(CustomersId.duckDbType, customerId)}
    RETURNING
        customer_id,
        name,
        email,
        created_at,
        priority""".update().runUnchecked(c)
  }
}