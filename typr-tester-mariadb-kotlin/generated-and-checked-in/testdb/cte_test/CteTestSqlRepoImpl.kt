/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.cte_test

import java.sql.Connection
import kotlin.collections.List
import typr.kotlindsl.Fragment

class CteTestSqlRepoImpl() : CteTestSqlRepo {
  override fun apply(c: Connection): List<CteTestSqlRow> = Fragment.interpolate(Fragment.lit("-- Test CTE tracking\nWITH customer_totals AS (\n    SELECT\n        o.customer_id,\n        COUNT(*) as order_count,\n        SUM(o.total_amount) as total_spent\n    FROM orders o\n    GROUP BY o.customer_id\n),\ntop_customers AS (\n    SELECT\n        c.customer_id,\n        c.email,\n        c.first_name,\n        ct.order_count,\n        ct.total_spent\n    FROM customers c\n    INNER JOIN customer_totals ct ON c.customer_id = ct.customer_id\n    WHERE ct.total_spent > 100\n)\nSELECT\n    tc.customer_id,\n    tc.email,\n    tc.first_name,\n    tc.order_count,\n    tc.total_spent,\n    b.name as favorite_brand\nFROM top_customers tc\nLEFT JOIN orders o ON tc.customer_id = o.customer_id\nLEFT JOIN order_items oi ON o.order_id = oi.order_id\nLEFT JOIN products p ON oi.product_id = p.product_id\nLEFT JOIN brands b ON p.brand_id = b.brand_id\n")).query(CteTestSqlRow._rowParser.all()).runUnchecked(c)
}