/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.update_order_status;

import java.sql.Connection;
import testdb.orders.OrdersId;
import typo.runtime.MariaTypes;
import static typo.runtime.Fragment.interpolate;

public class UpdateOrderStatusSqlRepoImpl implements UpdateOrderStatusSqlRepo {
  @Override
  public Integer apply(
    /* user-picked */ String newStatus,
    /* user-picked */ OrdersId orderId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         -- Update order status
         UPDATE orders
         SET order_status = """),
      MariaTypes.text.encode(newStatus),
      typo.runtime.Fragment.lit("""
         ,
             confirmed_at = CASE WHEN """),
      MariaTypes.text.encode(newStatus),
      typo.runtime.Fragment.lit("""
          = 'confirmed' THEN NOW(6) ELSE confirmed_at END,
             shipped_at = CASE WHEN """),
      MariaTypes.text.encode(newStatus),
      typo.runtime.Fragment.lit("""
          = 'shipped' THEN NOW(6) ELSE shipped_at END,
             delivered_at = CASE WHEN """),
      MariaTypes.text.encode(newStatus),
      typo.runtime.Fragment.lit("""
          = 'delivered' THEN NOW(6) ELSE delivered_at END
         WHERE order_id = """),
      /* user-picked */ OrdersId.pgType.encode(orderId),
      typo.runtime.Fragment.lit("""


      """)
    ).update().runUnchecked(c);
  };
}