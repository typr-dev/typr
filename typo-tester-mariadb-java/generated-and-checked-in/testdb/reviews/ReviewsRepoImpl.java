/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.reviews;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import testdb.customers.CustomersId;
import testdb.order_items.OrderItemsId;
import testdb.products.ProductsId;
import typo.dsl.DeleteBuilder;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.dsl.UpdateBuilder;
import typo.runtime.Fragment;
import typo.runtime.Fragment.Literal;
import typo.runtime.MariaTypes;
import static typo.runtime.Fragment.interpolate;

public class ReviewsRepoImpl implements ReviewsRepo {
  @Override
  public DeleteBuilder<ReviewsFields, ReviewsRow> delete() {
    return DeleteBuilder.of("`reviews`", ReviewsFields.structure(), Dialect.MARIADB);
  };

  @Override
  public Boolean deleteById(
    ReviewsId reviewId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("delete from `reviews` where `review_id` = "),
      ReviewsId.pgType.encode(reviewId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public Integer deleteByIds(
    ReviewsId[] reviewIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : reviewIds) { fragments.add(ReviewsId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("delete from `reviews` where `review_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c);
  };

  @Override
  public ReviewsRow insert(
    ReviewsRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         insert into `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
         values ("""),
      ProductsId.pgType.encode(unsaved.productId()),
      typo.runtime.Fragment.lit(", "),
      CustomersId.pgType.encode(unsaved.customerId()),
      typo.runtime.Fragment.lit(", "),
      OrderItemsId.pgType.opt().encode(unsaved.orderItemId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.smallint.encode(unsaved.rating()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.title()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.content()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.pros()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.cons()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.images()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isVerifiedPurchase()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isApproved()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bigint.encode(unsaved.helpfulVotes()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bigint.encode(unsaved.unhelpfulVotes()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.adminResponse()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.opt().encode(unsaved.respondedAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.createdAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.updatedAt()),
      typo.runtime.Fragment.lit("""
         )
         returning `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
      """)
    )
      .updateReturning(ReviewsRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public ReviewsRow insert(
    ReviewsRowUnsaved unsaved,
    Connection c
  ) {
    ArrayList<Literal> columns = new ArrayList<Literal>();;
    ArrayList<Fragment> values = new ArrayList<Fragment>();;
    columns.add(Fragment.lit("`product_id`"));
    values.add(interpolate(
      ProductsId.pgType.encode(unsaved.productId()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`customer_id`"));
    values.add(interpolate(
      CustomersId.pgType.encode(unsaved.customerId()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`rating`"));
    values.add(interpolate(
      MariaTypes.smallint.encode(unsaved.rating()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    unsaved.orderItemId().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`order_item_id`"));
        values.add(interpolate(
        OrderItemsId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.title().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`title`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.content().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`content`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.pros().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`pros`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.cons().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`cons`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.images().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`images`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.isVerifiedPurchase().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`is_verified_purchase`"));
        values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.isApproved().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`is_approved`"));
        values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.helpfulVotes().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`helpful_votes`"));
        values.add(interpolate(
        MariaTypes.bigint.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.unhelpfulVotes().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`unhelpful_votes`"));
        values.add(interpolate(
        MariaTypes.bigint.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.adminResponse().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`admin_response`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.respondedAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`responded_at`"));
        values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.createdAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`created_at`"));
        values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.updatedAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`updated_at`"));
        values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    Fragment q = interpolate(
      typo.runtime.Fragment.lit("insert into `reviews`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
         )
         values ("""),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
         )
         returning `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
      """)
    );;
    return q.updateReturning(ReviewsRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public SelectBuilder<ReviewsFields, ReviewsRow> select() {
    return SelectBuilder.of("`reviews`", ReviewsFields.structure(), ReviewsRow._rowParser, Dialect.MARIADB);
  };

  @Override
  public List<ReviewsRow> selectAll(Connection c) {
    return interpolate(typo.runtime.Fragment.lit("""
       select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
       from `reviews`
    """)).query(ReviewsRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Optional<ReviewsRow> selectById(
    ReviewsId reviewId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
         from `reviews`
         where `review_id` = """),
      ReviewsId.pgType.encode(reviewId),
      typo.runtime.Fragment.lit("")
    ).query(ReviewsRow._rowParser.first()).runUnchecked(c);
  };

  @Override
  public List<ReviewsRow> selectByIds(
    ReviewsId[] reviewIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : reviewIds) { fragments.add(ReviewsId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at` from `reviews` where `review_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(ReviewsRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Map<ReviewsId, ReviewsRow> selectByIdsTracked(
    ReviewsId[] reviewIds,
    Connection c
  ) {
    HashMap<ReviewsId, ReviewsRow> ret = new HashMap<ReviewsId, ReviewsRow>();
    selectByIds(reviewIds, c).forEach(row -> ret.put(row.reviewId(), row));
    return ret;
  };

  @Override
  public UpdateBuilder<ReviewsFields, ReviewsRow> update() {
    return UpdateBuilder.of("`reviews`", ReviewsFields.structure(), ReviewsRow._rowParser.all(), Dialect.MARIADB);
  };

  @Override
  public Boolean update(
    ReviewsRow row,
    Connection c
  ) {
    ReviewsId reviewId = row.reviewId();;
    return interpolate(
      typo.runtime.Fragment.lit("""
         update `reviews`
         set `product_id` = """),
      ProductsId.pgType.encode(row.productId()),
      typo.runtime.Fragment.lit("""
         ,
         `customer_id` = """),
      CustomersId.pgType.encode(row.customerId()),
      typo.runtime.Fragment.lit("""
         ,
         `order_item_id` = """),
      OrderItemsId.pgType.opt().encode(row.orderItemId()),
      typo.runtime.Fragment.lit("""
         ,
         `rating` = """),
      MariaTypes.smallint.encode(row.rating()),
      typo.runtime.Fragment.lit("""
         ,
         `title` = """),
      MariaTypes.text.opt().encode(row.title()),
      typo.runtime.Fragment.lit("""
         ,
         `content` = """),
      MariaTypes.text.opt().encode(row.content()),
      typo.runtime.Fragment.lit("""
         ,
         `pros` = """),
      MariaTypes.text.opt().encode(row.pros()),
      typo.runtime.Fragment.lit("""
         ,
         `cons` = """),
      MariaTypes.text.opt().encode(row.cons()),
      typo.runtime.Fragment.lit("""
         ,
         `images` = """),
      MariaTypes.text.opt().encode(row.images()),
      typo.runtime.Fragment.lit("""
         ,
         `is_verified_purchase` = """),
      MariaTypes.bool.encode(row.isVerifiedPurchase()),
      typo.runtime.Fragment.lit("""
         ,
         `is_approved` = """),
      MariaTypes.bool.encode(row.isApproved()),
      typo.runtime.Fragment.lit("""
         ,
         `helpful_votes` = """),
      MariaTypes.bigint.encode(row.helpfulVotes()),
      typo.runtime.Fragment.lit("""
         ,
         `unhelpful_votes` = """),
      MariaTypes.bigint.encode(row.unhelpfulVotes()),
      typo.runtime.Fragment.lit("""
         ,
         `admin_response` = """),
      MariaTypes.text.opt().encode(row.adminResponse()),
      typo.runtime.Fragment.lit("""
         ,
         `responded_at` = """),
      MariaTypes.datetime.opt().encode(row.respondedAt()),
      typo.runtime.Fragment.lit("""
         ,
         `created_at` = """),
      MariaTypes.datetime.encode(row.createdAt()),
      typo.runtime.Fragment.lit("""
         ,
         `updated_at` = """),
      MariaTypes.datetime.encode(row.updatedAt()),
      typo.runtime.Fragment.lit("""
   
         where `review_id` = """),
      ReviewsId.pgType.encode(reviewId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public ReviewsRow upsert(
    ReviewsRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         INSERT INTO `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
         VALUES ("""),
      ProductsId.pgType.encode(unsaved.productId()),
      typo.runtime.Fragment.lit(", "),
      CustomersId.pgType.encode(unsaved.customerId()),
      typo.runtime.Fragment.lit(", "),
      OrderItemsId.pgType.opt().encode(unsaved.orderItemId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.smallint.encode(unsaved.rating()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.title()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.content()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.pros()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.cons()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.images()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isVerifiedPurchase()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isApproved()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bigint.encode(unsaved.helpfulVotes()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bigint.encode(unsaved.unhelpfulVotes()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.adminResponse()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.opt().encode(unsaved.respondedAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.createdAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.updatedAt()),
      typo.runtime.Fragment.lit("""
         )
         ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),
         `customer_id` = VALUES(`customer_id`),
         `order_item_id` = VALUES(`order_item_id`),
         `rating` = VALUES(`rating`),
         `title` = VALUES(`title`),
         `content` = VALUES(`content`),
         `pros` = VALUES(`pros`),
         `cons` = VALUES(`cons`),
         `images` = VALUES(`images`),
         `is_verified_purchase` = VALUES(`is_verified_purchase`),
         `is_approved` = VALUES(`is_approved`),
         `helpful_votes` = VALUES(`helpful_votes`),
         `unhelpful_votes` = VALUES(`unhelpful_votes`),
         `admin_response` = VALUES(`admin_response`),
         `responded_at` = VALUES(`responded_at`),
         `created_at` = VALUES(`created_at`),
         `updated_at` = VALUES(`updated_at`)
         RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`""")
    )
      .updateReturning(ReviewsRow._rowParser.exactlyOne())
      .runUnchecked(c);
  };

  @Override
  public List<ReviewsRow> upsertBatch(
    Iterator<ReviewsRow> unsaved,
    Connection c
  ) {
    return interpolate(typo.runtime.Fragment.lit("""
                INSERT INTO `reviews`(`review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),
                `customer_id` = VALUES(`customer_id`),
                `order_item_id` = VALUES(`order_item_id`),
                `rating` = VALUES(`rating`),
                `title` = VALUES(`title`),
                `content` = VALUES(`content`),
                `pros` = VALUES(`pros`),
                `cons` = VALUES(`cons`),
                `images` = VALUES(`images`),
                `is_verified_purchase` = VALUES(`is_verified_purchase`),
                `is_approved` = VALUES(`is_approved`),
                `helpful_votes` = VALUES(`helpful_votes`),
                `unhelpful_votes` = VALUES(`unhelpful_votes`),
                `admin_response` = VALUES(`admin_response`),
                `responded_at` = VALUES(`responded_at`),
                `created_at` = VALUES(`created_at`),
                `updated_at` = VALUES(`updated_at`)
                RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`"""))
      .updateReturningEach(ReviewsRow._rowParser, unsaved)
      .runUnchecked(c);
  };
}