/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.reviews;

import static typo.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import testdb.customers.CustomersId;
import testdb.order_items.OrderItemsId;
import testdb.products.ProductsId;
import typo.dsl.DeleteBuilder;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.dsl.UpdateBuilder;
import typo.runtime.Fragment;
import typo.runtime.MariaTypes;

public class ReviewsRepoImpl implements ReviewsRepo {
  @Override
  public DeleteBuilder<ReviewsFields, ReviewsRow> delete() {
    return DeleteBuilder.of("`reviews`", ReviewsFields.structure(), Dialect.MARIADB);
  }
  ;

  @Override
  public Boolean deleteById(ReviewsId reviewId, Connection c) {
    return interpolate(
                Fragment.lit("delete from `reviews` where `review_id` = "),
                Fragment.encode(ReviewsId.pgType, reviewId),
                Fragment.lit(""))
            .update()
            .runUnchecked(c)
        > 0;
  }
  ;

  @Override
  public Integer deleteByIds(ReviewsId[] reviewIds, Connection c) {
    ArrayList<Fragment> fragments = new ArrayList<>();
    for (var id : reviewIds) {
      fragments.add(Fragment.encode(ReviewsId.pgType, id));
    }
    ;
    return Fragment.interpolate(
            Fragment.lit("delete from `reviews` where `review_id` in ("),
            Fragment.comma(fragments),
            Fragment.lit(")"))
        .update()
        .runUnchecked(c);
  }
  ;

  @Override
  public ReviewsRow insert(ReviewsRow unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "insert into `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`,"
                    + " `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`,"
                    + " `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`,"
                    + " `responded_at`, `created_at`, `updated_at`)\n"
                    + "values ("),
            Fragment.encode(ProductsId.pgType, unsaved.productId()),
            Fragment.lit(", "),
            Fragment.encode(CustomersId.pgType, unsaved.customerId()),
            Fragment.lit(", "),
            Fragment.encode(OrderItemsId.pgType.opt(), unsaved.orderItemId()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.tinyintUnsigned, unsaved.rating()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar.opt(), unsaved.title()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.text.opt(), unsaved.content()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.longtext.opt(), unsaved.pros()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.longtext.opt(), unsaved.cons()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.longtext.opt(), unsaved.images()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.bool, unsaved.isVerifiedPurchase()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.bool, unsaved.isApproved()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.intUnsigned, unsaved.helpfulVotes()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.intUnsigned, unsaved.unhelpfulVotes()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.text.opt(), unsaved.adminResponse()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime.opt(), unsaved.respondedAt()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime, unsaved.createdAt()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime, unsaved.updatedAt()),
            Fragment.lit(
                ")\n"
                    + "RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`,"
                    + " `rating`, `title`, `content`, `pros`, `cons`, `images`,"
                    + " `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`,"
                    + " `admin_response`, `responded_at`, `created_at`, `updated_at`\n"))
        .updateReturning(ReviewsRow._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public ReviewsRow insert(ReviewsRowUnsaved unsaved, Connection c) {
    ArrayList<Fragment> columns = new ArrayList<>();
    ;
    ArrayList<Fragment> values = new ArrayList<>();
    ;
    columns.add(Fragment.lit("`product_id`"));
    values.add(
        interpolate(Fragment.encode(ProductsId.pgType, unsaved.productId()), Fragment.lit("")));
    columns.add(Fragment.lit("`customer_id`"));
    values.add(
        interpolate(Fragment.encode(CustomersId.pgType, unsaved.customerId()), Fragment.lit("")));
    columns.add(Fragment.lit("`rating`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.tinyintUnsigned, unsaved.rating()), Fragment.lit("")));
    unsaved
        .orderItemId()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`order_item_id`"));
              values.add(
                  interpolate(Fragment.encode(OrderItemsId.pgType.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .title()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`title`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.varchar.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .content()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`content`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.text.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .pros()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`pros`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.longtext.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .cons()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`cons`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.longtext.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .images()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`images`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.longtext.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .isVerifiedPurchase()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`is_verified_purchase`"));
              values.add(interpolate(Fragment.encode(MariaTypes.bool, value), Fragment.lit("")));
            });
    ;
    unsaved
        .isApproved()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`is_approved`"));
              values.add(interpolate(Fragment.encode(MariaTypes.bool, value), Fragment.lit("")));
            });
    ;
    unsaved
        .helpfulVotes()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`helpful_votes`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.intUnsigned, value), Fragment.lit("")));
            });
    ;
    unsaved
        .unhelpfulVotes()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`unhelpful_votes`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.intUnsigned, value), Fragment.lit("")));
            });
    ;
    unsaved
        .adminResponse()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`admin_response`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.text.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .respondedAt()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`responded_at`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.datetime.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .createdAt()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`created_at`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.datetime, value), Fragment.lit("")));
            });
    ;
    unsaved
        .updatedAt()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`updated_at`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.datetime, value), Fragment.lit("")));
            });
    ;
    Fragment q =
        interpolate(
            Fragment.lit("insert into `reviews`("),
            Fragment.comma(columns),
            Fragment.lit(")\nvalues ("),
            Fragment.comma(values),
            Fragment.lit(
                ")\n"
                    + "RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`,"
                    + " `rating`, `title`, `content`, `pros`, `cons`, `images`,"
                    + " `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`,"
                    + " `admin_response`, `responded_at`, `created_at`, `updated_at`\n"));
    ;
    return q.updateReturning(ReviewsRow._rowParser.exactlyOne()).runUnchecked(c);
  }
  ;

  @Override
  public SelectBuilder<ReviewsFields, ReviewsRow> select() {
    return SelectBuilder.of(
        "`reviews`", ReviewsFields.structure(), ReviewsRow._rowParser, Dialect.MARIADB);
  }
  ;

  @Override
  public List<ReviewsRow> selectAll(Connection c) {
    return interpolate(
            Fragment.lit(
                "select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`,"
                    + " `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`,"
                    + " `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`,"
                    + " `responded_at`, `created_at`, `updated_at`\n"
                    + "from `reviews`\n"))
        .query(ReviewsRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Optional<ReviewsRow> selectById(ReviewsId reviewId, Connection c) {
    return interpolate(
            Fragment.lit(
                "select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`,"
                    + " `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`,"
                    + " `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`,"
                    + " `responded_at`, `created_at`, `updated_at`\n"
                    + "from `reviews`\n"
                    + "where `review_id` = "),
            Fragment.encode(ReviewsId.pgType, reviewId),
            Fragment.lit(""))
        .query(ReviewsRow._rowParser.first())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<ReviewsRow> selectByIds(ReviewsId[] reviewIds, Connection c) {
    ArrayList<Fragment> fragments = new ArrayList<>();
    for (var id : reviewIds) {
      fragments.add(Fragment.encode(ReviewsId.pgType, id));
    }
    ;
    return Fragment.interpolate(
            Fragment.lit(
                "select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`,"
                    + " `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`,"
                    + " `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`,"
                    + " `responded_at`, `created_at`, `updated_at` from `reviews` where `review_id`"
                    + " in ("),
            Fragment.comma(fragments),
            Fragment.lit(")"))
        .query(ReviewsRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Map<ReviewsId, ReviewsRow> selectByIdsTracked(ReviewsId[] reviewIds, Connection c) {
    HashMap<ReviewsId, ReviewsRow> ret = new HashMap<ReviewsId, ReviewsRow>();
    selectByIds(reviewIds, c).forEach(row -> ret.put(row.reviewId(), row));
    return ret;
  }
  ;

  @Override
  public UpdateBuilder<ReviewsFields, ReviewsRow> update() {
    return UpdateBuilder.of(
        "`reviews`", ReviewsFields.structure(), ReviewsRow._rowParser, Dialect.MARIADB);
  }
  ;

  @Override
  public Boolean update(ReviewsRow row, Connection c) {
    ReviewsId reviewId = row.reviewId();
    ;
    return interpolate(
                Fragment.lit("update `reviews`\nset `product_id` = "),
                Fragment.encode(ProductsId.pgType, row.productId()),
                Fragment.lit(",\n`customer_id` = "),
                Fragment.encode(CustomersId.pgType, row.customerId()),
                Fragment.lit(",\n`order_item_id` = "),
                Fragment.encode(OrderItemsId.pgType.opt(), row.orderItemId()),
                Fragment.lit(",\n`rating` = "),
                Fragment.encode(MariaTypes.tinyintUnsigned, row.rating()),
                Fragment.lit(",\n`title` = "),
                Fragment.encode(MariaTypes.varchar.opt(), row.title()),
                Fragment.lit(",\n`content` = "),
                Fragment.encode(MariaTypes.text.opt(), row.content()),
                Fragment.lit(",\n`pros` = "),
                Fragment.encode(MariaTypes.longtext.opt(), row.pros()),
                Fragment.lit(",\n`cons` = "),
                Fragment.encode(MariaTypes.longtext.opt(), row.cons()),
                Fragment.lit(",\n`images` = "),
                Fragment.encode(MariaTypes.longtext.opt(), row.images()),
                Fragment.lit(",\n`is_verified_purchase` = "),
                Fragment.encode(MariaTypes.bool, row.isVerifiedPurchase()),
                Fragment.lit(",\n`is_approved` = "),
                Fragment.encode(MariaTypes.bool, row.isApproved()),
                Fragment.lit(",\n`helpful_votes` = "),
                Fragment.encode(MariaTypes.intUnsigned, row.helpfulVotes()),
                Fragment.lit(",\n`unhelpful_votes` = "),
                Fragment.encode(MariaTypes.intUnsigned, row.unhelpfulVotes()),
                Fragment.lit(",\n`admin_response` = "),
                Fragment.encode(MariaTypes.text.opt(), row.adminResponse()),
                Fragment.lit(",\n`responded_at` = "),
                Fragment.encode(MariaTypes.datetime.opt(), row.respondedAt()),
                Fragment.lit(",\n`created_at` = "),
                Fragment.encode(MariaTypes.datetime, row.createdAt()),
                Fragment.lit(",\n`updated_at` = "),
                Fragment.encode(MariaTypes.datetime, row.updatedAt()),
                Fragment.lit("\nwhere `review_id` = "),
                Fragment.encode(ReviewsId.pgType, reviewId),
                Fragment.lit(""))
            .update()
            .runUnchecked(c)
        > 0;
  }
  ;

  @Override
  public ReviewsRow upsert(ReviewsRow unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "INSERT INTO `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`,"
                    + " `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`,"
                    + " `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`,"
                    + " `responded_at`, `created_at`, `updated_at`)\n"
                    + "VALUES ("),
            Fragment.encode(ProductsId.pgType, unsaved.productId()),
            Fragment.lit(", "),
            Fragment.encode(CustomersId.pgType, unsaved.customerId()),
            Fragment.lit(", "),
            Fragment.encode(OrderItemsId.pgType.opt(), unsaved.orderItemId()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.tinyintUnsigned, unsaved.rating()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar.opt(), unsaved.title()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.text.opt(), unsaved.content()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.longtext.opt(), unsaved.pros()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.longtext.opt(), unsaved.cons()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.longtext.opt(), unsaved.images()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.bool, unsaved.isVerifiedPurchase()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.bool, unsaved.isApproved()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.intUnsigned, unsaved.helpfulVotes()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.intUnsigned, unsaved.unhelpfulVotes()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.text.opt(), unsaved.adminResponse()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime.opt(), unsaved.respondedAt()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime, unsaved.createdAt()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime, unsaved.updatedAt()),
            Fragment.lit(
                ")\n"
                    + "ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),\n"
                    + "`customer_id` = VALUES(`customer_id`),\n"
                    + "`order_item_id` = VALUES(`order_item_id`),\n"
                    + "`rating` = VALUES(`rating`),\n"
                    + "`title` = VALUES(`title`),\n"
                    + "`content` = VALUES(`content`),\n"
                    + "`pros` = VALUES(`pros`),\n"
                    + "`cons` = VALUES(`cons`),\n"
                    + "`images` = VALUES(`images`),\n"
                    + "`is_verified_purchase` = VALUES(`is_verified_purchase`),\n"
                    + "`is_approved` = VALUES(`is_approved`),\n"
                    + "`helpful_votes` = VALUES(`helpful_votes`),\n"
                    + "`unhelpful_votes` = VALUES(`unhelpful_votes`),\n"
                    + "`admin_response` = VALUES(`admin_response`),\n"
                    + "`responded_at` = VALUES(`responded_at`),\n"
                    + "`created_at` = VALUES(`created_at`),\n"
                    + "`updated_at` = VALUES(`updated_at`)\n"
                    + "RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`,"
                    + " `rating`, `title`, `content`, `pros`, `cons`, `images`,"
                    + " `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`,"
                    + " `admin_response`, `responded_at`, `created_at`, `updated_at`"))
        .updateReturning(ReviewsRow._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<ReviewsRow> upsertBatch(Iterator<ReviewsRow> unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "INSERT INTO `reviews`(`review_id`, `product_id`, `customer_id`, `order_item_id`,"
                    + " `rating`, `title`, `content`, `pros`, `cons`, `images`,"
                    + " `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`,"
                    + " `admin_response`, `responded_at`, `created_at`, `updated_at`)\n"
                    + "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n"
                    + "ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),\n"
                    + "`customer_id` = VALUES(`customer_id`),\n"
                    + "`order_item_id` = VALUES(`order_item_id`),\n"
                    + "`rating` = VALUES(`rating`),\n"
                    + "`title` = VALUES(`title`),\n"
                    + "`content` = VALUES(`content`),\n"
                    + "`pros` = VALUES(`pros`),\n"
                    + "`cons` = VALUES(`cons`),\n"
                    + "`images` = VALUES(`images`),\n"
                    + "`is_verified_purchase` = VALUES(`is_verified_purchase`),\n"
                    + "`is_approved` = VALUES(`is_approved`),\n"
                    + "`helpful_votes` = VALUES(`helpful_votes`),\n"
                    + "`unhelpful_votes` = VALUES(`unhelpful_votes`),\n"
                    + "`admin_response` = VALUES(`admin_response`),\n"
                    + "`responded_at` = VALUES(`responded_at`),\n"
                    + "`created_at` = VALUES(`created_at`),\n"
                    + "`updated_at` = VALUES(`updated_at`)\n"
                    + "RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`,"
                    + " `rating`, `title`, `content`, `pros`, `cons`, `images`,"
                    + " `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`,"
                    + " `admin_response`, `responded_at`, `created_at`, `updated_at`"))
        .updateReturningEach(ReviewsRow._rowParser, unsaved)
        .runUnchecked(c);
  }
  ;
}
