/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.product_search;

import java.math.BigDecimal;
import java.sql.Connection;
import java.util.List;
import java.util.Optional;
import typo.runtime.MariaTypes;
import static typo.runtime.Fragment.interpolate;

public class ProductSearchSqlRepoImpl implements ProductSearchSqlRepo {
  @Override
  public List<ProductSearchSqlRow> apply(
    Optional<Integer> brandId,
    Optional<BigDecimal> minPrice,
    Optional<BigDecimal> maxPrice,
    Optional<String> status,
    Long limit,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         -- Search products with optional filters
         SELECT p.product_id,
                p.sku,
                p.name,
                p.short_description,
                p.base_price,
                p.status,
                b.name AS brand_name
         FROM products p
         LEFT JOIN brands b ON p.brand_id = b.brand_id
         WHERE ("""),
      MariaTypes.int_.opt().encode(brandId),
      typo.runtime.Fragment.lit(" IS NULL OR p.brand_id = "),
      MariaTypes.int_.opt().encode(brandId),
      typo.runtime.Fragment.lit("""
         )
           AND ("""),
      MariaTypes.numeric.opt().encode(minPrice),
      typo.runtime.Fragment.lit(" IS NULL OR p.base_price >= "),
      MariaTypes.numeric.opt().encode(minPrice),
      typo.runtime.Fragment.lit("""
         )
           AND ("""),
      MariaTypes.numeric.opt().encode(maxPrice),
      typo.runtime.Fragment.lit(" IS NULL OR p.base_price <= "),
      MariaTypes.numeric.opt().encode(maxPrice),
      typo.runtime.Fragment.lit("""
         )
           AND ("""),
      MariaTypes.text.opt().encode(status),
      typo.runtime.Fragment.lit(" IS NULL OR p.status = "),
      MariaTypes.text.opt().encode(status),
      typo.runtime.Fragment.lit("""
         )
         ORDER BY p.name
         LIMIT """),
      MariaTypes.bigint.encode(limit),
      typo.runtime.Fragment.lit("""


      """)
    ).query(ProductSearchSqlRow._rowParser.all()).runUnchecked(c);
  };
}