/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.customer_addresses;

import static typo.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import testdb.customers.CustomersId;
import typo.dsl.DeleteBuilder;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.dsl.UpdateBuilder;
import typo.runtime.Fragment;
import typo.runtime.MariaTypes;

public class CustomerAddressesRepoImpl implements CustomerAddressesRepo {
  @Override
  public DeleteBuilder<CustomerAddressesFields, CustomerAddressesRow> delete() {
    return DeleteBuilder.of(
        "`customer_addresses`", CustomerAddressesFields.structure(), Dialect.MARIADB);
  }
  ;

  @Override
  public Boolean deleteById(CustomerAddressesId addressId, Connection c) {
    return interpolate(
                Fragment.lit("delete from `customer_addresses` where `address_id` = "),
                Fragment.encode(CustomerAddressesId.pgType, addressId),
                Fragment.lit(""))
            .update()
            .runUnchecked(c)
        > 0;
  }
  ;

  @Override
  public Integer deleteByIds(CustomerAddressesId[] addressIds, Connection c) {
    ArrayList<Fragment> fragments = new ArrayList<>();
    for (var id : addressIds) {
      fragments.add(Fragment.encode(CustomerAddressesId.pgType, id));
    }
    ;
    return Fragment.interpolate(
            Fragment.lit("delete from `customer_addresses` where `address_id` in ("),
            Fragment.comma(fragments),
            Fragment.lit(")"))
        .update()
        .runUnchecked(c);
  }
  ;

  @Override
  public CustomerAddressesRow insert(CustomerAddressesRow unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "insert into `customer_addresses`(`customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`,"
                    + " `created_at`)\n"
                    + "values ("),
            Fragment.encode(CustomersId.pgType, unsaved.customerId()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.text, unsaved.addressType()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.bool, unsaved.isDefault()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.recipientName()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.streetLine1()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar.opt(), unsaved.streetLine2()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.city()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar.opt(), unsaved.stateProvince()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.postalCode()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.char_, unsaved.countryCode()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.point.opt(), unsaved.location()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.tinytext.opt(), unsaved.deliveryNotes()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime, unsaved.createdAt()),
            Fragment.lit(
                ")\n"
                    + "RETURNING `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`,"
                    + " `created_at`\n"))
        .updateReturning(CustomerAddressesRow._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public CustomerAddressesRow insert(CustomerAddressesRowUnsaved unsaved, Connection c) {
    ArrayList<Fragment> columns = new ArrayList<>();
    ;
    ArrayList<Fragment> values = new ArrayList<>();
    ;
    columns.add(Fragment.lit("`customer_id`"));
    values.add(
        interpolate(Fragment.encode(CustomersId.pgType, unsaved.customerId()), Fragment.lit("")));
    columns.add(Fragment.lit("`address_type`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.text, unsaved.addressType()), Fragment.lit("")));
    columns.add(Fragment.lit("`recipient_name`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.varchar, unsaved.recipientName()), Fragment.lit("")));
    columns.add(Fragment.lit("`street_line1`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.varchar, unsaved.streetLine1()), Fragment.lit("")));
    columns.add(Fragment.lit("`city`"));
    values.add(interpolate(Fragment.encode(MariaTypes.varchar, unsaved.city()), Fragment.lit("")));
    columns.add(Fragment.lit("`postal_code`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.varchar, unsaved.postalCode()), Fragment.lit("")));
    columns.add(Fragment.lit("`country_code`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.char_, unsaved.countryCode()), Fragment.lit("")));
    unsaved
        .isDefault()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`is_default`"));
              values.add(interpolate(Fragment.encode(MariaTypes.bool, value), Fragment.lit("")));
            });
    ;
    unsaved
        .streetLine2()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`street_line2`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.varchar.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .stateProvince()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`state_province`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.varchar.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .location()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`location`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.point.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .deliveryNotes()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`delivery_notes`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.tinytext.opt(), value), Fragment.lit("")));
            });
    ;
    unsaved
        .createdAt()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("`created_at`"));
              values.add(
                  interpolate(Fragment.encode(MariaTypes.datetime, value), Fragment.lit("")));
            });
    ;
    Fragment q =
        interpolate(
            Fragment.lit("insert into `customer_addresses`("),
            Fragment.comma(columns),
            Fragment.lit(")\nvalues ("),
            Fragment.comma(values),
            Fragment.lit(
                ")\n"
                    + "RETURNING `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`,"
                    + " `created_at`\n"));
    ;
    return q.updateReturning(CustomerAddressesRow._rowParser.exactlyOne()).runUnchecked(c);
  }
  ;

  @Override
  public SelectBuilder<CustomerAddressesFields, CustomerAddressesRow> select() {
    return SelectBuilder.of(
        "`customer_addresses`",
        CustomerAddressesFields.structure(),
        CustomerAddressesRow._rowParser,
        Dialect.MARIADB);
  }
  ;

  @Override
  public List<CustomerAddressesRow> selectAll(Connection c) {
    return interpolate(
            Fragment.lit(
                "select `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`\n"
                    + "from `customer_addresses`\n"))
        .query(CustomerAddressesRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Optional<CustomerAddressesRow> selectById(CustomerAddressesId addressId, Connection c) {
    return interpolate(
            Fragment.lit(
                "select `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`\n"
                    + "from `customer_addresses`\n"
                    + "where `address_id` = "),
            Fragment.encode(CustomerAddressesId.pgType, addressId),
            Fragment.lit(""))
        .query(CustomerAddressesRow._rowParser.first())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<CustomerAddressesRow> selectByIds(CustomerAddressesId[] addressIds, Connection c) {
    ArrayList<Fragment> fragments = new ArrayList<>();
    for (var id : addressIds) {
      fragments.add(Fragment.encode(CustomerAddressesId.pgType, id));
    }
    ;
    return Fragment.interpolate(
            Fragment.lit(
                "select `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`"
                    + " from `customer_addresses` where `address_id` in ("),
            Fragment.comma(fragments),
            Fragment.lit(")"))
        .query(CustomerAddressesRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Map<CustomerAddressesId, CustomerAddressesRow> selectByIdsTracked(
      CustomerAddressesId[] addressIds, Connection c) {
    HashMap<CustomerAddressesId, CustomerAddressesRow> ret =
        new HashMap<CustomerAddressesId, CustomerAddressesRow>();
    selectByIds(addressIds, c).forEach(row -> ret.put(row.addressId(), row));
    return ret;
  }
  ;

  @Override
  public UpdateBuilder<CustomerAddressesFields, CustomerAddressesRow> update() {
    return UpdateBuilder.of(
        "`customer_addresses`",
        CustomerAddressesFields.structure(),
        CustomerAddressesRow._rowParser,
        Dialect.MARIADB);
  }
  ;

  @Override
  public Boolean update(CustomerAddressesRow row, Connection c) {
    CustomerAddressesId addressId = row.addressId();
    ;
    return interpolate(
                Fragment.lit("update `customer_addresses`\nset `customer_id` = "),
                Fragment.encode(CustomersId.pgType, row.customerId()),
                Fragment.lit(",\n`address_type` = "),
                Fragment.encode(MariaTypes.text, row.addressType()),
                Fragment.lit(",\n`is_default` = "),
                Fragment.encode(MariaTypes.bool, row.isDefault()),
                Fragment.lit(",\n`recipient_name` = "),
                Fragment.encode(MariaTypes.varchar, row.recipientName()),
                Fragment.lit(",\n`street_line1` = "),
                Fragment.encode(MariaTypes.varchar, row.streetLine1()),
                Fragment.lit(",\n`street_line2` = "),
                Fragment.encode(MariaTypes.varchar.opt(), row.streetLine2()),
                Fragment.lit(",\n`city` = "),
                Fragment.encode(MariaTypes.varchar, row.city()),
                Fragment.lit(",\n`state_province` = "),
                Fragment.encode(MariaTypes.varchar.opt(), row.stateProvince()),
                Fragment.lit(",\n`postal_code` = "),
                Fragment.encode(MariaTypes.varchar, row.postalCode()),
                Fragment.lit(",\n`country_code` = "),
                Fragment.encode(MariaTypes.char_, row.countryCode()),
                Fragment.lit(",\n`location` = "),
                Fragment.encode(MariaTypes.point.opt(), row.location()),
                Fragment.lit(",\n`delivery_notes` = "),
                Fragment.encode(MariaTypes.tinytext.opt(), row.deliveryNotes()),
                Fragment.lit(",\n`created_at` = "),
                Fragment.encode(MariaTypes.datetime, row.createdAt()),
                Fragment.lit("\nwhere `address_id` = "),
                Fragment.encode(CustomerAddressesId.pgType, addressId),
                Fragment.lit(""))
            .update()
            .runUnchecked(c)
        > 0;
  }
  ;

  @Override
  public CustomerAddressesRow upsert(CustomerAddressesRow unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "INSERT INTO `customer_addresses`(`customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`,"
                    + " `created_at`)\n"
                    + "VALUES ("),
            Fragment.encode(CustomersId.pgType, unsaved.customerId()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.text, unsaved.addressType()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.bool, unsaved.isDefault()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.recipientName()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.streetLine1()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar.opt(), unsaved.streetLine2()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.city()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar.opt(), unsaved.stateProvince()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.varchar, unsaved.postalCode()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.char_, unsaved.countryCode()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.point.opt(), unsaved.location()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.tinytext.opt(), unsaved.deliveryNotes()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.datetime, unsaved.createdAt()),
            Fragment.lit(
                ")\n"
                    + "ON DUPLICATE KEY UPDATE `customer_id` = VALUES(`customer_id`),\n"
                    + "`address_type` = VALUES(`address_type`),\n"
                    + "`is_default` = VALUES(`is_default`),\n"
                    + "`recipient_name` = VALUES(`recipient_name`),\n"
                    + "`street_line1` = VALUES(`street_line1`),\n"
                    + "`street_line2` = VALUES(`street_line2`),\n"
                    + "`city` = VALUES(`city`),\n"
                    + "`state_province` = VALUES(`state_province`),\n"
                    + "`postal_code` = VALUES(`postal_code`),\n"
                    + "`country_code` = VALUES(`country_code`),\n"
                    + "`location` = VALUES(`location`),\n"
                    + "`delivery_notes` = VALUES(`delivery_notes`),\n"
                    + "`created_at` = VALUES(`created_at`)\n"
                    + "RETURNING `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`"))
        .updateReturning(CustomerAddressesRow._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<CustomerAddressesRow> upsertBatch(
      Iterator<CustomerAddressesRow> unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "INSERT INTO `customer_addresses`(`address_id`, `customer_id`, `address_type`,"
                    + " `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`,"
                    + " `state_province`, `postal_code`, `country_code`, `location`,"
                    + " `delivery_notes`, `created_at`)\n"
                    + "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n"
                    + "ON DUPLICATE KEY UPDATE `customer_id` = VALUES(`customer_id`),\n"
                    + "`address_type` = VALUES(`address_type`),\n"
                    + "`is_default` = VALUES(`is_default`),\n"
                    + "`recipient_name` = VALUES(`recipient_name`),\n"
                    + "`street_line1` = VALUES(`street_line1`),\n"
                    + "`street_line2` = VALUES(`street_line2`),\n"
                    + "`city` = VALUES(`city`),\n"
                    + "`state_province` = VALUES(`state_province`),\n"
                    + "`postal_code` = VALUES(`postal_code`),\n"
                    + "`country_code` = VALUES(`country_code`),\n"
                    + "`location` = VALUES(`location`),\n"
                    + "`delivery_notes` = VALUES(`delivery_notes`),\n"
                    + "`created_at` = VALUES(`created_at`)\n"
                    + "RETURNING `address_id`, `customer_id`, `address_type`, `is_default`,"
                    + " `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`,"
                    + " `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`"))
        .updateReturningEach(CustomerAddressesRow._rowParser, unsaved)
        .runUnchecked(c);
  }
  ;
}
