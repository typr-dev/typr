/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.customer_addresses;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import testdb.customers.CustomersId;
import typo.dsl.DeleteBuilder;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.dsl.UpdateBuilder;
import typo.runtime.Fragment;
import typo.runtime.Fragment.Literal;
import typo.runtime.MariaTypes;
import static typo.runtime.Fragment.interpolate;

public class CustomerAddressesRepoImpl implements CustomerAddressesRepo {
  @Override
  public DeleteBuilder<CustomerAddressesFields, CustomerAddressesRow> delete() {
    return DeleteBuilder.of("`customer_addresses`", CustomerAddressesFields.structure(), Dialect.MARIADB);
  };

  @Override
  public Boolean deleteById(
    CustomerAddressesId addressId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("delete from `customer_addresses` where `address_id` = "),
      CustomerAddressesId.pgType.encode(addressId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public Integer deleteByIds(
    CustomerAddressesId[] addressIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : addressIds) { fragments.add(CustomerAddressesId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("delete from `customer_addresses` where `address_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c);
  };

  @Override
  public CustomerAddressesRow insert(
    CustomerAddressesRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         insert into `customer_addresses`(`customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`)
         values ("""),
      CustomersId.pgType.encode(unsaved.customerId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.addressType()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isDefault()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.recipientName()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.streetLine1()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.streetLine2()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.city()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.stateProvince()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.postalCode()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.countryCode()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.point.opt().encode(unsaved.location()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.deliveryNotes()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.createdAt()),
      typo.runtime.Fragment.lit("""
         )
         returning `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`
      """)
    )
      .updateReturning(CustomerAddressesRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public CustomerAddressesRow insert(
    CustomerAddressesRowUnsaved unsaved,
    Connection c
  ) {
    ArrayList<Literal> columns = new ArrayList<Literal>();;
    ArrayList<Fragment> values = new ArrayList<Fragment>();;
    columns.add(Fragment.lit("`customer_id`"));
    values.add(interpolate(
      CustomersId.pgType.encode(unsaved.customerId()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`address_type`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.addressType()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`recipient_name`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.recipientName()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`street_line1`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.streetLine1()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`city`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.city()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`postal_code`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.postalCode()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`country_code`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.countryCode()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    unsaved.isDefault().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`is_default`"));
        values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.streetLine2().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`street_line2`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.stateProvince().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`state_province`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.location().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`location`"));
        values.add(interpolate(
        MariaTypes.point.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.deliveryNotes().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`delivery_notes`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.createdAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`created_at`"));
        values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    Fragment q = interpolate(
      typo.runtime.Fragment.lit("insert into `customer_addresses`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
         )
         values ("""),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
         )
         returning `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`
      """)
    );;
    return q.updateReturning(CustomerAddressesRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public SelectBuilder<CustomerAddressesFields, CustomerAddressesRow> select() {
    return SelectBuilder.of("`customer_addresses`", CustomerAddressesFields.structure(), CustomerAddressesRow._rowParser, Dialect.MARIADB);
  };

  @Override
  public List<CustomerAddressesRow> selectAll(Connection c) {
    return interpolate(typo.runtime.Fragment.lit("""
       select `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`
       from `customer_addresses`
    """)).query(CustomerAddressesRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Optional<CustomerAddressesRow> selectById(
    CustomerAddressesId addressId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         select `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`
         from `customer_addresses`
         where `address_id` = """),
      CustomerAddressesId.pgType.encode(addressId),
      typo.runtime.Fragment.lit("")
    ).query(CustomerAddressesRow._rowParser.first()).runUnchecked(c);
  };

  @Override
  public List<CustomerAddressesRow> selectByIds(
    CustomerAddressesId[] addressIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : addressIds) { fragments.add(CustomerAddressesId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("select `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at` from `customer_addresses` where `address_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(CustomerAddressesRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Map<CustomerAddressesId, CustomerAddressesRow> selectByIdsTracked(
    CustomerAddressesId[] addressIds,
    Connection c
  ) {
    HashMap<CustomerAddressesId, CustomerAddressesRow> ret = new HashMap<CustomerAddressesId, CustomerAddressesRow>();
    selectByIds(addressIds, c).forEach(row -> ret.put(row.addressId(), row));
    return ret;
  };

  @Override
  public UpdateBuilder<CustomerAddressesFields, CustomerAddressesRow> update() {
    return UpdateBuilder.of("`customer_addresses`", CustomerAddressesFields.structure(), CustomerAddressesRow._rowParser.all(), Dialect.MARIADB);
  };

  @Override
  public Boolean update(
    CustomerAddressesRow row,
    Connection c
  ) {
    CustomerAddressesId addressId = row.addressId();;
    return interpolate(
      typo.runtime.Fragment.lit("""
         update `customer_addresses`
         set `customer_id` = """),
      CustomersId.pgType.encode(row.customerId()),
      typo.runtime.Fragment.lit("""
         ,
         `address_type` = """),
      MariaTypes.text.encode(row.addressType()),
      typo.runtime.Fragment.lit("""
         ,
         `is_default` = """),
      MariaTypes.bool.encode(row.isDefault()),
      typo.runtime.Fragment.lit("""
         ,
         `recipient_name` = """),
      MariaTypes.text.encode(row.recipientName()),
      typo.runtime.Fragment.lit("""
         ,
         `street_line1` = """),
      MariaTypes.text.encode(row.streetLine1()),
      typo.runtime.Fragment.lit("""
         ,
         `street_line2` = """),
      MariaTypes.text.opt().encode(row.streetLine2()),
      typo.runtime.Fragment.lit("""
         ,
         `city` = """),
      MariaTypes.text.encode(row.city()),
      typo.runtime.Fragment.lit("""
         ,
         `state_province` = """),
      MariaTypes.text.opt().encode(row.stateProvince()),
      typo.runtime.Fragment.lit("""
         ,
         `postal_code` = """),
      MariaTypes.text.encode(row.postalCode()),
      typo.runtime.Fragment.lit("""
         ,
         `country_code` = """),
      MariaTypes.text.encode(row.countryCode()),
      typo.runtime.Fragment.lit("""
         ,
         `location` = """),
      MariaTypes.point.opt().encode(row.location()),
      typo.runtime.Fragment.lit("""
         ,
         `delivery_notes` = """),
      MariaTypes.text.opt().encode(row.deliveryNotes()),
      typo.runtime.Fragment.lit("""
         ,
         `created_at` = """),
      MariaTypes.datetime.encode(row.createdAt()),
      typo.runtime.Fragment.lit("""
   
         where `address_id` = """),
      CustomerAddressesId.pgType.encode(addressId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public CustomerAddressesRow upsert(
    CustomerAddressesRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         INSERT INTO `customer_addresses`(`customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`)
         VALUES ("""),
      CustomersId.pgType.encode(unsaved.customerId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.addressType()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isDefault()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.recipientName()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.streetLine1()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.streetLine2()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.city()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.stateProvince()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.postalCode()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.countryCode()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.point.opt().encode(unsaved.location()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.deliveryNotes()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.createdAt()),
      typo.runtime.Fragment.lit("""
         )
         ON DUPLICATE KEY UPDATE `customer_id` = VALUES(`customer_id`),
         `address_type` = VALUES(`address_type`),
         `is_default` = VALUES(`is_default`),
         `recipient_name` = VALUES(`recipient_name`),
         `street_line1` = VALUES(`street_line1`),
         `street_line2` = VALUES(`street_line2`),
         `city` = VALUES(`city`),
         `state_province` = VALUES(`state_province`),
         `postal_code` = VALUES(`postal_code`),
         `country_code` = VALUES(`country_code`),
         `location` = VALUES(`location`),
         `delivery_notes` = VALUES(`delivery_notes`),
         `created_at` = VALUES(`created_at`)
         RETURNING `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`""")
    )
      .updateReturning(CustomerAddressesRow._rowParser.exactlyOne())
      .runUnchecked(c);
  };

  @Override
  public List<CustomerAddressesRow> upsertBatch(
    Iterator<CustomerAddressesRow> unsaved,
    Connection c
  ) {
    return interpolate(typo.runtime.Fragment.lit("""
                INSERT INTO `customer_addresses`(`address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                ON DUPLICATE KEY UPDATE `customer_id` = VALUES(`customer_id`),
                `address_type` = VALUES(`address_type`),
                `is_default` = VALUES(`is_default`),
                `recipient_name` = VALUES(`recipient_name`),
                `street_line1` = VALUES(`street_line1`),
                `street_line2` = VALUES(`street_line2`),
                `city` = VALUES(`city`),
                `state_province` = VALUES(`state_province`),
                `postal_code` = VALUES(`postal_code`),
                `country_code` = VALUES(`country_code`),
                `location` = VALUES(`location`),
                `delivery_notes` = VALUES(`delivery_notes`),
                `created_at` = VALUES(`created_at`)
                RETURNING `address_id`, `customer_id`, `address_type`, `is_default`, `recipient_name`, `street_line1`, `street_line2`, `city`, `state_province`, `postal_code`, `country_code`, `location`, `delivery_notes`, `created_at`"""))
      .updateReturningEach(CustomerAddressesRow._rowParser, unsaved)
      .runUnchecked(c);
  };
}