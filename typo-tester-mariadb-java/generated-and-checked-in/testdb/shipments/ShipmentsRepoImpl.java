/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.shipments;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import testdb.orders.OrdersId;
import testdb.shipping_carriers.ShippingCarriersId;
import testdb.warehouses.WarehousesId;
import typo.dsl.DeleteBuilder;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.dsl.UpdateBuilder;
import typo.runtime.Fragment;
import typo.runtime.Fragment.Literal;
import typo.runtime.MariaTypes;
import static typo.runtime.Fragment.interpolate;

public class ShipmentsRepoImpl implements ShipmentsRepo {
  @Override
  public DeleteBuilder<ShipmentsFields, ShipmentsRow> delete() {
    return DeleteBuilder.of("`shipments`", ShipmentsFields.structure(), Dialect.MARIADB);
  };

  @Override
  public Boolean deleteById(
    ShipmentsId shipmentId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("delete from `shipments` where `shipment_id` = "),
      ShipmentsId.pgType.encode(shipmentId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public Integer deleteByIds(
    ShipmentsId[] shipmentIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : shipmentIds) { fragments.add(ShipmentsId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("delete from `shipments` where `shipment_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c);
  };

  @Override
  public ShipmentsRow insert(
    ShipmentsRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         insert into `shipments`(`order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`)
         values ("""),
      OrdersId.pgType.encode(unsaved.orderId()),
      typo.runtime.Fragment.lit(", "),
      ShippingCarriersId.pgType.encode(unsaved.carrierId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.trackingNumber()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.shippingMethod()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.numeric.opt().encode(unsaved.weightKg()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.dimensionsJson()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.blob.opt().encode(unsaved.labelData()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.status()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.date.opt().encode(unsaved.estimatedDeliveryDate()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.opt().encode(unsaved.actualDeliveryAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.numeric.encode(unsaved.shippingCost()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.numeric.opt().encode(unsaved.insuranceAmount()),
      typo.runtime.Fragment.lit(", "),
      WarehousesId.pgType.opt().encode(unsaved.originWarehouseId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.opt().encode(unsaved.shippedAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.createdAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.updatedAt()),
      typo.runtime.Fragment.lit("""
         )
         returning `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
      """)
    )
      .updateReturning(ShipmentsRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public ShipmentsRow insert(
    ShipmentsRowUnsaved unsaved,
    Connection c
  ) {
    ArrayList<Literal> columns = new ArrayList<Literal>();;
    ArrayList<Fragment> values = new ArrayList<Fragment>();;
    columns.add(Fragment.lit("`order_id`"));
    values.add(interpolate(
      OrdersId.pgType.encode(unsaved.orderId()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`carrier_id`"));
    values.add(interpolate(
      ShippingCarriersId.pgType.encode(unsaved.carrierId()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`shipping_method`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.shippingMethod()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`shipping_cost`"));
    values.add(interpolate(
      MariaTypes.numeric.encode(unsaved.shippingCost()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    unsaved.trackingNumber().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`tracking_number`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.weightKg().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`weight_kg`"));
        values.add(interpolate(
        MariaTypes.numeric.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.dimensionsJson().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`dimensions_json`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.labelData().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`label_data`"));
        values.add(interpolate(
        MariaTypes.blob.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.status().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`status`"));
        values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.estimatedDeliveryDate().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`estimated_delivery_date`"));
        values.add(interpolate(
        MariaTypes.date.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.actualDeliveryAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`actual_delivery_at`"));
        values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.insuranceAmount().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`insurance_amount`"));
        values.add(interpolate(
        MariaTypes.numeric.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.originWarehouseId().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`origin_warehouse_id`"));
        values.add(interpolate(
        WarehousesId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.shippedAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`shipped_at`"));
        values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.createdAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`created_at`"));
        values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.updatedAt().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`updated_at`"));
        values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    Fragment q = interpolate(
      typo.runtime.Fragment.lit("insert into `shipments`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
         )
         values ("""),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
         )
         returning `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
      """)
    );;
    return q.updateReturning(ShipmentsRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public SelectBuilder<ShipmentsFields, ShipmentsRow> select() {
    return SelectBuilder.of("`shipments`", ShipmentsFields.structure(), ShipmentsRow._rowParser, Dialect.MARIADB);
  };

  @Override
  public List<ShipmentsRow> selectAll(Connection c) {
    return interpolate(typo.runtime.Fragment.lit("""
       select `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
       from `shipments`
    """)).query(ShipmentsRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Optional<ShipmentsRow> selectById(
    ShipmentsId shipmentId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         select `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
         from `shipments`
         where `shipment_id` = """),
      ShipmentsId.pgType.encode(shipmentId),
      typo.runtime.Fragment.lit("")
    ).query(ShipmentsRow._rowParser.first()).runUnchecked(c);
  };

  @Override
  public List<ShipmentsRow> selectByIds(
    ShipmentsId[] shipmentIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : shipmentIds) { fragments.add(ShipmentsId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("select `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at` from `shipments` where `shipment_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(ShipmentsRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Map<ShipmentsId, ShipmentsRow> selectByIdsTracked(
    ShipmentsId[] shipmentIds,
    Connection c
  ) {
    HashMap<ShipmentsId, ShipmentsRow> ret = new HashMap<ShipmentsId, ShipmentsRow>();
    selectByIds(shipmentIds, c).forEach(row -> ret.put(row.shipmentId(), row));
    return ret;
  };

  @Override
  public UpdateBuilder<ShipmentsFields, ShipmentsRow> update() {
    return UpdateBuilder.of("`shipments`", ShipmentsFields.structure(), ShipmentsRow._rowParser.all(), Dialect.MARIADB);
  };

  @Override
  public Boolean update(
    ShipmentsRow row,
    Connection c
  ) {
    ShipmentsId shipmentId = row.shipmentId();;
    return interpolate(
      typo.runtime.Fragment.lit("""
         update `shipments`
         set `order_id` = """),
      OrdersId.pgType.encode(row.orderId()),
      typo.runtime.Fragment.lit("""
         ,
         `carrier_id` = """),
      ShippingCarriersId.pgType.encode(row.carrierId()),
      typo.runtime.Fragment.lit("""
         ,
         `tracking_number` = """),
      MariaTypes.text.opt().encode(row.trackingNumber()),
      typo.runtime.Fragment.lit("""
         ,
         `shipping_method` = """),
      MariaTypes.text.encode(row.shippingMethod()),
      typo.runtime.Fragment.lit("""
         ,
         `weight_kg` = """),
      MariaTypes.numeric.opt().encode(row.weightKg()),
      typo.runtime.Fragment.lit("""
         ,
         `dimensions_json` = """),
      MariaTypes.text.opt().encode(row.dimensionsJson()),
      typo.runtime.Fragment.lit("""
         ,
         `label_data` = """),
      MariaTypes.blob.opt().encode(row.labelData()),
      typo.runtime.Fragment.lit("""
         ,
         `status` = """),
      MariaTypes.text.encode(row.status()),
      typo.runtime.Fragment.lit("""
         ,
         `estimated_delivery_date` = """),
      MariaTypes.date.opt().encode(row.estimatedDeliveryDate()),
      typo.runtime.Fragment.lit("""
         ,
         `actual_delivery_at` = """),
      MariaTypes.datetime.opt().encode(row.actualDeliveryAt()),
      typo.runtime.Fragment.lit("""
         ,
         `shipping_cost` = """),
      MariaTypes.numeric.encode(row.shippingCost()),
      typo.runtime.Fragment.lit("""
         ,
         `insurance_amount` = """),
      MariaTypes.numeric.opt().encode(row.insuranceAmount()),
      typo.runtime.Fragment.lit("""
         ,
         `origin_warehouse_id` = """),
      WarehousesId.pgType.opt().encode(row.originWarehouseId()),
      typo.runtime.Fragment.lit("""
         ,
         `shipped_at` = """),
      MariaTypes.datetime.opt().encode(row.shippedAt()),
      typo.runtime.Fragment.lit("""
         ,
         `created_at` = """),
      MariaTypes.datetime.encode(row.createdAt()),
      typo.runtime.Fragment.lit("""
         ,
         `updated_at` = """),
      MariaTypes.datetime.encode(row.updatedAt()),
      typo.runtime.Fragment.lit("""
   
         where `shipment_id` = """),
      ShipmentsId.pgType.encode(shipmentId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public ShipmentsRow upsert(
    ShipmentsRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         INSERT INTO `shipments`(`order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`)
         VALUES ("""),
      OrdersId.pgType.encode(unsaved.orderId()),
      typo.runtime.Fragment.lit(", "),
      ShippingCarriersId.pgType.encode(unsaved.carrierId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.trackingNumber()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.shippingMethod()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.numeric.opt().encode(unsaved.weightKg()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.dimensionsJson()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.blob.opt().encode(unsaved.labelData()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.status()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.date.opt().encode(unsaved.estimatedDeliveryDate()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.opt().encode(unsaved.actualDeliveryAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.numeric.encode(unsaved.shippingCost()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.numeric.opt().encode(unsaved.insuranceAmount()),
      typo.runtime.Fragment.lit(", "),
      WarehousesId.pgType.opt().encode(unsaved.originWarehouseId()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.opt().encode(unsaved.shippedAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.createdAt()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.datetime.encode(unsaved.updatedAt()),
      typo.runtime.Fragment.lit("""
         )
         ON DUPLICATE KEY UPDATE `order_id` = VALUES(`order_id`),
         `carrier_id` = VALUES(`carrier_id`),
         `tracking_number` = VALUES(`tracking_number`),
         `shipping_method` = VALUES(`shipping_method`),
         `weight_kg` = VALUES(`weight_kg`),
         `dimensions_json` = VALUES(`dimensions_json`),
         `label_data` = VALUES(`label_data`),
         `status` = VALUES(`status`),
         `estimated_delivery_date` = VALUES(`estimated_delivery_date`),
         `actual_delivery_at` = VALUES(`actual_delivery_at`),
         `shipping_cost` = VALUES(`shipping_cost`),
         `insurance_amount` = VALUES(`insurance_amount`),
         `origin_warehouse_id` = VALUES(`origin_warehouse_id`),
         `shipped_at` = VALUES(`shipped_at`),
         `created_at` = VALUES(`created_at`),
         `updated_at` = VALUES(`updated_at`)
         RETURNING `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`""")
    )
      .updateReturning(ShipmentsRow._rowParser.exactlyOne())
      .runUnchecked(c);
  };

  @Override
  public List<ShipmentsRow> upsertBatch(
    Iterator<ShipmentsRow> unsaved,
    Connection c
  ) {
    return interpolate(typo.runtime.Fragment.lit("""
                INSERT INTO `shipments`(`shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                ON DUPLICATE KEY UPDATE `order_id` = VALUES(`order_id`),
                `carrier_id` = VALUES(`carrier_id`),
                `tracking_number` = VALUES(`tracking_number`),
                `shipping_method` = VALUES(`shipping_method`),
                `weight_kg` = VALUES(`weight_kg`),
                `dimensions_json` = VALUES(`dimensions_json`),
                `label_data` = VALUES(`label_data`),
                `status` = VALUES(`status`),
                `estimated_delivery_date` = VALUES(`estimated_delivery_date`),
                `actual_delivery_at` = VALUES(`actual_delivery_at`),
                `shipping_cost` = VALUES(`shipping_cost`),
                `insurance_amount` = VALUES(`insurance_amount`),
                `origin_warehouse_id` = VALUES(`origin_warehouse_id`),
                `shipped_at` = VALUES(`shipped_at`),
                `created_at` = VALUES(`created_at`),
                `updated_at` = VALUES(`updated_at`)
                RETURNING `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`"""))
      .updateReturningEach(ShipmentsRow._rowParser, unsaved)
      .runUnchecked(c);
  };
}