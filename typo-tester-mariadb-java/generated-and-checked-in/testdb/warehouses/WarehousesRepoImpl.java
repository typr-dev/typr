/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.warehouses;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import typo.dsl.DeleteBuilder;
import typo.dsl.Dialect;
import typo.dsl.SelectBuilder;
import typo.dsl.UpdateBuilder;
import typo.runtime.Fragment;
import typo.runtime.Fragment.Literal;
import typo.runtime.MariaTypes;
import static typo.runtime.Fragment.interpolate;

public class WarehousesRepoImpl implements WarehousesRepo {
  @Override
  public DeleteBuilder<WarehousesFields, WarehousesRow> delete() {
    return DeleteBuilder.of("`warehouses`", WarehousesFields.structure(), Dialect.MARIADB);
  };

  @Override
  public Boolean deleteById(
    WarehousesId warehouseId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("delete from `warehouses` where `warehouse_id` = "),
      WarehousesId.pgType.encode(warehouseId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public Integer deleteByIds(
    WarehousesId[] warehouseIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : warehouseIds) { fragments.add(WarehousesId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("delete from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c);
  };

  @Override
  public WarehousesRow insert(
    WarehousesRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         insert into `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
         values ("""),
      MariaTypes.text.encode(unsaved.code()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.name()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.address()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.point.encode(unsaved.location()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.polygon.opt().encode(unsaved.serviceArea()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.timezone()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isActive()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.contactEmail()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.contactPhone()),
      typo.runtime.Fragment.lit("""
         )
         returning `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      """)
    )
      .updateReturning(WarehousesRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public WarehousesRow insert(
    WarehousesRowUnsaved unsaved,
    Connection c
  ) {
    ArrayList<Literal> columns = new ArrayList<Literal>();;
    ArrayList<Fragment> values = new ArrayList<Fragment>();;
    columns.add(Fragment.lit("`code`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.code()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`name`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.name()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`address`"));
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.address()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    columns.add(Fragment.lit("`location`"));
    values.add(interpolate(
      MariaTypes.point.encode(unsaved.location()),
      typo.runtime.Fragment.lit("""
      """)
    ));
    unsaved.serviceArea().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`service_area`"));
        values.add(interpolate(
        MariaTypes.polygon.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.timezone().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`timezone`"));
        values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.isActive().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`is_active`"));
        values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.contactEmail().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`contact_email`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    unsaved.contactPhone().visit(
      () -> {
  
      },
      value -> {
        columns.add(Fragment.lit("`contact_phone`"));
        values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """)
      ));
      }
    );;
    Fragment q = interpolate(
      typo.runtime.Fragment.lit("insert into `warehouses`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
         )
         values ("""),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
         )
         returning `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      """)
    );;
    return q.updateReturning(WarehousesRow._rowParser.exactlyOne()).runUnchecked(c);
  };

  @Override
  public SelectBuilder<WarehousesFields, WarehousesRow> select() {
    return SelectBuilder.of("`warehouses`", WarehousesFields.structure(), WarehousesRow._rowParser, Dialect.MARIADB);
  };

  @Override
  public List<WarehousesRow> selectAll(Connection c) {
    return interpolate(typo.runtime.Fragment.lit("""
       select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
       from `warehouses`
    """)).query(WarehousesRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Optional<WarehousesRow> selectById(
    WarehousesId warehouseId,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
         from `warehouses`
         where `warehouse_id` = """),
      WarehousesId.pgType.encode(warehouseId),
      typo.runtime.Fragment.lit("")
    ).query(WarehousesRow._rowParser.first()).runUnchecked(c);
  };

  @Override
  public List<WarehousesRow> selectByIds(
    WarehousesId[] warehouseIds,
    Connection c
  ) {
    ArrayList<Fragment> fragments = new ArrayList<Fragment>();
    for (var id : warehouseIds) { fragments.add(WarehousesId.pgType.encode(id)); };
    return Fragment.interpolate(Fragment.lit("select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone` from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(WarehousesRow._rowParser.all()).runUnchecked(c);
  };

  @Override
  public Map<WarehousesId, WarehousesRow> selectByIdsTracked(
    WarehousesId[] warehouseIds,
    Connection c
  ) {
    HashMap<WarehousesId, WarehousesRow> ret = new HashMap<WarehousesId, WarehousesRow>();
    selectByIds(warehouseIds, c).forEach(row -> ret.put(row.warehouseId(), row));
    return ret;
  };

  @Override
  public Optional<WarehousesRow> selectByUniqueCode(
    String code,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
         from `warehouses`
         where `code` = """),
      MariaTypes.text.encode(code),
      typo.runtime.Fragment.lit("""


      """)
    ).query(WarehousesRow._rowParser.first()).runUnchecked(c);
  };

  @Override
  public UpdateBuilder<WarehousesFields, WarehousesRow> update() {
    return UpdateBuilder.of("`warehouses`", WarehousesFields.structure(), WarehousesRow._rowParser.all(), Dialect.MARIADB);
  };

  @Override
  public Boolean update(
    WarehousesRow row,
    Connection c
  ) {
    WarehousesId warehouseId = row.warehouseId();;
    return interpolate(
      typo.runtime.Fragment.lit("""
         update `warehouses`
         set `code` = """),
      MariaTypes.text.encode(row.code()),
      typo.runtime.Fragment.lit("""
         ,
         `name` = """),
      MariaTypes.text.encode(row.name()),
      typo.runtime.Fragment.lit("""
         ,
         `address` = """),
      MariaTypes.text.encode(row.address()),
      typo.runtime.Fragment.lit("""
         ,
         `location` = """),
      MariaTypes.point.encode(row.location()),
      typo.runtime.Fragment.lit("""
         ,
         `service_area` = """),
      MariaTypes.polygon.opt().encode(row.serviceArea()),
      typo.runtime.Fragment.lit("""
         ,
         `timezone` = """),
      MariaTypes.text.encode(row.timezone()),
      typo.runtime.Fragment.lit("""
         ,
         `is_active` = """),
      MariaTypes.bool.encode(row.isActive()),
      typo.runtime.Fragment.lit("""
         ,
         `contact_email` = """),
      MariaTypes.text.opt().encode(row.contactEmail()),
      typo.runtime.Fragment.lit("""
         ,
         `contact_phone` = """),
      MariaTypes.text.opt().encode(row.contactPhone()),
      typo.runtime.Fragment.lit("""
   
         where `warehouse_id` = """),
      WarehousesId.pgType.encode(warehouseId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0;
  };

  @Override
  public WarehousesRow upsert(
    WarehousesRow unsaved,
    Connection c
  ) {
    return interpolate(
      typo.runtime.Fragment.lit("""
         INSERT INTO `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
         VALUES ("""),
      MariaTypes.text.encode(unsaved.code()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.name()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.address()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.point.encode(unsaved.location()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.polygon.opt().encode(unsaved.serviceArea()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.encode(unsaved.timezone()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.bool.encode(unsaved.isActive()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.contactEmail()),
      typo.runtime.Fragment.lit(", "),
      MariaTypes.text.opt().encode(unsaved.contactPhone()),
      typo.runtime.Fragment.lit("""
         )
         ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
         `name` = VALUES(`name`),
         `address` = VALUES(`address`),
         `location` = VALUES(`location`),
         `service_area` = VALUES(`service_area`),
         `timezone` = VALUES(`timezone`),
         `is_active` = VALUES(`is_active`),
         `contact_email` = VALUES(`contact_email`),
         `contact_phone` = VALUES(`contact_phone`)
         RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`""")
    )
      .updateReturning(WarehousesRow._rowParser.exactlyOne())
      .runUnchecked(c);
  };

  @Override
  public List<WarehousesRow> upsertBatch(
    Iterator<WarehousesRow> unsaved,
    Connection c
  ) {
    return interpolate(typo.runtime.Fragment.lit("""
                INSERT INTO `warehouses`(`warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
                `name` = VALUES(`name`),
                `address` = VALUES(`address`),
                `location` = VALUES(`location`),
                `service_area` = VALUES(`service_area`),
                `timezone` = VALUES(`timezone`),
                `is_active` = VALUES(`is_active`),
                `contact_email` = VALUES(`contact_email`),
                `contact_phone` = VALUES(`contact_phone`)
                RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`"""))
      .updateReturningEach(WarehousesRow._rowParser, unsaved)
      .runUnchecked(c);
  };
}