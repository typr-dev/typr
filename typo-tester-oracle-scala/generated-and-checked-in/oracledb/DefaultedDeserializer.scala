/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb

import com.fasterxml.jackson.core.JsonParser
import com.fasterxml.jackson.core.JsonToken
import com.fasterxml.jackson.databind.BeanProperty
import com.fasterxml.jackson.databind.DeserializationContext
import com.fasterxml.jackson.databind.JavaType
import com.fasterxml.jackson.databind.JsonDeserializer
import com.fasterxml.jackson.databind.deser.ContextualDeserializer
import java.io.IOException
import java.lang.Class
import java.lang.RuntimeException
import oracledb.customtypes.Defaulted
import oracledb.customtypes.Defaulted.Provided
import oracledb.customtypes.Defaulted.UseDefault

/** Jackson deserializer for Defaulted types */
class DefaultedDeserializer(
  val valueType: JavaType,
  val defaultedClass: Class[?]
) extends JsonDeserializer[Defaulted[?]] with ContextualDeserializer {
  override def createContextual(
    ctxt: DeserializationContext,
    property: BeanProperty
  ): JsonDeserializer[?] = {
    val contextType: JavaType = ctxt.getContextualType()
    val `type`: JavaType = (if (contextType == null && property != null) property.getType() else contextType)
    if (`type` != null && `type`.containedTypeCount() > 0) {
      return new DefaultedDeserializer(`type`.containedType(0), `type`.getRawClass());
    }
    throw new RuntimeException("unexpected")
  }

  @throws[IOException]
  override def deserialize(
    p: JsonParser,
    ctxt: DeserializationContext
  ): Defaulted[?] = {
    if (p.currentToken() == JsonToken.VALUE_STRING) {
      val text: String = p.getText();
      if ("defaulted".equals(text)) {
        return new UseDefault[Any]();
      }
      throw new IOException("Expected 'defaulted' but got: " + text);
    }
    if (p.currentToken() == JsonToken.START_OBJECT) {
      p.nextToken();
      if (p.currentToken() == JsonToken.FIELD_NAME && "provided".equals(p.currentName())) {
        p.nextToken();
        val value: Any = ctxt.readValue(p, valueType);
        p.nextToken();
        return new Provided[Any](value);
      }
  
    }
    throw new IOException("Expected 'provided' field but got: " + p.currentName())
  }
}