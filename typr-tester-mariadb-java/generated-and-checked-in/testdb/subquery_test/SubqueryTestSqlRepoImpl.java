/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.subquery_test;

import static typr.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.List;
import typr.runtime.Fragment;

public class SubqueryTestSqlRepoImpl implements SubqueryTestSqlRepo {
  @Override
  public List<SubqueryTestSqlRow> apply(Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Test subquery tracking (no CTE)\n"
                    + "SELECT\n"
                    + "    c.customer_id,\n"
                    + "    c.email,\n"
                    + "    c.first_name,\n"
                    + "    sub.order_count,\n"
                    + "    sub.total_spent,\n"
                    + "    b.name as favorite_brand\n"
                    + "FROM customers c\n"
                    + "INNER JOIN (\n"
                    + "    SELECT\n"
                    + "        o.customer_id,\n"
                    + "        COUNT(*) as order_count,\n"
                    + "        SUM(o.total_amount) as total_spent\n"
                    + "    FROM orders o\n"
                    + "    GROUP BY o.customer_id\n"
                    + ") sub ON c.customer_id = sub.customer_id\n"
                    + "LEFT JOIN orders o2 ON c.customer_id = o2.customer_id\n"
                    + "LEFT JOIN order_items oi ON o2.order_id = oi.order_id\n"
                    + "LEFT JOIN products p ON oi.product_id = p.product_id\n"
                    + "LEFT JOIN brands b ON p.brand_id = b.brand_id\n"
                    + "WHERE sub.total_spent > 100\n"))
        .query(SubqueryTestSqlRow._rowParser.all())
        .runUnchecked(c);
  }
  ;
}
