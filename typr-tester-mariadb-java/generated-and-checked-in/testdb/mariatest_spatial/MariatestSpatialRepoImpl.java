/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.mariatest_spatial;

import static typr.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import typr.dsl.DeleteBuilder;
import typr.dsl.Dialect;
import typr.dsl.SelectBuilder;
import typr.dsl.UpdateBuilder;
import typr.runtime.Fragment;
import typr.runtime.MariaTypes;

public class MariatestSpatialRepoImpl implements MariatestSpatialRepo {
  @Override
  public DeleteBuilder<MariatestSpatialFields, MariatestSpatialRow> delete() {
    return DeleteBuilder.of(
        "`mariatest_spatial`", MariatestSpatialFields.structure(), Dialect.MARIADB);
  }
  ;

  @Override
  public Boolean deleteById(MariatestSpatialId id, Connection c) {
    return interpolate(
                Fragment.lit("delete from `mariatest_spatial` where `id` = "),
                Fragment.encode(MariatestSpatialId.pgType, id),
                Fragment.lit(""))
            .update()
            .runUnchecked(c)
        > 0;
  }
  ;

  @Override
  public Integer deleteByIds(MariatestSpatialId[] ids, Connection c) {
    ArrayList<Fragment> fragments = new ArrayList<>();
    for (var id : ids) {
      fragments.add(Fragment.encode(MariatestSpatialId.pgType, id));
    }
    ;
    return Fragment.interpolate(
            Fragment.lit("delete from `mariatest_spatial` where `id` in ("),
            Fragment.comma(fragments),
            Fragment.lit(")"))
        .update()
        .runUnchecked(c);
  }
  ;

  @Override
  public MariatestSpatialRow insert(MariatestSpatialRow unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "insert into `mariatest_spatial`(`geometry_col`, `point_col`, `linestring_col`,"
                    + " `polygon_col`, `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`)\n"
                    + "values ("),
            Fragment.encode(MariaTypes.geometry, unsaved.geometryCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.point, unsaved.pointCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.linestring, unsaved.linestringCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.polygon, unsaved.polygonCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.multipoint, unsaved.multipointCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.multilinestring, unsaved.multilinestringCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.multipolygon, unsaved.multipolygonCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.geometrycollection, unsaved.geometrycollectionCol()),
            Fragment.lit(
                ")\n"
                    + "RETURNING `id`, `geometry_col`, `point_col`, `linestring_col`,"
                    + " `polygon_col`, `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`\n"))
        .updateReturning(MariatestSpatialRow._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public MariatestSpatialRow insert(MariatestSpatialRowUnsaved unsaved, Connection c) {
    ArrayList<Fragment> columns = new ArrayList<>();
    ;
    ArrayList<Fragment> values = new ArrayList<>();
    ;
    columns.add(Fragment.lit("`geometry_col`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.geometry, unsaved.geometryCol()), Fragment.lit("")));
    columns.add(Fragment.lit("`point_col`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.point, unsaved.pointCol()), Fragment.lit("")));
    columns.add(Fragment.lit("`linestring_col`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.linestring, unsaved.linestringCol()), Fragment.lit("")));
    columns.add(Fragment.lit("`polygon_col`"));
    values.add(
        interpolate(Fragment.encode(MariaTypes.polygon, unsaved.polygonCol()), Fragment.lit("")));
    columns.add(Fragment.lit("`multipoint_col`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.multipoint, unsaved.multipointCol()), Fragment.lit("")));
    columns.add(Fragment.lit("`multilinestring_col`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.multilinestring, unsaved.multilinestringCol()),
            Fragment.lit("")));
    columns.add(Fragment.lit("`multipolygon_col`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.multipolygon, unsaved.multipolygonCol()), Fragment.lit("")));
    columns.add(Fragment.lit("`geometrycollection_col`"));
    values.add(
        interpolate(
            Fragment.encode(MariaTypes.geometrycollection, unsaved.geometrycollectionCol()),
            Fragment.lit("")));
    Fragment q =
        interpolate(
            Fragment.lit("insert into `mariatest_spatial`("),
            Fragment.comma(columns),
            Fragment.lit(")\nvalues ("),
            Fragment.comma(values),
            Fragment.lit(
                ")\n"
                    + "RETURNING `id`, `geometry_col`, `point_col`, `linestring_col`,"
                    + " `polygon_col`, `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`\n"));
    ;
    return q.updateReturning(MariatestSpatialRow._rowParser.exactlyOne()).runUnchecked(c);
  }
  ;

  @Override
  public SelectBuilder<MariatestSpatialFields, MariatestSpatialRow> select() {
    return SelectBuilder.of(
        "`mariatest_spatial`",
        MariatestSpatialFields.structure(),
        MariatestSpatialRow._rowParser,
        Dialect.MARIADB);
  }
  ;

  @Override
  public List<MariatestSpatialRow> selectAll(Connection c) {
    return interpolate(
            Fragment.lit(
                "select `id`, `geometry_col`, `point_col`, `linestring_col`, `polygon_col`,"
                    + " `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`\n"
                    + "from `mariatest_spatial`\n"))
        .query(MariatestSpatialRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Optional<MariatestSpatialRow> selectById(MariatestSpatialId id, Connection c) {
    return interpolate(
            Fragment.lit(
                "select `id`, `geometry_col`, `point_col`, `linestring_col`, `polygon_col`,"
                    + " `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`\n"
                    + "from `mariatest_spatial`\n"
                    + "where `id` = "),
            Fragment.encode(MariatestSpatialId.pgType, id),
            Fragment.lit(""))
        .query(MariatestSpatialRow._rowParser.first())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<MariatestSpatialRow> selectByIds(MariatestSpatialId[] ids, Connection c) {
    ArrayList<Fragment> fragments = new ArrayList<>();
    for (var id : ids) {
      fragments.add(Fragment.encode(MariatestSpatialId.pgType, id));
    }
    ;
    return Fragment.interpolate(
            Fragment.lit(
                "select `id`, `geometry_col`, `point_col`, `linestring_col`, `polygon_col`,"
                    + " `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col` from `mariatest_spatial` where `id` in ("),
            Fragment.comma(fragments),
            Fragment.lit(")"))
        .query(MariatestSpatialRow._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public Map<MariatestSpatialId, MariatestSpatialRow> selectByIdsTracked(
      MariatestSpatialId[] ids, Connection c) {
    HashMap<MariatestSpatialId, MariatestSpatialRow> ret =
        new HashMap<MariatestSpatialId, MariatestSpatialRow>();
    selectByIds(ids, c).forEach(row -> ret.put(row.id(), row));
    return ret;
  }
  ;

  @Override
  public UpdateBuilder<MariatestSpatialFields, MariatestSpatialRow> update() {
    return UpdateBuilder.of(
        "`mariatest_spatial`",
        MariatestSpatialFields.structure(),
        MariatestSpatialRow._rowParser,
        Dialect.MARIADB);
  }
  ;

  @Override
  public Boolean update(MariatestSpatialRow row, Connection c) {
    MariatestSpatialId id = row.id();
    ;
    return interpolate(
                Fragment.lit("update `mariatest_spatial`\nset `geometry_col` = "),
                Fragment.encode(MariaTypes.geometry, row.geometryCol()),
                Fragment.lit(",\n`point_col` = "),
                Fragment.encode(MariaTypes.point, row.pointCol()),
                Fragment.lit(",\n`linestring_col` = "),
                Fragment.encode(MariaTypes.linestring, row.linestringCol()),
                Fragment.lit(",\n`polygon_col` = "),
                Fragment.encode(MariaTypes.polygon, row.polygonCol()),
                Fragment.lit(",\n`multipoint_col` = "),
                Fragment.encode(MariaTypes.multipoint, row.multipointCol()),
                Fragment.lit(",\n`multilinestring_col` = "),
                Fragment.encode(MariaTypes.multilinestring, row.multilinestringCol()),
                Fragment.lit(",\n`multipolygon_col` = "),
                Fragment.encode(MariaTypes.multipolygon, row.multipolygonCol()),
                Fragment.lit(",\n`geometrycollection_col` = "),
                Fragment.encode(MariaTypes.geometrycollection, row.geometrycollectionCol()),
                Fragment.lit("\nwhere `id` = "),
                Fragment.encode(MariatestSpatialId.pgType, id),
                Fragment.lit(""))
            .update()
            .runUnchecked(c)
        > 0;
  }
  ;

  @Override
  public MariatestSpatialRow upsert(MariatestSpatialRow unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "INSERT INTO `mariatest_spatial`(`geometry_col`, `point_col`, `linestring_col`,"
                    + " `polygon_col`, `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`)\n"
                    + "VALUES ("),
            Fragment.encode(MariaTypes.geometry, unsaved.geometryCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.point, unsaved.pointCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.linestring, unsaved.linestringCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.polygon, unsaved.polygonCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.multipoint, unsaved.multipointCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.multilinestring, unsaved.multilinestringCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.multipolygon, unsaved.multipolygonCol()),
            Fragment.lit(", "),
            Fragment.encode(MariaTypes.geometrycollection, unsaved.geometrycollectionCol()),
            Fragment.lit(
                ")\n"
                    + "ON DUPLICATE KEY UPDATE `geometry_col` = VALUES(`geometry_col`),\n"
                    + "`point_col` = VALUES(`point_col`),\n"
                    + "`linestring_col` = VALUES(`linestring_col`),\n"
                    + "`polygon_col` = VALUES(`polygon_col`),\n"
                    + "`multipoint_col` = VALUES(`multipoint_col`),\n"
                    + "`multilinestring_col` = VALUES(`multilinestring_col`),\n"
                    + "`multipolygon_col` = VALUES(`multipolygon_col`),\n"
                    + "`geometrycollection_col` = VALUES(`geometrycollection_col`)\n"
                    + "RETURNING `id`, `geometry_col`, `point_col`, `linestring_col`,"
                    + " `polygon_col`, `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`"))
        .updateReturning(MariatestSpatialRow._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public List<MariatestSpatialRow> upsertBatch(
      Iterator<MariatestSpatialRow> unsaved, Connection c) {
    return interpolate(
            Fragment.lit(
                "INSERT INTO `mariatest_spatial`(`id`, `geometry_col`, `point_col`,"
                    + " `linestring_col`, `polygon_col`, `multipoint_col`, `multilinestring_col`,"
                    + " `multipolygon_col`, `geometrycollection_col`)\n"
                    + "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n"
                    + "ON DUPLICATE KEY UPDATE `geometry_col` = VALUES(`geometry_col`),\n"
                    + "`point_col` = VALUES(`point_col`),\n"
                    + "`linestring_col` = VALUES(`linestring_col`),\n"
                    + "`polygon_col` = VALUES(`polygon_col`),\n"
                    + "`multipoint_col` = VALUES(`multipoint_col`),\n"
                    + "`multilinestring_col` = VALUES(`multilinestring_col`),\n"
                    + "`multipolygon_col` = VALUES(`multipolygon_col`),\n"
                    + "`geometrycollection_col` = VALUES(`geometrycollection_col`)\n"
                    + "RETURNING `id`, `geometry_col`, `point_col`, `linestring_col`,"
                    + " `polygon_col`, `multipoint_col`, `multilinestring_col`, `multipolygon_col`,"
                    + " `geometrycollection_col`"))
        .updateReturningEach(MariatestSpatialRow._rowParser, unsaved)
        .runUnchecked(c);
  }
  ;
}
