/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.customer_orders;

import static typr.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.List;
import java.util.Optional;
import testdb.customers.CustomersId;
import typr.runtime.Fragment;
import typr.runtime.MariaTypes;

public class CustomerOrdersSqlRepoImpl implements CustomerOrdersSqlRepo {
  @Override
  public List<CustomerOrdersSqlRow> apply(
      /* user-picked */ CustomersId customerId, Optional<String> orderStatus, Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Query customers with their orders\n"
                    + "SELECT c.customer_id,\n"
                    + "       c.email,\n"
                    + "       c.first_name,\n"
                    + "       c.last_name,\n"
                    + "       c.tier,\n"
                    + "       o.order_id,\n"
                    + "       o.order_number,\n"
                    + "       o.order_status,\n"
                    + "       o.total_amount,\n"
                    + "       o.ordered_at\n"
                    + "FROM customers c\n"
                    + "LEFT JOIN orders o ON c.customer_id = o.customer_id\n"
                    + "WHERE c.customer_id = "),
            Fragment.encode(CustomersId.pgType, customerId),
            Fragment.lit("\n  AND ("),
            Fragment.encode(MariaTypes.text.opt(), orderStatus),
            Fragment.lit(" IS NULL OR o.order_status = "),
            Fragment.encode(MariaTypes.text.opt(), orderStatus),
            Fragment.lit(")\n"))
        .query(CustomerOrdersSqlRow._rowParser.all())
        .runUnchecked(c);
  }
  ;
}
