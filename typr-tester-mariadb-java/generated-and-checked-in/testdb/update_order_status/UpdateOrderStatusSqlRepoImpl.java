/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.update_order_status;

import static typr.runtime.Fragment.interpolate;

import java.sql.Connection;
import testdb.orders.OrdersId;
import typr.runtime.Fragment;
import typr.runtime.MariaTypes;

public class UpdateOrderStatusSqlRepoImpl implements UpdateOrderStatusSqlRepo {
  @Override
  public Integer apply(String newStatus, /* user-picked */ OrdersId orderId, Connection c) {
    return interpolate(
            Fragment.lit("-- Update order status\nUPDATE orders\nSET order_status = "),
            Fragment.encode(MariaTypes.varchar, newStatus),
            Fragment.lit(",\n    confirmed_at = CASE WHEN "),
            Fragment.encode(MariaTypes.varchar, newStatus),
            Fragment.lit(
                " = 'confirmed' THEN NOW(6) ELSE confirmed_at END,\n    shipped_at = CASE WHEN "),
            Fragment.encode(MariaTypes.varchar, newStatus),
            Fragment.lit(
                " = 'shipped' THEN NOW(6) ELSE shipped_at END,\n    delivered_at = CASE WHEN "),
            Fragment.encode(MariaTypes.varchar, newStatus),
            Fragment.lit(" = 'delivered' THEN NOW(6) ELSE delivered_at END\nWHERE order_id = "),
            Fragment.encode(OrdersId.pgType, orderId),
            Fragment.lit("\n"))
        .update()
        .runUnchecked(c);
  }
  ;
}
