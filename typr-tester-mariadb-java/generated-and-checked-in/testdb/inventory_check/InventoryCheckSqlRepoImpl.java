/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.inventory_check;

import static typr.runtime.Fragment.interpolate;

import java.math.BigInteger;
import java.sql.Connection;
import java.util.List;
import java.util.Optional;
import typr.runtime.Fragment;
import typr.runtime.MariaTypes;

public class InventoryCheckSqlRepoImpl implements InventoryCheckSqlRepo {
  @Override
  public List<InventoryCheckSqlRow> apply(
      Optional<Short> warehouseId,
      Optional<BigInteger> productId,
      Optional<Boolean> lowStockOnly,
      Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Check inventory levels across warehouses\n"
                    + "SELECT i.inventory_id,\n"
                    + "       p.product_id,\n"
                    + "       p.sku,\n"
                    + "       p.name AS product_name,\n"
                    + "       w.warehouse_id,\n"
                    + "       w.code AS warehouse_code,\n"
                    + "       w.name AS warehouse_name,\n"
                    + "       i.quantity_on_hand,\n"
                    + "       i.quantity_reserved,\n"
                    + "       (i.quantity_on_hand - i.quantity_reserved) AS available,\n"
                    + "       i.reorder_point,\n"
                    + "       i.bin_location\n"
                    + "FROM inventory i\n"
                    + "JOIN products p ON i.product_id = p.product_id\n"
                    + "JOIN warehouses w ON i.warehouse_id = w.warehouse_id\n"
                    + "WHERE ("),
            Fragment.encode(MariaTypes.tinyintUnsigned.opt(), warehouseId),
            Fragment.lit(" IS NULL OR i.warehouse_id = "),
            Fragment.encode(MariaTypes.tinyintUnsigned.opt(), warehouseId),
            Fragment.lit(")\n  AND ("),
            Fragment.encode(MariaTypes.bigintUnsigned.opt(), productId),
            Fragment.lit(" IS NULL OR i.product_id = "),
            Fragment.encode(MariaTypes.bigintUnsigned.opt(), productId),
            Fragment.lit(")\n  AND ("),
            Fragment.encode(MariaTypes.bool.opt(), lowStockOnly),
            Fragment.lit(
                " IS NULL OR (i.quantity_on_hand - i.quantity_reserved) <= i.reorder_point)\n"))
        .query(InventoryCheckSqlRow._rowParser.all())
        .runUnchecked(c);
  }
  ;
}
