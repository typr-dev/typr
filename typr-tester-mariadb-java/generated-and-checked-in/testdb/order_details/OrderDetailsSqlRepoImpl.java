/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.order_details;

import static typr.runtime.Fragment.interpolate;

import java.sql.Connection;
import java.util.List;
import testdb.orders.OrdersId;
import typr.runtime.Fragment;

public class OrderDetailsSqlRepoImpl implements OrderDetailsSqlRepo {
  @Override
  public List<OrderDetailsSqlRow> apply(/* user-picked */ OrdersId orderId, Connection c) {
    return interpolate(
            Fragment.lit(
                "-- Get order with all items\n"
                    + "SELECT o.order_id,\n"
                    + "       o.order_number,\n"
                    + "       o.order_status,\n"
                    + "       o.payment_status,\n"
                    + "       o.subtotal,\n"
                    + "       o.shipping_cost,\n"
                    + "       o.tax_amount,\n"
                    + "       o.discount_amount,\n"
                    + "       o.total_amount,\n"
                    + "       o.ordered_at,\n"
                    + "       oi.item_id,\n"
                    + "       oi.product_id,\n"
                    + "       oi.sku,\n"
                    + "       oi.product_name,\n"
                    + "       oi.quantity,\n"
                    + "       oi.unit_price,\n"
                    + "       oi.line_total\n"
                    + "FROM orders o\n"
                    + "JOIN order_items oi ON o.order_id = oi.order_id\n"
                    + "WHERE o.order_id = "),
            Fragment.encode(OrdersId.pgType, orderId),
            Fragment.lit("\n"))
        .query(OrderDetailsSqlRow._rowParser.all())
        .runUnchecked(c);
  }
  ;
}
