/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.titledperson

import adventureworks.public.title.TitleId
import adventureworks.public.title_domain.TitleDomainId
import dev.typr.foundations.PgTypes
import dev.typr.foundations.scala.DeleteBuilder
import dev.typr.foundations.scala.Dialect
import dev.typr.foundations.scala.Fragment
import dev.typr.foundations.scala.ScalaIteratorOps
import dev.typr.foundations.scala.SelectBuilder
import dev.typr.foundations.scala.UpdateBuilder
import dev.typr.foundations.streamingInsert
import java.sql.Connection
import dev.typr.foundations.scala.Fragment.sql

class TitledpersonRepoImpl extends TitledpersonRepo {
  override def delete: DeleteBuilder[TitledpersonFields, TitledpersonRow] = DeleteBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, Dialect.POSTGRESQL)

  override def insert(unsaved: TitledpersonRow)(using c: Connection): TitledpersonRow = {
  sql"""insert into "public"."titledperson"("title_short", "title", "name")
    values (${Fragment.encode(TitleDomainId.pgType, unsaved.titleShort)}::text, ${Fragment.encode(TitleId.pgType, unsaved.title)}, ${Fragment.encode(PgTypes.text, unsaved.name)})
    RETURNING "title_short", "title", "name"
    """
    .updateReturning(TitledpersonRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insertStreaming(
    unsaved: Iterator[TitledpersonRow],
    batchSize: Int = 10000
  )(using c: Connection): Long = streamingInsert.insertUnchecked(s"""COPY "public"."titledperson"("title_short", "title", "name") FROM STDIN""", batchSize, unsaved.toJavaIterator, c, TitledpersonRow.pgText)

  override def select: SelectBuilder[TitledpersonFields, TitledpersonRow] = SelectBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.`_rowParser`, Dialect.POSTGRESQL)

  override def selectAll(using c: Connection): List[TitledpersonRow] = {
    sql"""select "title_short", "title", "name"
    from "public"."titledperson"
    """.query(TitledpersonRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def update: UpdateBuilder[TitledpersonFields, TitledpersonRow] = UpdateBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.`_rowParser`, Dialect.POSTGRESQL)
}