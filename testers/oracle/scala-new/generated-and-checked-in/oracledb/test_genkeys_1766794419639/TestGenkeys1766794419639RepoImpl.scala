/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.test_genkeys_1766794419639

import dev.typr.foundations.OracleTypes
import dev.typr.foundations.scala.DbTypeOps
import dev.typr.foundations.scala.DeleteBuilder
import dev.typr.foundations.scala.Dialect
import dev.typr.foundations.scala.Fragment
import dev.typr.foundations.scala.ScalaDbTypes
import dev.typr.foundations.scala.SelectBuilder
import dev.typr.foundations.scala.UpdateBuilder
import java.sql.Connection
import scala.collection.mutable.ListBuffer
import dev.typr.foundations.scala.Fragment.sql

class TestGenkeys1766794419639RepoImpl extends TestGenkeys1766794419639Repo {
  override def delete: DeleteBuilder[TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row] = DeleteBuilder.of(""""TEST_GENKEYS_1766794419639"""", TestGenkeys1766794419639Fields.structure, Dialect.ORACLE)

  override def insert(unsaved: TestGenkeys1766794419639Row)(using c: Connection): TestGenkeys1766794419639Row = {
  sql"""insert into "TEST_GENKEYS_1766794419639"("ID", "V")
    values (${Fragment.encode(ScalaDbTypes.OracleTypes.number, unsaved.id)}, ${Fragment.encode(OracleTypes.json.nullable, unsaved.v)})
    """
    .updateReturningGeneratedKeys(Array[String]("ID", "V"), TestGenkeys1766794419639Row.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: TestGenkeys1766794419639RowUnsaved)(using c: Connection): TestGenkeys1766794419639Row = {
    val columns: ListBuffer[Fragment] = ListBuffer()
    val values: ListBuffer[Fragment] = ListBuffer()
    columns.addOne(Fragment.lit(""""V"""")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(OracleTypes.json.nullable, unsaved.v)}"): @scala.annotation.nowarn
    unsaved.id.visit(
      {  },
      value => { columns.addOne(Fragment.lit(""""ID"""")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.OracleTypes.number, value)}"): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      sql"""insert into "TEST_GENKEYS_1766794419639"(${Fragment.comma(columns)})
      values (${Fragment.comma(values)})
      """
    }
    return q.updateReturningGeneratedKeys(Array[String]("ID", "V"), TestGenkeys1766794419639Row.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row] = SelectBuilder.of(""""TEST_GENKEYS_1766794419639"""", TestGenkeys1766794419639Fields.structure, TestGenkeys1766794419639Row.`_rowParser`, Dialect.ORACLE)

  override def selectAll(using c: Connection): List[TestGenkeys1766794419639Row] = {
    sql"""select "ID", "V"
    from "TEST_GENKEYS_1766794419639"
    """.query(TestGenkeys1766794419639Row.`_rowParser`.all()).runUnchecked(c)
  }

  override def update: UpdateBuilder[TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row] = UpdateBuilder.of(""""TEST_GENKEYS_1766794419639"""", TestGenkeys1766794419639Fields.structure, TestGenkeys1766794419639Row.`_rowParser`, Dialect.ORACLE)
}