/**
 * File has been automatically generated by `typo`.
 *
 * <p>IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.test_genkeys_1766794419639;

import static dev.typr.foundations.Fragment.interpolate;

import dev.typr.foundations.Fragment;
import dev.typr.foundations.OracleTypes;
import dev.typr.foundations.dsl.DeleteBuilder;
import dev.typr.foundations.dsl.Dialect;
import dev.typr.foundations.dsl.SelectBuilder;
import dev.typr.foundations.dsl.UpdateBuilder;
import java.sql.Connection;
import java.util.ArrayList;
import java.util.List;

public class TestGenkeys1766794419639RepoImpl implements TestGenkeys1766794419639Repo {
  @Override
  public DeleteBuilder<TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row> delete() {
    return DeleteBuilder.of(
        "\"TEST_GENKEYS_1766794419639\"",
        TestGenkeys1766794419639Fields.structure(),
        Dialect.ORACLE);
  }
  ;

  @Override
  public TestGenkeys1766794419639Row insert(TestGenkeys1766794419639Row unsaved, Connection c) {
    return interpolate(
            Fragment.lit("insert into \"TEST_GENKEYS_1766794419639\"(\"ID\", \"V\")\nvalues ("),
            Fragment.encode(OracleTypes.number, unsaved.id()),
            Fragment.lit(", "),
            Fragment.encode(OracleTypes.json.opt(), unsaved.v()),
            Fragment.lit(")\n"))
        .updateReturningGeneratedKeys(
            new String[] {"ID", "V"}, TestGenkeys1766794419639Row._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public TestGenkeys1766794419639Row insert(
      TestGenkeys1766794419639RowUnsaved unsaved, Connection c) {
    ArrayList<Fragment> columns = new ArrayList<>();
    ;
    ArrayList<Fragment> values = new ArrayList<>();
    ;
    columns.add(Fragment.lit("\"V\""));
    values.add(interpolate(Fragment.encode(OracleTypes.json.opt(), unsaved.v()), Fragment.lit("")));
    unsaved
        .id()
        .visit(
            () -> {},
            value -> {
              columns.add(Fragment.lit("\"ID\""));
              values.add(interpolate(Fragment.encode(OracleTypes.number, value), Fragment.lit("")));
            });
    ;
    Fragment q =
        interpolate(
            Fragment.lit("insert into \"TEST_GENKEYS_1766794419639\"("),
            Fragment.comma(columns),
            Fragment.lit(")\nvalues ("),
            Fragment.comma(values),
            Fragment.lit(")\n"));
    ;
    return q.updateReturningGeneratedKeys(
            new String[] {"ID", "V"}, TestGenkeys1766794419639Row._rowParser.exactlyOne())
        .runUnchecked(c);
  }
  ;

  @Override
  public SelectBuilder<TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row> select() {
    return SelectBuilder.of(
        "\"TEST_GENKEYS_1766794419639\"",
        TestGenkeys1766794419639Fields.structure(),
        TestGenkeys1766794419639Row._rowParser,
        Dialect.ORACLE);
  }
  ;

  @Override
  public List<TestGenkeys1766794419639Row> selectAll(Connection c) {
    return interpolate(Fragment.lit("select \"ID\", \"V\"\nfrom \"TEST_GENKEYS_1766794419639\"\n"))
        .query(TestGenkeys1766794419639Row._rowParser.all())
        .runUnchecked(c);
  }
  ;

  @Override
  public UpdateBuilder<TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row> update() {
    return UpdateBuilder.of(
        "\"TEST_GENKEYS_1766794419639\"",
        TestGenkeys1766794419639Fields.structure(),
        TestGenkeys1766794419639Row._rowParser,
        Dialect.ORACLE);
  }
  ;
}
