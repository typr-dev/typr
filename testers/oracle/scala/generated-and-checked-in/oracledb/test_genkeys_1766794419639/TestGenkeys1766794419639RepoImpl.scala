/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.test_genkeys_1766794419639

import dev.typr.foundations.Fragment
import dev.typr.foundations.OracleTypes
import dev.typr.foundations.dsl.DeleteBuilder
import dev.typr.foundations.dsl.Dialect
import dev.typr.foundations.dsl.SelectBuilder
import dev.typr.foundations.dsl.UpdateBuilder
import java.sql.Connection
import java.util.ArrayList
import dev.typr.foundations.Fragment.interpolate

class TestGenkeys1766794419639RepoImpl extends TestGenkeys1766794419639Repo {
  override def delete: DeleteBuilder[TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row] = DeleteBuilder.of(""""TEST_GENKEYS_1766794419639"""", TestGenkeys1766794419639Fields.structure, Dialect.ORACLE)

  override def insert(unsaved: TestGenkeys1766794419639Row)(using c: Connection): TestGenkeys1766794419639Row = {
  interpolate(Fragment.lit("""insert into "TEST_GENKEYS_1766794419639"("ID", "V")
    values ("""), Fragment.encode(OracleTypes.number, unsaved.id), Fragment.lit(", "), Fragment.encode(OracleTypes.json.opt(), unsaved.v), Fragment.lit(""")
    """))
    .updateReturningGeneratedKeys(Array[String]("ID", "V"), TestGenkeys1766794419639Row.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: TestGenkeys1766794419639RowUnsaved)(using c: Connection): TestGenkeys1766794419639Row = {
    val columns: ArrayList[Fragment] = new ArrayList()
    val values: ArrayList[Fragment] = new ArrayList()
    columns.add(Fragment.lit(""""V"""")): @scala.annotation.nowarn
    values.add(interpolate(Fragment.encode(OracleTypes.json.opt(), unsaved.v), Fragment.lit(""))): @scala.annotation.nowarn
    unsaved.id.visit(
      {  },
      value => { columns.add(Fragment.lit(""""ID"""")): @scala.annotation.nowarn; values.add(interpolate(Fragment.encode(OracleTypes.number, value), Fragment.lit(""))): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      interpolate(Fragment.lit("""insert into "TEST_GENKEYS_1766794419639"("""), Fragment.comma(columns), Fragment.lit(""")
      values ("""), Fragment.comma(values), Fragment.lit(""")
      """))
    }
    return q.updateReturningGeneratedKeys(Array[String]("ID", "V"), TestGenkeys1766794419639Row.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row] = SelectBuilder.of(""""TEST_GENKEYS_1766794419639"""", TestGenkeys1766794419639Fields.structure, TestGenkeys1766794419639Row.`_rowParser`, Dialect.ORACLE)

  override def selectAll(using c: Connection): java.util.List[TestGenkeys1766794419639Row] = {
    interpolate(Fragment.lit("""select "ID", "V"
    from "TEST_GENKEYS_1766794419639"
    """)).query(TestGenkeys1766794419639Row.`_rowParser`.all()).runUnchecked(c)
  }

  override def update: UpdateBuilder[TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row] = UpdateBuilder.of(""""TEST_GENKEYS_1766794419639"""", TestGenkeys1766794419639Fields.structure, TestGenkeys1766794419639Row.`_rowParser`, Dialect.ORACLE)
}