/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package oracledb.test_genkeys_1766794419639

import dev.typr.foundations.OracleTypes
import dev.typr.foundations.kotlin.DeleteBuilder
import dev.typr.foundations.kotlin.Dialect
import dev.typr.foundations.kotlin.Fragment
import dev.typr.foundations.kotlin.KotlinDbTypes
import dev.typr.foundations.kotlin.SelectBuilder
import dev.typr.foundations.kotlin.UpdateBuilder
import dev.typr.foundations.kotlin.nullable
import java.sql.Connection
import java.util.ArrayList
import kotlin.collections.List

class TestGenkeys1766794419639RepoImpl() : TestGenkeys1766794419639Repo {
  override fun delete(): DeleteBuilder<TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row> = DeleteBuilder.of("\"TEST_GENKEYS_1766794419639\"", TestGenkeys1766794419639Fields.structure, Dialect.ORACLE)

  override fun insert(
    unsaved: TestGenkeys1766794419639Row,
    c: Connection
  ): TestGenkeys1766794419639Row = Fragment.interpolate(Fragment.lit("insert into \"TEST_GENKEYS_1766794419639\"(\"ID\", \"V\")\nvalues ("), Fragment.encode(KotlinDbTypes.OracleTypes.number, unsaved.id), Fragment.lit(", "), Fragment.encode(OracleTypes.json.nullable(), unsaved.v), Fragment.lit(")\n"))
    .updateReturningGeneratedKeys(arrayOf<String>("ID", "V"), TestGenkeys1766794419639Row._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: TestGenkeys1766794419639RowUnsaved,
    c: Connection
  ): TestGenkeys1766794419639Row {
    val columns: ArrayList<Fragment> = ArrayList()
    val values: ArrayList<Fragment> = ArrayList()
    columns.add(Fragment.lit("\"V\""))
    values.add(Fragment.interpolate(Fragment.encode(OracleTypes.json.nullable(), unsaved.v), Fragment.lit("")))
    unsaved.id.visit(
      {  },
      { value -> columns.add(Fragment.lit("\"ID\""))
      values.add(Fragment.interpolate(Fragment.encode(KotlinDbTypes.OracleTypes.number, value), Fragment.lit(""))) }
    );
    val q: Fragment = Fragment.interpolate(Fragment.lit("insert into \"TEST_GENKEYS_1766794419639\"("), Fragment.comma(columns.toMutableList()), Fragment.lit(")\nvalues ("), Fragment.comma(values.toMutableList()), Fragment.lit(")\n"))
    return q.updateReturningGeneratedKeys(arrayOf<String>("ID", "V"), TestGenkeys1766794419639Row._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row> = SelectBuilder.of("\"TEST_GENKEYS_1766794419639\"", TestGenkeys1766794419639Fields.structure, TestGenkeys1766794419639Row._rowParser, Dialect.ORACLE)

  override fun selectAll(c: Connection): List<TestGenkeys1766794419639Row> = Fragment.interpolate(Fragment.lit("select \"ID\", \"V\"\nfrom \"TEST_GENKEYS_1766794419639\"\n")).query(TestGenkeys1766794419639Row._rowParser.all()).runUnchecked(c)

  override fun update(): UpdateBuilder<TestGenkeys1766794419639Fields, TestGenkeys1766794419639Row> = UpdateBuilder.of("\"TEST_GENKEYS_1766794419639\"", TestGenkeys1766794419639Fields.structure, TestGenkeys1766794419639Row._rowParser, Dialect.ORACLE)
}