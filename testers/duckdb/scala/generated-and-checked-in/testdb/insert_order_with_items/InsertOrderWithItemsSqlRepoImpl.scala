/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.insert_order_with_items

import dev.typr.foundations.DuckDbTypes
import dev.typr.foundations.scala.DuckDbTypeOps
import dev.typr.foundations.scala.Fragment
import dev.typr.foundations.scala.ScalaDbTypes
import java.sql.Connection
import java.time.LocalDate
import testdb.customers.CustomersId
import dev.typr.foundations.scala.Fragment.sql

class InsertOrderWithItemsSqlRepoImpl extends InsertOrderWithItemsSqlRepo {
  override def apply(
    orderId: Int,
    customerId: /* user-picked */ CustomersId,
    orderDate: Option[LocalDate],
    totalAmount: Option[BigDecimal],
    status: Option[String]
  )(using c: Connection): Int = {
    sql"""-- Insert a new order and return the generated data
    -- Tests: INSERT with RETURNING, multiple columns, foreign keys, DEFAULT values
  
    INSERT INTO orders (order_id, customer_id, order_date, total_amount, status)
    VALUES (
        CAST(${Fragment.encode(ScalaDbTypes.DuckDbTypes.integer, orderId)} AS INTEGER),
        CAST(${Fragment.encode(CustomersId.duckDbType, customerId)} AS INTEGER),
        CAST(${Fragment.encode(DuckDbTypes.date.nullable, orderDate)} AS DATE),
        CAST(${Fragment.encode(ScalaDbTypes.DuckDbTypes.numeric.nullable, totalAmount)} AS DECIMAL),
        CAST(${Fragment.encode(DuckDbTypes.text.nullable, status)} AS VARCHAR)
    )
    RETURNING
        order_id,
        customer_id,
        order_date,
        total_amount,
        status""".update().runUnchecked(c)
  }
}