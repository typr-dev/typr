/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.precision_types

import dev.typr.foundations.DuckDbTypes
import dev.typr.foundations.scala.DeleteBuilder
import dev.typr.foundations.scala.Dialect
import dev.typr.foundations.scala.Fragment
import dev.typr.foundations.scala.SelectBuilder
import dev.typr.foundations.scala.UpdateBuilder
import java.sql.Connection
import testdb.precisetypes.Decimal10_2
import testdb.precisetypes.Decimal18_4
import testdb.precisetypes.Decimal5_2
import testdb.precisetypes.Int10
import testdb.precisetypes.Int18
import testdb.precisetypes.Int5
import dev.typr.foundations.scala.Fragment.sql

class PrecisionTypesRepoImpl extends PrecisionTypesRepo {
  override def delete: DeleteBuilder[PrecisionTypesFields, PrecisionTypesRow] = DeleteBuilder.of(""""precision_types"""", PrecisionTypesFields.structure, Dialect.DUCKDB)

  override def deleteById(id: PrecisionTypesId)(using c: Connection): Boolean = sql"""delete from "precision_types" where "id" = ${Fragment.encode(PrecisionTypesId.duckDbType, id)}""".update().runUnchecked(c) > 0

  override def deleteByIds(ids: Array[PrecisionTypesId])(using c: Connection): Int = {
    sql"""delete
    from "precision_types"
    where "id" = ANY(${Fragment.encode(PrecisionTypesId.dbTypeArray, ids)})"""
      .update()
      .runUnchecked(c)
  }

  override def insert(unsaved: PrecisionTypesRow)(using c: Connection): PrecisionTypesRow = {
  sql"""insert into "precision_types"("id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0")
    values (${Fragment.encode(PrecisionTypesId.duckDbType, unsaved.id)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string10)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string20)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string50)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string100)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string255)}, ${Fragment.encode(Decimal5_2.duckDbType, unsaved.decimal52)}, ${Fragment.encode(Decimal10_2.duckDbType, unsaved.decimal102)}, ${Fragment.encode(Decimal18_4.duckDbType, unsaved.decimal184)}, ${Fragment.encode(Int5.duckDbType, unsaved.decimal50)}, ${Fragment.encode(Int10.duckDbType, unsaved.decimal100)}, ${Fragment.encode(Int18.duckDbType, unsaved.decimal180)})
    RETURNING "id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0"
    """
    .updateReturning(PrecisionTypesRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[PrecisionTypesFields, PrecisionTypesRow] = SelectBuilder.of(""""precision_types"""", PrecisionTypesFields.structure, PrecisionTypesRow.`_rowParser`, Dialect.DUCKDB)

  override def selectAll(using c: Connection): List[PrecisionTypesRow] = {
    sql"""select "id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0"
    from "precision_types"
    """.query(PrecisionTypesRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(id: PrecisionTypesId)(using c: Connection): Option[PrecisionTypesRow] = {
    sql"""select "id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0"
    from "precision_types"
    where "id" = ${Fragment.encode(PrecisionTypesId.duckDbType, id)}""".query(PrecisionTypesRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(ids: Array[PrecisionTypesId])(using c: Connection): List[PrecisionTypesRow] = {
    sql"""select "id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0"
    from "precision_types"
    where "id" = ANY(${Fragment.encode(PrecisionTypesId.dbTypeArray, ids)})""".query(PrecisionTypesRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(ids: Array[PrecisionTypesId])(using c: Connection): Map[PrecisionTypesId, PrecisionTypesRow] = {
    val ret: scala.collection.mutable.Map[PrecisionTypesId, PrecisionTypesRow] = scala.collection.mutable.Map.empty[PrecisionTypesId, PrecisionTypesRow]
    selectByIds(ids)(using c).foreach(row => ret.put(row.id, row): @scala.annotation.nowarn)
    return ret.toMap
  }

  override def update: UpdateBuilder[PrecisionTypesFields, PrecisionTypesRow] = UpdateBuilder.of(""""precision_types"""", PrecisionTypesFields.structure, PrecisionTypesRow.`_rowParser`, Dialect.DUCKDB)

  override def update(row: PrecisionTypesRow)(using c: Connection): Boolean = {
    val id: PrecisionTypesId = row.id
    return sql"""update "precision_types"
    set "string10" = ${Fragment.encode(DuckDbTypes.varchar, row.string10)},
    "string20" = ${Fragment.encode(DuckDbTypes.varchar, row.string20)},
    "string50" = ${Fragment.encode(DuckDbTypes.varchar, row.string50)},
    "string100" = ${Fragment.encode(DuckDbTypes.varchar, row.string100)},
    "string255" = ${Fragment.encode(DuckDbTypes.varchar, row.string255)},
    "decimal5_2" = ${Fragment.encode(Decimal5_2.duckDbType, row.decimal52)},
    "decimal10_2" = ${Fragment.encode(Decimal10_2.duckDbType, row.decimal102)},
    "decimal18_4" = ${Fragment.encode(Decimal18_4.duckDbType, row.decimal184)},
    "decimal5_0" = ${Fragment.encode(Int5.duckDbType, row.decimal50)},
    "decimal10_0" = ${Fragment.encode(Int10.duckDbType, row.decimal100)},
    "decimal18_0" = ${Fragment.encode(Int18.duckDbType, row.decimal180)}
    where "id" = ${Fragment.encode(PrecisionTypesId.duckDbType, id)}""".update().runUnchecked(c) > 0
  }

  override def upsert(unsaved: PrecisionTypesRow)(using c: Connection): PrecisionTypesRow = {
  sql"""INSERT INTO "precision_types"("id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0")
    VALUES (${Fragment.encode(PrecisionTypesId.duckDbType, unsaved.id)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string10)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string20)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string50)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string100)}, ${Fragment.encode(DuckDbTypes.varchar, unsaved.string255)}, ${Fragment.encode(Decimal5_2.duckDbType, unsaved.decimal52)}, ${Fragment.encode(Decimal10_2.duckDbType, unsaved.decimal102)}, ${Fragment.encode(Decimal18_4.duckDbType, unsaved.decimal184)}, ${Fragment.encode(Int5.duckDbType, unsaved.decimal50)}, ${Fragment.encode(Int10.duckDbType, unsaved.decimal100)}, ${Fragment.encode(Int18.duckDbType, unsaved.decimal180)})
    ON CONFLICT ("id")
    DO UPDATE SET
      "string10" = EXCLUDED."string10",
    "string20" = EXCLUDED."string20",
    "string50" = EXCLUDED."string50",
    "string100" = EXCLUDED."string100",
    "string255" = EXCLUDED."string255",
    "decimal5_2" = EXCLUDED."decimal5_2",
    "decimal10_2" = EXCLUDED."decimal10_2",
    "decimal18_4" = EXCLUDED."decimal18_4",
    "decimal5_0" = EXCLUDED."decimal5_0",
    "decimal10_0" = EXCLUDED."decimal10_0",
    "decimal18_0" = EXCLUDED."decimal18_0"
    RETURNING "id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0""""
    .updateReturning(PrecisionTypesRow.`_rowParser`.exactlyOne())
    .runUnchecked(c)
  }

  override def upsertBatch(unsaved: Iterator[PrecisionTypesRow])(using c: Connection): List[PrecisionTypesRow] = {
    sql"""INSERT INTO "precision_types"("id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0")
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ON CONFLICT ("id")
    DO UPDATE SET
      "string10" = EXCLUDED."string10",
    "string20" = EXCLUDED."string20",
    "string50" = EXCLUDED."string50",
    "string100" = EXCLUDED."string100",
    "string255" = EXCLUDED."string255",
    "decimal5_2" = EXCLUDED."decimal5_2",
    "decimal10_2" = EXCLUDED."decimal10_2",
    "decimal18_4" = EXCLUDED."decimal18_4",
    "decimal5_0" = EXCLUDED."decimal5_0",
    "decimal10_0" = EXCLUDED."decimal10_0",
    "decimal18_0" = EXCLUDED."decimal18_0"
    RETURNING "id", "string10", "string20", "string50", "string100", "string255", "decimal5_2", "decimal10_2", "decimal18_4", "decimal5_0", "decimal10_0", "decimal18_0""""
      .updateReturningEach(PrecisionTypesRow.`_rowParser`, unsaved)
    .runUnchecked(c)
  }
}