/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.update_order_status

import dev.typr.foundations.MariaTypes
import dev.typr.foundations.kotlin.Fragment
import java.sql.Connection
import testdb.orders.OrdersId

class UpdateOrderStatusSqlRepoImpl() : UpdateOrderStatusSqlRepo {
  override fun apply(
    newStatus: String,
    orderId: /* user-picked */ OrdersId,
    c: Connection
  ): Int = Fragment.interpolate(Fragment.lit("-- Update order status\nUPDATE orders\nSET order_status = "), Fragment.encode(MariaTypes.varchar, newStatus), Fragment.lit(",\n    confirmed_at = CASE WHEN "), Fragment.encode(MariaTypes.varchar, newStatus), Fragment.lit(" = 'confirmed' THEN NOW(6) ELSE confirmed_at END,\n    shipped_at = CASE WHEN "), Fragment.encode(MariaTypes.varchar, newStatus), Fragment.lit(" = 'shipped' THEN NOW(6) ELSE shipped_at END,\n    delivered_at = CASE WHEN "), Fragment.encode(MariaTypes.varchar, newStatus), Fragment.lit(" = 'delivered' THEN NOW(6) ELSE delivered_at END\nWHERE order_id = "), Fragment.encode(OrdersId.mariaType, orderId), Fragment.lit("\n")).update().runUnchecked(c)
}