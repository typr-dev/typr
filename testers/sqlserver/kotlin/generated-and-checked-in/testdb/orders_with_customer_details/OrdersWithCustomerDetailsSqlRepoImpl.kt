/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.orders_with_customer_details

import dev.typr.foundations.SqlServerTypes
import dev.typr.foundations.kotlin.Fragment
import dev.typr.foundations.kotlin.KotlinDbTypes
import dev.typr.foundations.kotlin.nullable
import java.math.BigDecimal
import java.sql.Connection
import java.time.LocalDateTime
import kotlin.collections.List

class OrdersWithCustomerDetailsSqlRepoImpl() : OrdersWithCustomerDetailsSqlRepo {
  override fun apply(
    minAmount: BigDecimal?,
    startDate: LocalDateTime?,
    c: Connection
  ): List<OrdersWithCustomerDetailsSqlRow> = Fragment.interpolate(Fragment.lit("-- Get orders with full customer details\nSELECT\n    o.order_id,\n    o.order_date,\n    o.total_amount,\n    c.customer_id,\n    c.name as customer_name,\n    c.email as customer_email\nFROM orders o\nINNER JOIN customers c ON o.customer_id = c.customer_id\nWHERE ("), Fragment.encode(KotlinDbTypes.SqlServerTypes.numeric.nullable(), minAmount), Fragment.lit(" IS NULL OR o.total_amount >= "), Fragment.encode(KotlinDbTypes.SqlServerTypes.numeric.nullable(), minAmount), Fragment.lit(")\n  AND ("), Fragment.encode(SqlServerTypes.datetime2.nullable(), startDate), Fragment.lit(" IS NULL OR o.order_date >= "), Fragment.encode(SqlServerTypes.datetime2.nullable(), startDate), Fragment.lit(")\nORDER BY o.order_date DESC\n")).query(OrdersWithCustomerDetailsSqlRow._rowParser.all()).runUnchecked(c)
}