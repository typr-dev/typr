/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.users

import adventureworks.Text
import adventureworks.customtypes.Defaulted
import adventureworks.customtypes.TypoInstant
import adventureworks.customtypes.TypoUnknownCitext
import anorm.Column
import anorm.RowParser
import anorm.Success
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** Table: public.users
 * Primary key: user_id
 */
case class UsersRow(
  userId: UsersId,
  name: String,
  lastName: Option[String],
  email: TypoUnknownCitext,
  password: String,
  /** Default: now() */
  createdAt: TypoInstant,
  verifiedOn: Option[TypoInstant]
) {
  def id: UsersId = userId

  def toUnsavedRow(createdAt: Defaulted[TypoInstant] = Defaulted.Provided(this.createdAt)): UsersRowUnsaved = {
    new UsersRowUnsaved(
      userId,
      name,
      lastName,
      email,
      password,
      verifiedOn,
      createdAt
    )
  }
}

object UsersRow {
  given pgText: Text[UsersRow] = {
    Text.instance[UsersRow]{ (row, sb) =>
      UsersId.pgText.unsafeEncode(row.userId, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.name, sb)
      sb.append(Text.DELIMETER)
      Text.option(using Text.stringInstance).unsafeEncode(row.lastName, sb)
      sb.append(Text.DELIMETER)
      TypoUnknownCitext.pgText.unsafeEncode(row.email, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.password, sb)
      sb.append(Text.DELIMETER)
      TypoInstant.pgText.unsafeEncode(row.createdAt, sb)
      sb.append(Text.DELIMETER)
      Text.option(using TypoInstant.pgText).unsafeEncode(row.verifiedOn, sb)
    }
  }

  given reads: Reads[UsersRow] = {
    Reads[UsersRow](json => JsResult.fromTry(
        Try(
          UsersRow(
            userId = json.\("user_id").as(using UsersId.reads),
            name = json.\("name").as(using Reads.StringReads),
            lastName = json.\("last_name").toOption.map(_.as(using Reads.StringReads)),
            email = json.\("email").as(using TypoUnknownCitext.reads),
            password = json.\("password").as(using Reads.StringReads),
            createdAt = json.\("created_at").as(using TypoInstant.reads),
            verifiedOn = json.\("verified_on").toOption.map(_.as(using TypoInstant.reads))
          )
        )
      ),
    )
  }

  def rowParser(idx: Int): RowParser[UsersRow] = {
    RowParser[UsersRow] { row =>
      Success(
        UsersRow(
          userId = row(idx + 0)(using UsersId.column),
          name = row(idx + 1)(using Column.columnToString),
          lastName = row(idx + 2)(using Column.columnToOption(using Column.columnToString)),
          email = row(idx + 3)(using TypoUnknownCitext.column),
          password = row(idx + 4)(using Column.columnToString),
          createdAt = row(idx + 5)(using TypoInstant.column),
          verifiedOn = row(idx + 6)(using Column.columnToOption(using TypoInstant.column))
        )
      )
    }
  }

  given writes: OWrites[UsersRow] = {
    OWrites[UsersRow](o =>
      new JsObject(ListMap[String, JsValue](
        "user_id" -> UsersId.writes.writes(o.userId),
        "name" -> Writes.StringWrites.writes(o.name),
        "last_name" -> Writes.OptionWrites(using Writes.StringWrites).writes(o.lastName),
        "email" -> TypoUnknownCitext.writes.writes(o.email),
        "password" -> Writes.StringWrites.writes(o.password),
        "created_at" -> TypoInstant.writes.writes(o.createdAt),
        "verified_on" -> Writes.OptionWrites(using TypoInstant.writes).writes(o.verifiedOn)
      ))
    )
  }
}