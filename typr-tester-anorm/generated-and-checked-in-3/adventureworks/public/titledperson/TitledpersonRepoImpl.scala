/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.titledperson

import adventureworks.public.title.TitleId
import adventureworks.public.title_domain.TitleDomainId
import adventureworks.streamingInsert
import anorm.ParameterValue
import anorm.ToStatement
import java.sql.Connection
import typr.dsl.DeleteBuilder
import typr.dsl.SelectBuilder
import typr.dsl.UpdateBuilder
import anorm.SqlStringInterpolation

class TitledpersonRepoImpl extends TitledpersonRepo {
  override def delete: DeleteBuilder[TitledpersonFields, TitledpersonRow] = DeleteBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.rowParser(1).*)

  override def insert(unsaved: TitledpersonRow)(using c: Connection): TitledpersonRow = {
  SQL"""insert into "public"."titledperson"("title_short", "title", "name")
    values (${ParameterValue(unsaved.titleShort, null, TitleDomainId.toStatement)}::text, ${ParameterValue(unsaved.title, null, TitleId.toStatement)}, ${ParameterValue(unsaved.name, null, ToStatement.stringToStatement)})
    returning "title_short", "title", "name"
    """
    .executeInsert(TitledpersonRow.rowParser(1).single)
  }

  override def insertStreaming(
    unsaved: Iterator[TitledpersonRow],
    batchSize: Int = 10000
  )(using c: Connection): Long = streamingInsert(s"""COPY "public"."titledperson"("title_short", "title", "name") FROM STDIN""", batchSize, unsaved)(using TitledpersonRow.pgText, c)

  override def select: SelectBuilder[TitledpersonFields, TitledpersonRow] = SelectBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.rowParser)

  override def selectAll(using c: Connection): List[TitledpersonRow] = {
    SQL"""select "title_short", "title", "name"
    from "public"."titledperson"
    """.as(TitledpersonRow.rowParser(1).*)
  }

  override def update: UpdateBuilder[TitledpersonFields, TitledpersonRow] = UpdateBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.rowParser(1).*)
}