/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.customtypes

import adventureworks.Text
import anorm.Column
import anorm.ParameterMetaData
import anorm.ToStatement
import anorm.TypeDoesNotMatch
import java.sql.Types
import org.postgresql.jdbc.PgArray
import org.postgresql.util.PGInterval
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** Interval type in PostgreSQL */
case class TypoInterval(
  years: Int,
  months: Int,
  days: Int,
  hours: Int,
  minutes: Int,
  seconds: Double
)

object TypoInterval {
  given arrayColumn: Column[Array[TypoInterval]] = {
    Column.nonNull[Array[TypoInterval]]((v1: Any, _) =>
      v1 match {
          case v: PgArray =>
           v.getArray match {
             case v: Array[?] =>
               Right(v.map(v => new TypoInterval(
                                  v.asInstanceOf[PGInterval].getYears,
                                  v.asInstanceOf[PGInterval].getMonths,
                                  v.asInstanceOf[PGInterval].getDays,
                                  v.asInstanceOf[PGInterval].getHours,
                                  v.asInstanceOf[PGInterval].getMinutes,
                                  v.asInstanceOf[PGInterval].getSeconds
                                )))
             case other => Left(TypeDoesNotMatch(s"Expected one-dimensional array from JDBC to produce an array of TypoInterval, got ${other.getClass.getName}"))
           }
        case other => Left(TypeDoesNotMatch(s"Expected instance of org.postgresql.jdbc.PgArray, got ${other.getClass.getName}"))
      }
    )
  }

  given arrayToStatement: ToStatement[Array[TypoInterval]] = {
    ToStatement[Array[TypoInterval]]((s, index, v) => s.setArray(index, s.getConnection.createArrayOf("interval", v.map(v => new PGInterval(
      v.years,
      v.months,
      v.days,
      v.hours,
      v.minutes,
      v.seconds
    )))))
  }

  given column: Column[TypoInterval] = {
    Column.nonNull[TypoInterval]((v1: Any, _) =>
      v1 match {
        case v: PGInterval => Right(new TypoInterval(
                                      v.getYears,
                                      v.getMonths,
                                      v.getDays,
                                      v.getHours,
                                      v.getMinutes,
                                      v.getSeconds
                                    ))
        case other => Left(TypeDoesNotMatch(s"Expected instance of org.postgresql.util.PGInterval, got ${other.getClass.getName}"))
      }
    )
  }

  given parameterMetadata: ParameterMetaData[TypoInterval] = {
    new ParameterMetaData[TypoInterval] {
      override def sqlType: String = "interval"
      override def jdbcType: Int = Types.OTHER
    }
  }

  given pgText: Text[TypoInterval] = {
    new Text[TypoInterval] {
      override def unsafeEncode(v: TypoInterval, sb: StringBuilder): Unit = Text.stringInstance.unsafeEncode(s"P${v.years}Y${v.months}M${v.days}DT${v.hours}H${v.minutes}M${v.seconds}S", sb)
      override def unsafeArrayEncode(v: TypoInterval, sb: StringBuilder): Unit = Text.stringInstance.unsafeArrayEncode(s"P${v.years}Y${v.months}M${v.days}DT${v.hours}H${v.minutes}M${v.seconds}S", sb)
    }
  }

  given reads: Reads[TypoInterval] = {
    Reads[TypoInterval](json => JsResult.fromTry(
        Try(
          TypoInterval(
            years = json.\("years").as(using Reads.IntReads),
            months = json.\("months").as(using Reads.IntReads),
            days = json.\("days").as(using Reads.IntReads),
            hours = json.\("hours").as(using Reads.IntReads),
            minutes = json.\("minutes").as(using Reads.IntReads),
            seconds = json.\("seconds").as(using Reads.DoubleReads)
          )
        )
      ),
    )
  }

  given toStatement: ToStatement[TypoInterval] = {
    ToStatement[TypoInterval]((s, index, v) => s.setObject(index, new PGInterval(
      v.years,
      v.months,
      v.days,
      v.hours,
      v.minutes,
      v.seconds
    )))
  }

  given writes: OWrites[TypoInterval] = {
    OWrites[TypoInterval](o =>
      new JsObject(ListMap[String, JsValue](
        "years" -> Writes.IntWrites.writes(o.years),
        "months" -> Writes.IntWrites.writes(o.months),
        "days" -> Writes.IntWrites.writes(o.days),
        "hours" -> Writes.IntWrites.writes(o.hours),
        "minutes" -> Writes.IntWrites.writes(o.minutes),
        "seconds" -> Writes.DoubleWrites.writes(o.seconds)
      ))
    )
  }
}