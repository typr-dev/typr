/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.production.productreview

import adventureworks.Text
import adventureworks.customtypes.Defaulted
import adventureworks.customtypes.TypoLocalDateTime
import adventureworks.production.product.ProductId
import adventureworks.public.Name
import anorm.Column
import anorm.RowParser
import anorm.Success
import play.api.libs.json.JsObject
import play.api.libs.json.JsResult
import play.api.libs.json.JsValue
import play.api.libs.json.OWrites
import play.api.libs.json.Reads
import play.api.libs.json.Writes
import scala.collection.immutable.ListMap
import scala.util.Try

/** Table: production.productreview
 * Customer reviews of products they have purchased.
 * Primary key: productreviewid
 */
case class ProductreviewRow(
  /** Primary key for ProductReview records.
   * Default: nextval('production.productreview_productreviewid_seq'::regclass)
   */
  productreviewid: ProductreviewId,
  /** Product identification number. Foreign key to Product.ProductID.
   * Points to [[adventureworks.production.product.ProductRow.productid]]
   */
  productid: ProductId,
  /** Name of the reviewer. */
  reviewername: Name,
  /** Date review was submitted.
   * Default: now()
   */
  reviewdate: TypoLocalDateTime,
  /** Reviewer's e-mail address. */
  emailaddress: String,
  /** Product rating given by the reviewer. Scale is 1 to 5 with 5 as the highest rating.
   * Constraint CK_ProductReview_Rating affecting columns rating: (((rating >= 1) AND (rating <= 5)))
   */
  rating: Int,
  /** Reviewer's comments */
  comments: Option[/* max 3850 chars */ String],
  /** Default: now() */
  modifieddate: TypoLocalDateTime
) {
  def id: ProductreviewId = productreviewid

  def toUnsavedRow(
    productreviewid: Defaulted[ProductreviewId],
    reviewdate: Defaulted[TypoLocalDateTime] = Defaulted.Provided(this.reviewdate),
    modifieddate: Defaulted[TypoLocalDateTime] = Defaulted.Provided(this.modifieddate)
  ): ProductreviewRowUnsaved = {
    new ProductreviewRowUnsaved(
      productid,
      reviewername,
      emailaddress,
      rating,
      comments,
      productreviewid,
      reviewdate,
      modifieddate
    )
  }
}

object ProductreviewRow {
  given pgText: Text[ProductreviewRow] = {
    Text.instance[ProductreviewRow]{ (row, sb) =>
      ProductreviewId.pgText.unsafeEncode(row.productreviewid, sb)
      sb.append(Text.DELIMETER)
      ProductId.pgText.unsafeEncode(row.productid, sb)
      sb.append(Text.DELIMETER)
      Name.pgText.unsafeEncode(row.reviewername, sb)
      sb.append(Text.DELIMETER)
      TypoLocalDateTime.pgText.unsafeEncode(row.reviewdate, sb)
      sb.append(Text.DELIMETER)
      Text.stringInstance.unsafeEncode(row.emailaddress, sb)
      sb.append(Text.DELIMETER)
      Text.intInstance.unsafeEncode(row.rating, sb)
      sb.append(Text.DELIMETER)
      Text.option(using Text.stringInstance).unsafeEncode(row.comments, sb)
      sb.append(Text.DELIMETER)
      TypoLocalDateTime.pgText.unsafeEncode(row.modifieddate, sb)
    }
  }

  given reads: Reads[ProductreviewRow] = {
    Reads[ProductreviewRow](json => JsResult.fromTry(
        Try(
          ProductreviewRow(
            productreviewid = json.\("productreviewid").as(using ProductreviewId.reads),
            productid = json.\("productid").as(using ProductId.reads),
            reviewername = json.\("reviewername").as(using Name.reads),
            reviewdate = json.\("reviewdate").as(using TypoLocalDateTime.reads),
            emailaddress = json.\("emailaddress").as(using Reads.StringReads),
            rating = json.\("rating").as(using Reads.IntReads),
            comments = json.\("comments").toOption.map(_.as(using Reads.StringReads)),
            modifieddate = json.\("modifieddate").as(using TypoLocalDateTime.reads)
          )
        )
      ),
    )
  }

  def rowParser(idx: Int): RowParser[ProductreviewRow] = {
    RowParser[ProductreviewRow] { row =>
      Success(
        ProductreviewRow(
          productreviewid = row(idx + 0)(using ProductreviewId.column),
          productid = row(idx + 1)(using ProductId.column),
          reviewername = row(idx + 2)(using Name.column),
          reviewdate = row(idx + 3)(using TypoLocalDateTime.column),
          emailaddress = row(idx + 4)(using Column.columnToString),
          rating = row(idx + 5)(using Column.columnToInt),
          comments = row(idx + 6)(using Column.columnToOption(using Column.columnToString)),
          modifieddate = row(idx + 7)(using TypoLocalDateTime.column)
        )
      )
    }
  }

  given writes: OWrites[ProductreviewRow] = {
    OWrites[ProductreviewRow](o =>
      new JsObject(ListMap[String, JsValue](
        "productreviewid" -> ProductreviewId.writes.writes(o.productreviewid),
        "productid" -> ProductId.writes.writes(o.productid),
        "reviewername" -> Name.writes.writes(o.reviewername),
        "reviewdate" -> TypoLocalDateTime.writes.writes(o.reviewdate),
        "emailaddress" -> Writes.StringWrites.writes(o.emailaddress),
        "rating" -> Writes.IntWrites.writes(o.rating),
        "comments" -> Writes.OptionWrites(using Writes.StringWrites).writes(o.comments),
        "modifieddate" -> TypoLocalDateTime.writes.writes(o.modifieddate)
      ))
    )
  }
}