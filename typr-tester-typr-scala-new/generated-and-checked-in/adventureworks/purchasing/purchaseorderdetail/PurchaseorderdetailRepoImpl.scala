/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId
import java.sql.Connection
import typr.runtime.PgTypes
import typr.scaladsl.Dialect
import typr.scaladsl.Fragment
import typr.scaladsl.ScalaDbTypes
import typr.scaladsl.SelectBuilder
import typr.scaladsl.Fragment.sql

class PurchaseorderdetailRepoImpl extends PurchaseorderdetailRepo {
  override def select: SelectBuilder[PurchaseorderdetailFields, PurchaseorderdetailRow] = SelectBuilder.of(""""purchasing"."purchaseorderdetail"""", PurchaseorderdetailFields.structure, PurchaseorderdetailRow.`_rowParser`, Dialect.POSTGRESQL)

  override def selectAll(using c: Connection): List[PurchaseorderdetailRow] = {
    sql"""select "purchaseorderid", "purchaseorderdetailid", "duedate", "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"
    from "purchasing"."purchaseorderdetail"
    """.query(PurchaseorderdetailRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(compositeId: PurchaseorderdetailId)(using c: Connection): Option[PurchaseorderdetailRow] = {
    sql"""select "purchaseorderid", "purchaseorderdetailid", "duedate", "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"
    from "purchasing"."purchaseorderdetail"
    where "purchaseorderid" = ${Fragment.encode(PurchaseorderheaderId.pgType, compositeId.purchaseorderid)} AND "purchaseorderdetailid" = ${Fragment.encode(ScalaDbTypes.PgTypes.int4, compositeId.purchaseorderdetailid)}""".query(PurchaseorderdetailRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(compositeIds: Array[PurchaseorderdetailId])(using c: Connection): List[PurchaseorderdetailRow] = {
    val purchaseorderid: Array[PurchaseorderheaderId] = compositeIds.map(_.purchaseorderid)
    val purchaseorderdetailid: Array[Int] = compositeIds.map(_.purchaseorderdetailid)
    return sql"""select "purchaseorderid", "purchaseorderdetailid", "duedate", "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"
    from "purchasing"."purchaseorderdetail"
    where ("purchaseorderid", "purchaseorderdetailid")
    in (select * from unnest(${Fragment.encode(PurchaseorderheaderId.pgTypeArray, purchaseorderid)}, ${Fragment.encode(PgTypes.int4ArrayUnboxed, purchaseorderdetailid)}))
    """.query(PurchaseorderdetailRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(compositeIds: Array[PurchaseorderdetailId])(using c: Connection): Map[PurchaseorderdetailId, PurchaseorderdetailRow] = {
    val ret: scala.collection.mutable.Map[PurchaseorderdetailId, PurchaseorderdetailRow] = scala.collection.mutable.Map.empty[PurchaseorderdetailId, PurchaseorderdetailRow]
    selectByIds(compositeIds)(using c).foreach(row => ret.put(row.compositeId, row): @scala.annotation.nowarn)
    return ret.toMap
  }
}