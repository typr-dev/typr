/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.person_detail

import adventureworks.person.businessentity.BusinessentityId
import java.sql.Connection
import java.time.LocalDateTime
import typr.runtime.PgTypes
import typr.scaladsl.Fragment
import typr.scaladsl.Fragment.sql

class PersonDetailSqlRepoImpl extends PersonDetailSqlRepo {
  override def apply(
    businessentityid: /* user-picked */ BusinessentityId,
    modifiedAfter: LocalDateTime
  )(using c: Connection): List[PersonDetailSqlRow] = {
    sql"""SELECT s.businessentityid,
           p.title,
           p.firstname,
           p.middlename,
           p.lastname,
           e.jobtitle,
           a.addressline1,
           a.city,
           a.postalcode,
           a.rowguid
    FROM sales.salesperson s
             JOIN humanresources.employee e ON e.businessentityid = s.businessentityid
             JOIN person.person p ON p.businessentityid = s.businessentityid
             JOIN person.businessentityaddress bea ON bea.businessentityid = s.businessentityid
             LEFT JOIN person.address a ON a.addressid = bea.addressid
    where s.businessentityid = ${Fragment.encode(BusinessentityId.pgType, businessentityid)}::int4
      and p.modifieddate > ${Fragment.encode(PgTypes.timestamp, modifiedAfter)}::timestamp""".query(PersonDetailSqlRow.`_rowParser`.all()).runUnchecked(c)
  }
}