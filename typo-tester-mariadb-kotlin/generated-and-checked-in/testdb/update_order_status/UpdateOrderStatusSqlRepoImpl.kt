/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.update_order_status

import java.sql.Connection
import testdb.orders.OrdersId
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class UpdateOrderStatusSqlRepoImpl() : UpdateOrderStatusSqlRepo {
  override fun apply(
    newStatus: /* user-picked */ java.lang.String,
    orderId: /* user-picked */ OrdersId,
    c: Connection
  ): Int = interpolate(
    typo.runtime.Fragment.lit("""
      -- Update order status
      UPDATE orders
      SET order_status = """.trimMargin()),
    MariaTypes.text.encode(newStatus),
    typo.runtime.Fragment.lit("""
      ,
          confirmed_at = CASE WHEN """.trimMargin()),
    MariaTypes.text.encode(newStatus),
    typo.runtime.Fragment.lit("""
       = 'confirmed' THEN NOW(6) ELSE confirmed_at END,
          shipped_at = CASE WHEN """.trimMargin()),
    MariaTypes.text.encode(newStatus),
    typo.runtime.Fragment.lit("""
       = 'shipped' THEN NOW(6) ELSE shipped_at END,
          delivered_at = CASE WHEN """.trimMargin()),
    MariaTypes.text.encode(newStatus),
    typo.runtime.Fragment.lit("""
       = 'delivered' THEN NOW(6) ELSE delivered_at END
      WHERE order_id = """.trimMargin()),
    /* user-picked */ OrdersId.pgType.encode(orderId),
    typo.runtime.Fragment.lit("""


    """.trimMargin())
  ).update().runUnchecked(c)
}