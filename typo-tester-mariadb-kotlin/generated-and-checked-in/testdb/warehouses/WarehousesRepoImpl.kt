/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.warehouses

import java.sql.Connection
import java.util.ArrayList
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableIterator
import kotlin.collections.MutableMap
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class WarehousesRepoImpl() : WarehousesRepo {
  override fun delete(): DeleteBuilder<WarehousesFields, WarehousesRow> = DeleteBuilder.of("`warehouses`", WarehousesFields.structure, Dialect.MARIADB)

  override fun deleteById(
    warehouseId: WarehousesId,
    c: Connection
  ): Boolean = interpolate(
    typo.runtime.Fragment.lit("delete from `warehouses` where `warehouse_id` = "),
    WarehousesId.pgType.encode(warehouseId),
    typo.runtime.Fragment.lit("")
  ).update().runUnchecked(c) > 0

  override fun deleteByIds(
    warehouseIds: Array<WarehousesId>,
    c: Connection
  ): Int {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in warehouseIds) { fragments.add(WarehousesId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override fun insert(
    unsaved: WarehousesRow,
    c: Connection
  ): WarehousesRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
      values (""".trimMargin()),
    MariaTypes.text.encode(unsaved.code),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.name),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.address),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.point.encode(unsaved.location),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.polygon.opt().encode(unsaved.serviceArea),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.timezone),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bool.encode(unsaved.isActive),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.contactEmail),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.contactPhone),
    typo.runtime.Fragment.lit("""
      )
      returning `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    """.trimMargin())
  )
    .updateReturning(WarehousesRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: WarehousesRowUnsaved,
    c: Connection
  ): WarehousesRow {
    val columns: ArrayList<Literal> = ArrayList<Literal>()
    val values: ArrayList<Fragment> = ArrayList<Fragment>()
    columns.add(Fragment.lit("`code`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.code),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`name`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.name),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`address`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.address),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`location`"))
    values.add(interpolate(
      MariaTypes.point.encode(unsaved.location),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    unsaved.serviceArea.visit(
      {  },
      { value -> columns.add(Fragment.lit("`service_area`"))
      values.add(interpolate(
        MariaTypes.polygon.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.timezone.visit(
      {  },
      { value -> columns.add(Fragment.lit("`timezone`"))
      values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.isActive.visit(
      {  },
      { value -> columns.add(Fragment.lit("`is_active`"))
      values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.contactEmail.visit(
      {  },
      { value -> columns.add(Fragment.lit("`contact_email`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.contactPhone.visit(
      {  },
      { value -> columns.add(Fragment.lit("`contact_phone`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    val q: Fragment = interpolate(
      typo.runtime.Fragment.lit("insert into `warehouses`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
        )
        values (""".trimMargin()),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
        )
        returning `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      """.trimMargin())
    )
    return q.updateReturning(WarehousesRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<WarehousesFields, WarehousesRow> = SelectBuilder.of("`warehouses`", WarehousesFields.structure, WarehousesRow._rowParser, Dialect.MARIADB)

  override fun selectAll(c: Connection): List<WarehousesRow> = interpolate(typo.runtime.Fragment.lit("""
    select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
  """.trimMargin())).query(WarehousesRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    warehouseId: WarehousesId,
    c: Connection
  ): Optional<WarehousesRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      from `warehouses`
      where `warehouse_id` = """.trimMargin()),
    WarehousesId.pgType.encode(warehouseId),
    typo.runtime.Fragment.lit("")
  ).query(WarehousesRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    warehouseIds: Array<WarehousesId>,
    c: Connection
  ): List<WarehousesRow> {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in warehouseIds) { fragments.add(WarehousesId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone` from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(WarehousesRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    warehouseIds: Array<WarehousesId>,
    c: Connection
  ): Map<WarehousesId, WarehousesRow> {
    val ret: MutableMap<WarehousesId, WarehousesRow> = mutableMapOf<WarehousesId, WarehousesRow>()
    selectByIds(warehouseIds, c).forEach({ row -> ret.put(row.warehouseId, row) })
    return ret
  }

  override fun selectByUniqueCode(
    code: String,
    c: Connection
  ): Optional<WarehousesRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      from `warehouses`
      where `code` = """.trimMargin()),
    MariaTypes.text.encode(code),
    typo.runtime.Fragment.lit("""


    """.trimMargin())
  ).query(WarehousesRow._rowParser.first()).runUnchecked(c)

  override fun update(): UpdateBuilder<WarehousesFields, WarehousesRow> = UpdateBuilder.of("`warehouses`", WarehousesFields.structure, WarehousesRow._rowParser.all(), Dialect.MARIADB)

  override fun update(
    row: WarehousesRow,
    c: Connection
  ): Boolean {
    val warehouseId: WarehousesId = row.warehouseId
    return interpolate(
      typo.runtime.Fragment.lit("""
        update `warehouses`
        set `code` = """.trimMargin()),
      MariaTypes.text.encode(row.code),
      typo.runtime.Fragment.lit("""
        ,
        `name` = """.trimMargin()),
      MariaTypes.text.encode(row.name),
      typo.runtime.Fragment.lit("""
        ,
        `address` = """.trimMargin()),
      MariaTypes.text.encode(row.address),
      typo.runtime.Fragment.lit("""
        ,
        `location` = """.trimMargin()),
      MariaTypes.point.encode(row.location),
      typo.runtime.Fragment.lit("""
        ,
        `service_area` = """.trimMargin()),
      MariaTypes.polygon.opt().encode(row.serviceArea),
      typo.runtime.Fragment.lit("""
        ,
        `timezone` = """.trimMargin()),
      MariaTypes.text.encode(row.timezone),
      typo.runtime.Fragment.lit("""
        ,
        `is_active` = """.trimMargin()),
      MariaTypes.bool.encode(row.isActive),
      typo.runtime.Fragment.lit("""
        ,
        `contact_email` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.contactEmail),
      typo.runtime.Fragment.lit("""
        ,
        `contact_phone` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.contactPhone),
      typo.runtime.Fragment.lit("""
  
        where `warehouse_id` = """.trimMargin()),
      WarehousesId.pgType.encode(warehouseId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0
  }

  override fun upsert(
    unsaved: WarehousesRow,
    c: Connection
  ): WarehousesRow = interpolate(
    typo.runtime.Fragment.lit("""
      INSERT INTO `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
      VALUES (""".trimMargin()),
    MariaTypes.text.encode(unsaved.code),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.name),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.address),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.point.encode(unsaved.location),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.polygon.opt().encode(unsaved.serviceArea),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.timezone),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bool.encode(unsaved.isActive),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.contactEmail),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.contactPhone),
    typo.runtime.Fragment.lit("""
      )
      ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
      `name` = VALUES(`name`),
      `address` = VALUES(`address`),
      `location` = VALUES(`location`),
      `service_area` = VALUES(`service_area`),
      `timezone` = VALUES(`timezone`),
      `is_active` = VALUES(`is_active`),
      `contact_email` = VALUES(`contact_email`),
      `contact_phone` = VALUES(`contact_phone`)
      RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`""".trimMargin())
  )
    .updateReturning(WarehousesRow._rowParser.exactlyOne())
    .runUnchecked(c)

  override fun upsertBatch(
    unsaved: MutableIterator<WarehousesRow>,
    c: Connection
  ): List<WarehousesRow> = interpolate(typo.runtime.Fragment.lit("""
                             INSERT INTO `warehouses`(`warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
                             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                             ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
                             `name` = VALUES(`name`),
                             `address` = VALUES(`address`),
                             `location` = VALUES(`location`),
                             `service_area` = VALUES(`service_area`),
                             `timezone` = VALUES(`timezone`),
                             `is_active` = VALUES(`is_active`),
                             `contact_email` = VALUES(`contact_email`),
                             `contact_phone` = VALUES(`contact_phone`)
                             RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`""".trimMargin()))
    .updateReturningEach(WarehousesRow._rowParser, unsaved)
    .runUnchecked(c)
}