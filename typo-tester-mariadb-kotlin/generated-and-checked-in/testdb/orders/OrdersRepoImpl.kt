/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.orders

import java.sql.Connection
import java.util.ArrayList
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableIterator
import kotlin.collections.MutableMap
import testdb.customer_addresses.CustomerAddressesId
import testdb.customers.CustomersId
import testdb.promotions.PromotionsId
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class OrdersRepoImpl() : OrdersRepo {
  override fun delete(): DeleteBuilder<OrdersFields, OrdersRow> = DeleteBuilder.of("`orders`", OrdersFields.structure, Dialect.MARIADB)

  override fun deleteById(
    orderId: OrdersId,
    c: Connection
  ): Boolean = interpolate(
    typo.runtime.Fragment.lit("delete from `orders` where `order_id` = "),
    OrdersId.pgType.encode(orderId),
    typo.runtime.Fragment.lit("")
  ).update().runUnchecked(c) > 0

  override fun deleteByIds(
    orderIds: Array<OrdersId>,
    c: Connection
  ): Int {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in orderIds) { fragments.add(OrdersId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `orders` where `order_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override fun insert(
    unsaved: OrdersRow,
    c: Connection
  ): OrdersRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into `orders`(`order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
      values (""".trimMargin()),
    MariaTypes.text.encode(unsaved.orderNumber),
    typo.runtime.Fragment.lit(", "),
    CustomersId.pgType.encode(unsaved.customerId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.orderStatus),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.paymentStatus),
    typo.runtime.Fragment.lit(", "),
    CustomerAddressesId.pgType.opt().encode(unsaved.shippingAddressId),
    typo.runtime.Fragment.lit(", "),
    CustomerAddressesId.pgType.opt().encode(unsaved.billingAddressId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.subtotal),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.shippingCost),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.taxAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.discountAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.totalAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.currencyCode),
    typo.runtime.Fragment.lit(", "),
    PromotionsId.pgType.opt().encode(unsaved.promotionId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.notes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.internalNotes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.inet6.opt().encode(unsaved.ipAddress),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.userAgent),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.orderedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.confirmedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.shippedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.deliveredAt),
    typo.runtime.Fragment.lit("""
      )
      returning `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    """.trimMargin())
  )
    .updateReturning(OrdersRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: OrdersRowUnsaved,
    c: Connection
  ): OrdersRow {
    val columns: ArrayList<Literal> = ArrayList<Literal>()
    val values: ArrayList<Fragment> = ArrayList<Fragment>()
    columns.add(Fragment.lit("`order_number`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.orderNumber),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`customer_id`"))
    values.add(interpolate(
      CustomersId.pgType.encode(unsaved.customerId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`subtotal`"))
    values.add(interpolate(
      MariaTypes.numeric.encode(unsaved.subtotal),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`total_amount`"))
    values.add(interpolate(
      MariaTypes.numeric.encode(unsaved.totalAmount),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    unsaved.orderStatus.visit(
      {  },
      { value -> columns.add(Fragment.lit("`order_status`"))
      values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.paymentStatus.visit(
      {  },
      { value -> columns.add(Fragment.lit("`payment_status`"))
      values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.shippingAddressId.visit(
      {  },
      { value -> columns.add(Fragment.lit("`shipping_address_id`"))
      values.add(interpolate(
        CustomerAddressesId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.billingAddressId.visit(
      {  },
      { value -> columns.add(Fragment.lit("`billing_address_id`"))
      values.add(interpolate(
        CustomerAddressesId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.shippingCost.visit(
      {  },
      { value -> columns.add(Fragment.lit("`shipping_cost`"))
      values.add(interpolate(
        MariaTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.taxAmount.visit(
      {  },
      { value -> columns.add(Fragment.lit("`tax_amount`"))
      values.add(interpolate(
        MariaTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.discountAmount.visit(
      {  },
      { value -> columns.add(Fragment.lit("`discount_amount`"))
      values.add(interpolate(
        MariaTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.currencyCode.visit(
      {  },
      { value -> columns.add(Fragment.lit("`currency_code`"))
      values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.promotionId.visit(
      {  },
      { value -> columns.add(Fragment.lit("`promotion_id`"))
      values.add(interpolate(
        PromotionsId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.notes.visit(
      {  },
      { value -> columns.add(Fragment.lit("`notes`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.internalNotes.visit(
      {  },
      { value -> columns.add(Fragment.lit("`internal_notes`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.ipAddress.visit(
      {  },
      { value -> columns.add(Fragment.lit("`ip_address`"))
      values.add(interpolate(
        MariaTypes.inet6.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.userAgent.visit(
      {  },
      { value -> columns.add(Fragment.lit("`user_agent`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.orderedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`ordered_at`"))
      values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.confirmedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`confirmed_at`"))
      values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.shippedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`shipped_at`"))
      values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.deliveredAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`delivered_at`"))
      values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    val q: Fragment = interpolate(
      typo.runtime.Fragment.lit("insert into `orders`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
        )
        values (""".trimMargin()),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
        )
        returning `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
      """.trimMargin())
    )
    return q.updateReturning(OrdersRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<OrdersFields, OrdersRow> = SelectBuilder.of("`orders`", OrdersFields.structure, OrdersRow._rowParser, Dialect.MARIADB)

  override fun selectAll(c: Connection): List<OrdersRow> = interpolate(typo.runtime.Fragment.lit("""
    select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
  """.trimMargin())).query(OrdersRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    orderId: OrdersId,
    c: Connection
  ): Optional<OrdersRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
      from `orders`
      where `order_id` = """.trimMargin()),
    OrdersId.pgType.encode(orderId),
    typo.runtime.Fragment.lit("")
  ).query(OrdersRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    orderIds: Array<OrdersId>,
    c: Connection
  ): List<OrdersRow> {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in orderIds) { fragments.add(OrdersId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at` from `orders` where `order_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(OrdersRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    orderIds: Array<OrdersId>,
    c: Connection
  ): Map<OrdersId, OrdersRow> {
    val ret: MutableMap<OrdersId, OrdersRow> = mutableMapOf<OrdersId, OrdersRow>()
    selectByIds(orderIds, c).forEach({ row -> ret.put(row.orderId, row) })
    return ret
  }

  override fun selectByUniqueOrderNumber(
    orderNumber: String,
    c: Connection
  ): Optional<OrdersRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
      from `orders`
      where `order_number` = """.trimMargin()),
    MariaTypes.text.encode(orderNumber),
    typo.runtime.Fragment.lit("""


    """.trimMargin())
  ).query(OrdersRow._rowParser.first()).runUnchecked(c)

  override fun update(): UpdateBuilder<OrdersFields, OrdersRow> = UpdateBuilder.of("`orders`", OrdersFields.structure, OrdersRow._rowParser.all(), Dialect.MARIADB)

  override fun update(
    row: OrdersRow,
    c: Connection
  ): Boolean {
    val orderId: OrdersId = row.orderId
    return interpolate(
      typo.runtime.Fragment.lit("""
        update `orders`
        set `order_number` = """.trimMargin()),
      MariaTypes.text.encode(row.orderNumber),
      typo.runtime.Fragment.lit("""
        ,
        `customer_id` = """.trimMargin()),
      CustomersId.pgType.encode(row.customerId),
      typo.runtime.Fragment.lit("""
        ,
        `order_status` = """.trimMargin()),
      MariaTypes.text.encode(row.orderStatus),
      typo.runtime.Fragment.lit("""
        ,
        `payment_status` = """.trimMargin()),
      MariaTypes.text.encode(row.paymentStatus),
      typo.runtime.Fragment.lit("""
        ,
        `shipping_address_id` = """.trimMargin()),
      CustomerAddressesId.pgType.opt().encode(row.shippingAddressId),
      typo.runtime.Fragment.lit("""
        ,
        `billing_address_id` = """.trimMargin()),
      CustomerAddressesId.pgType.opt().encode(row.billingAddressId),
      typo.runtime.Fragment.lit("""
        ,
        `subtotal` = """.trimMargin()),
      MariaTypes.numeric.encode(row.subtotal),
      typo.runtime.Fragment.lit("""
        ,
        `shipping_cost` = """.trimMargin()),
      MariaTypes.numeric.encode(row.shippingCost),
      typo.runtime.Fragment.lit("""
        ,
        `tax_amount` = """.trimMargin()),
      MariaTypes.numeric.encode(row.taxAmount),
      typo.runtime.Fragment.lit("""
        ,
        `discount_amount` = """.trimMargin()),
      MariaTypes.numeric.encode(row.discountAmount),
      typo.runtime.Fragment.lit("""
        ,
        `total_amount` = """.trimMargin()),
      MariaTypes.numeric.encode(row.totalAmount),
      typo.runtime.Fragment.lit("""
        ,
        `currency_code` = """.trimMargin()),
      MariaTypes.text.encode(row.currencyCode),
      typo.runtime.Fragment.lit("""
        ,
        `promotion_id` = """.trimMargin()),
      PromotionsId.pgType.opt().encode(row.promotionId),
      typo.runtime.Fragment.lit("""
        ,
        `notes` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.notes),
      typo.runtime.Fragment.lit("""
        ,
        `internal_notes` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.internalNotes),
      typo.runtime.Fragment.lit("""
        ,
        `ip_address` = """.trimMargin()),
      MariaTypes.inet6.opt().encode(row.ipAddress),
      typo.runtime.Fragment.lit("""
        ,
        `user_agent` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.userAgent),
      typo.runtime.Fragment.lit("""
        ,
        `ordered_at` = """.trimMargin()),
      MariaTypes.datetime.encode(row.orderedAt),
      typo.runtime.Fragment.lit("""
        ,
        `confirmed_at` = """.trimMargin()),
      MariaTypes.datetime.opt().encode(row.confirmedAt),
      typo.runtime.Fragment.lit("""
        ,
        `shipped_at` = """.trimMargin()),
      MariaTypes.datetime.opt().encode(row.shippedAt),
      typo.runtime.Fragment.lit("""
        ,
        `delivered_at` = """.trimMargin()),
      MariaTypes.datetime.opt().encode(row.deliveredAt),
      typo.runtime.Fragment.lit("""
  
        where `order_id` = """.trimMargin()),
      OrdersId.pgType.encode(orderId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0
  }

  override fun upsert(
    unsaved: OrdersRow,
    c: Connection
  ): OrdersRow = interpolate(
    typo.runtime.Fragment.lit("""
      INSERT INTO `orders`(`order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
      VALUES (""".trimMargin()),
    MariaTypes.text.encode(unsaved.orderNumber),
    typo.runtime.Fragment.lit(", "),
    CustomersId.pgType.encode(unsaved.customerId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.orderStatus),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.paymentStatus),
    typo.runtime.Fragment.lit(", "),
    CustomerAddressesId.pgType.opt().encode(unsaved.shippingAddressId),
    typo.runtime.Fragment.lit(", "),
    CustomerAddressesId.pgType.opt().encode(unsaved.billingAddressId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.subtotal),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.shippingCost),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.taxAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.discountAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.totalAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.currencyCode),
    typo.runtime.Fragment.lit(", "),
    PromotionsId.pgType.opt().encode(unsaved.promotionId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.notes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.internalNotes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.inet6.opt().encode(unsaved.ipAddress),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.userAgent),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.orderedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.confirmedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.shippedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.deliveredAt),
    typo.runtime.Fragment.lit("""
      )
      ON DUPLICATE KEY UPDATE `order_number` = VALUES(`order_number`),
      `customer_id` = VALUES(`customer_id`),
      `order_status` = VALUES(`order_status`),
      `payment_status` = VALUES(`payment_status`),
      `shipping_address_id` = VALUES(`shipping_address_id`),
      `billing_address_id` = VALUES(`billing_address_id`),
      `subtotal` = VALUES(`subtotal`),
      `shipping_cost` = VALUES(`shipping_cost`),
      `tax_amount` = VALUES(`tax_amount`),
      `discount_amount` = VALUES(`discount_amount`),
      `total_amount` = VALUES(`total_amount`),
      `currency_code` = VALUES(`currency_code`),
      `promotion_id` = VALUES(`promotion_id`),
      `notes` = VALUES(`notes`),
      `internal_notes` = VALUES(`internal_notes`),
      `ip_address` = VALUES(`ip_address`),
      `user_agent` = VALUES(`user_agent`),
      `ordered_at` = VALUES(`ordered_at`),
      `confirmed_at` = VALUES(`confirmed_at`),
      `shipped_at` = VALUES(`shipped_at`),
      `delivered_at` = VALUES(`delivered_at`)
      RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`""".trimMargin())
  )
    .updateReturning(OrdersRow._rowParser.exactlyOne())
    .runUnchecked(c)

  override fun upsertBatch(
    unsaved: MutableIterator<OrdersRow>,
    c: Connection
  ): List<OrdersRow> = interpolate(typo.runtime.Fragment.lit("""
                         INSERT INTO `orders`(`order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
                         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                         ON DUPLICATE KEY UPDATE `order_number` = VALUES(`order_number`),
                         `customer_id` = VALUES(`customer_id`),
                         `order_status` = VALUES(`order_status`),
                         `payment_status` = VALUES(`payment_status`),
                         `shipping_address_id` = VALUES(`shipping_address_id`),
                         `billing_address_id` = VALUES(`billing_address_id`),
                         `subtotal` = VALUES(`subtotal`),
                         `shipping_cost` = VALUES(`shipping_cost`),
                         `tax_amount` = VALUES(`tax_amount`),
                         `discount_amount` = VALUES(`discount_amount`),
                         `total_amount` = VALUES(`total_amount`),
                         `currency_code` = VALUES(`currency_code`),
                         `promotion_id` = VALUES(`promotion_id`),
                         `notes` = VALUES(`notes`),
                         `internal_notes` = VALUES(`internal_notes`),
                         `ip_address` = VALUES(`ip_address`),
                         `user_agent` = VALUES(`user_agent`),
                         `ordered_at` = VALUES(`ordered_at`),
                         `confirmed_at` = VALUES(`confirmed_at`),
                         `shipped_at` = VALUES(`shipped_at`),
                         `delivered_at` = VALUES(`delivered_at`)
                         RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`""".trimMargin()))
    .updateReturningEach(OrdersRow._rowParser, unsaved)
    .runUnchecked(c)
}