/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.reviews

import java.sql.Connection
import java.util.ArrayList
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableIterator
import kotlin.collections.MutableMap
import testdb.customers.CustomersId
import testdb.order_items.OrderItemsId
import testdb.products.ProductsId
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class ReviewsRepoImpl() : ReviewsRepo {
  override fun delete(): DeleteBuilder<ReviewsFields, ReviewsRow> = DeleteBuilder.of("`reviews`", ReviewsFields.structure, Dialect.MARIADB)

  override fun deleteById(
    reviewId: ReviewsId,
    c: Connection
  ): Boolean = interpolate(
    typo.runtime.Fragment.lit("delete from `reviews` where `review_id` = "),
    ReviewsId.pgType.encode(reviewId),
    typo.runtime.Fragment.lit("")
  ).update().runUnchecked(c) > 0

  override fun deleteByIds(
    reviewIds: Array<ReviewsId>,
    c: Connection
  ): Int {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in reviewIds) { fragments.add(ReviewsId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `reviews` where `review_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override fun insert(
    unsaved: ReviewsRow,
    c: Connection
  ): ReviewsRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
      values (""".trimMargin()),
    ProductsId.pgType.encode(unsaved.productId),
    typo.runtime.Fragment.lit(", "),
    CustomersId.pgType.encode(unsaved.customerId),
    typo.runtime.Fragment.lit(", "),
    OrderItemsId.pgType.opt().encode(unsaved.orderItemId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.smallint.encode(unsaved.rating),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.title),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.content),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.pros),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.cons),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.images),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bool.encode(unsaved.isVerifiedPurchase),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bool.encode(unsaved.isApproved),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bigint.encode(unsaved.helpfulVotes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bigint.encode(unsaved.unhelpfulVotes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.adminResponse),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.respondedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.createdAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.updatedAt),
    typo.runtime.Fragment.lit("""
      )
      returning `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
    """.trimMargin())
  )
    .updateReturning(ReviewsRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: ReviewsRowUnsaved,
    c: Connection
  ): ReviewsRow {
    val columns: ArrayList<Literal> = ArrayList<Literal>()
    val values: ArrayList<Fragment> = ArrayList<Fragment>()
    columns.add(Fragment.lit("`product_id`"))
    values.add(interpolate(
      ProductsId.pgType.encode(unsaved.productId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`customer_id`"))
    values.add(interpolate(
      CustomersId.pgType.encode(unsaved.customerId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`rating`"))
    values.add(interpolate(
      MariaTypes.smallint.encode(unsaved.rating),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    unsaved.orderItemId.visit(
      {  },
      { value -> columns.add(Fragment.lit("`order_item_id`"))
      values.add(interpolate(
        OrderItemsId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.title.visit(
      {  },
      { value -> columns.add(Fragment.lit("`title`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.content.visit(
      {  },
      { value -> columns.add(Fragment.lit("`content`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.pros.visit(
      {  },
      { value -> columns.add(Fragment.lit("`pros`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.cons.visit(
      {  },
      { value -> columns.add(Fragment.lit("`cons`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.images.visit(
      {  },
      { value -> columns.add(Fragment.lit("`images`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.isVerifiedPurchase.visit(
      {  },
      { value -> columns.add(Fragment.lit("`is_verified_purchase`"))
      values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.isApproved.visit(
      {  },
      { value -> columns.add(Fragment.lit("`is_approved`"))
      values.add(interpolate(
        MariaTypes.bool.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.helpfulVotes.visit(
      {  },
      { value -> columns.add(Fragment.lit("`helpful_votes`"))
      values.add(interpolate(
        MariaTypes.bigint.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.unhelpfulVotes.visit(
      {  },
      { value -> columns.add(Fragment.lit("`unhelpful_votes`"))
      values.add(interpolate(
        MariaTypes.bigint.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.adminResponse.visit(
      {  },
      { value -> columns.add(Fragment.lit("`admin_response`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.respondedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`responded_at`"))
      values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.createdAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`created_at`"))
      values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.updatedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`updated_at`"))
      values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    val q: Fragment = interpolate(
      typo.runtime.Fragment.lit("insert into `reviews`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
        )
        values (""".trimMargin()),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
        )
        returning `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
      """.trimMargin())
    )
    return q.updateReturning(ReviewsRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<ReviewsFields, ReviewsRow> = SelectBuilder.of("`reviews`", ReviewsFields.structure, ReviewsRow._rowParser, Dialect.MARIADB)

  override fun selectAll(c: Connection): List<ReviewsRow> = interpolate(typo.runtime.Fragment.lit("""
    select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
    from `reviews`
  """.trimMargin())).query(ReviewsRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    reviewId: ReviewsId,
    c: Connection
  ): Optional<ReviewsRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
      from `reviews`
      where `review_id` = """.trimMargin()),
    ReviewsId.pgType.encode(reviewId),
    typo.runtime.Fragment.lit("")
  ).query(ReviewsRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    reviewIds: Array<ReviewsId>,
    c: Connection
  ): List<ReviewsRow> {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in reviewIds) { fragments.add(ReviewsId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at` from `reviews` where `review_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(ReviewsRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    reviewIds: Array<ReviewsId>,
    c: Connection
  ): Map<ReviewsId, ReviewsRow> {
    val ret: MutableMap<ReviewsId, ReviewsRow> = mutableMapOf<ReviewsId, ReviewsRow>()
    selectByIds(reviewIds, c).forEach({ row -> ret.put(row.reviewId, row) })
    return ret
  }

  override fun update(): UpdateBuilder<ReviewsFields, ReviewsRow> = UpdateBuilder.of("`reviews`", ReviewsFields.structure, ReviewsRow._rowParser.all(), Dialect.MARIADB)

  override fun update(
    row: ReviewsRow,
    c: Connection
  ): Boolean {
    val reviewId: ReviewsId = row.reviewId
    return interpolate(
      typo.runtime.Fragment.lit("""
        update `reviews`
        set `product_id` = """.trimMargin()),
      ProductsId.pgType.encode(row.productId),
      typo.runtime.Fragment.lit("""
        ,
        `customer_id` = """.trimMargin()),
      CustomersId.pgType.encode(row.customerId),
      typo.runtime.Fragment.lit("""
        ,
        `order_item_id` = """.trimMargin()),
      OrderItemsId.pgType.opt().encode(row.orderItemId),
      typo.runtime.Fragment.lit("""
        ,
        `rating` = """.trimMargin()),
      MariaTypes.smallint.encode(row.rating),
      typo.runtime.Fragment.lit("""
        ,
        `title` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.title),
      typo.runtime.Fragment.lit("""
        ,
        `content` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.content),
      typo.runtime.Fragment.lit("""
        ,
        `pros` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.pros),
      typo.runtime.Fragment.lit("""
        ,
        `cons` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.cons),
      typo.runtime.Fragment.lit("""
        ,
        `images` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.images),
      typo.runtime.Fragment.lit("""
        ,
        `is_verified_purchase` = """.trimMargin()),
      MariaTypes.bool.encode(row.isVerifiedPurchase),
      typo.runtime.Fragment.lit("""
        ,
        `is_approved` = """.trimMargin()),
      MariaTypes.bool.encode(row.isApproved),
      typo.runtime.Fragment.lit("""
        ,
        `helpful_votes` = """.trimMargin()),
      MariaTypes.bigint.encode(row.helpfulVotes),
      typo.runtime.Fragment.lit("""
        ,
        `unhelpful_votes` = """.trimMargin()),
      MariaTypes.bigint.encode(row.unhelpfulVotes),
      typo.runtime.Fragment.lit("""
        ,
        `admin_response` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.adminResponse),
      typo.runtime.Fragment.lit("""
        ,
        `responded_at` = """.trimMargin()),
      MariaTypes.datetime.opt().encode(row.respondedAt),
      typo.runtime.Fragment.lit("""
        ,
        `created_at` = """.trimMargin()),
      MariaTypes.datetime.encode(row.createdAt),
      typo.runtime.Fragment.lit("""
        ,
        `updated_at` = """.trimMargin()),
      MariaTypes.datetime.encode(row.updatedAt),
      typo.runtime.Fragment.lit("""
  
        where `review_id` = """.trimMargin()),
      ReviewsId.pgType.encode(reviewId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0
  }

  override fun upsert(
    unsaved: ReviewsRow,
    c: Connection
  ): ReviewsRow = interpolate(
    typo.runtime.Fragment.lit("""
      INSERT INTO `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
      VALUES (""".trimMargin()),
    ProductsId.pgType.encode(unsaved.productId),
    typo.runtime.Fragment.lit(", "),
    CustomersId.pgType.encode(unsaved.customerId),
    typo.runtime.Fragment.lit(", "),
    OrderItemsId.pgType.opt().encode(unsaved.orderItemId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.smallint.encode(unsaved.rating),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.title),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.content),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.pros),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.cons),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.images),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bool.encode(unsaved.isVerifiedPurchase),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bool.encode(unsaved.isApproved),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bigint.encode(unsaved.helpfulVotes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.bigint.encode(unsaved.unhelpfulVotes),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.adminResponse),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.respondedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.createdAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.updatedAt),
    typo.runtime.Fragment.lit("""
      )
      ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),
      `customer_id` = VALUES(`customer_id`),
      `order_item_id` = VALUES(`order_item_id`),
      `rating` = VALUES(`rating`),
      `title` = VALUES(`title`),
      `content` = VALUES(`content`),
      `pros` = VALUES(`pros`),
      `cons` = VALUES(`cons`),
      `images` = VALUES(`images`),
      `is_verified_purchase` = VALUES(`is_verified_purchase`),
      `is_approved` = VALUES(`is_approved`),
      `helpful_votes` = VALUES(`helpful_votes`),
      `unhelpful_votes` = VALUES(`unhelpful_votes`),
      `admin_response` = VALUES(`admin_response`),
      `responded_at` = VALUES(`responded_at`),
      `created_at` = VALUES(`created_at`),
      `updated_at` = VALUES(`updated_at`)
      RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`""".trimMargin())
  )
    .updateReturning(ReviewsRow._rowParser.exactlyOne())
    .runUnchecked(c)

  override fun upsertBatch(
    unsaved: MutableIterator<ReviewsRow>,
    c: Connection
  ): List<ReviewsRow> = interpolate(typo.runtime.Fragment.lit("""
                          INSERT INTO `reviews`(`review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
                          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                          ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),
                          `customer_id` = VALUES(`customer_id`),
                          `order_item_id` = VALUES(`order_item_id`),
                          `rating` = VALUES(`rating`),
                          `title` = VALUES(`title`),
                          `content` = VALUES(`content`),
                          `pros` = VALUES(`pros`),
                          `cons` = VALUES(`cons`),
                          `images` = VALUES(`images`),
                          `is_verified_purchase` = VALUES(`is_verified_purchase`),
                          `is_approved` = VALUES(`is_approved`),
                          `helpful_votes` = VALUES(`helpful_votes`),
                          `unhelpful_votes` = VALUES(`unhelpful_votes`),
                          `admin_response` = VALUES(`admin_response`),
                          `responded_at` = VALUES(`responded_at`),
                          `created_at` = VALUES(`created_at`),
                          `updated_at` = VALUES(`updated_at`)
                          RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`""".trimMargin()))
    .updateReturningEach(ReviewsRow._rowParser, unsaved)
    .runUnchecked(c)
}