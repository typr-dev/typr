/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.customer_orders

import java.sql.Connection
import java.util.Optional
import kotlin.collections.List
import testdb.customers.CustomersId
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class CustomerOrdersSqlRepoImpl() : CustomerOrdersSqlRepo {
  override fun apply(
    customerId: /* user-picked */ CustomersId,
    orderStatus: Optional<String>,
    c: Connection
  ): List<CustomerOrdersSqlRow> = interpolate(
    typo.runtime.Fragment.lit("""
      -- Query customers with their orders
      SELECT c.customer_id,
             c.email,
             c.first_name,
             c.last_name,
             c.tier,
             o.order_id,
             o.order_number,
             o.order_status,
             o.total_amount,
             o.ordered_at
      FROM customers c
      LEFT JOIN orders o ON c.customer_id = o.customer_id
      WHERE c.customer_id = """.trimMargin()),
    /* user-picked */ CustomersId.pgType.encode(customerId),
    typo.runtime.Fragment.lit("""
  
        AND (""".trimMargin()),
    MariaTypes.text.opt().encode(orderStatus),
    typo.runtime.Fragment.lit(" IS NULL OR o.order_status = "),
    MariaTypes.text.opt().encode(orderStatus),
    typo.runtime.Fragment.lit("""
    )

    """.trimMargin())
  ).query(CustomerOrdersSqlRow._rowParser.all()).runUnchecked(c)
}