/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.product_search

import java.math.BigDecimal
import java.sql.Connection
import java.util.Optional
import kotlin.collections.List
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class ProductSearchSqlRepoImpl() : ProductSearchSqlRepo {
  override fun apply(
    brandId: Optional<Int>,
    minPrice: Optional<BigDecimal>,
    maxPrice: Optional<BigDecimal>,
    status: Optional<String>,
    limit: Long,
    c: Connection
  ): List<ProductSearchSqlRow> = interpolate(
    typo.runtime.Fragment.lit("""
      -- Search products with optional filters
      SELECT p.product_id,
             p.sku,
             p.name,
             p.short_description,
             p.base_price,
             p.status,
             b.name AS brand_name
      FROM products p
      LEFT JOIN brands b ON p.brand_id = b.brand_id
      WHERE (""".trimMargin()),
    MariaTypes.int_.opt().encode(brandId),
    typo.runtime.Fragment.lit(" IS NULL OR p.brand_id = "),
    MariaTypes.int_.opt().encode(brandId),
    typo.runtime.Fragment.lit("""
      )
        AND (""".trimMargin()),
    MariaTypes.numeric.opt().encode(minPrice),
    typo.runtime.Fragment.lit(" IS NULL OR p.base_price >= "),
    MariaTypes.numeric.opt().encode(minPrice),
    typo.runtime.Fragment.lit("""
      )
        AND (""".trimMargin()),
    MariaTypes.numeric.opt().encode(maxPrice),
    typo.runtime.Fragment.lit(" IS NULL OR p.base_price <= "),
    MariaTypes.numeric.opt().encode(maxPrice),
    typo.runtime.Fragment.lit("""
      )
        AND (""".trimMargin()),
    MariaTypes.text.opt().encode(status),
    typo.runtime.Fragment.lit(" IS NULL OR p.status = "),
    MariaTypes.text.opt().encode(status),
    typo.runtime.Fragment.lit("""
      )
      ORDER BY p.name
      LIMIT """.trimMargin()),
    MariaTypes.bigint.encode(limit),
    typo.runtime.Fragment.lit("""


    """.trimMargin())
  ).query(ProductSearchSqlRow._rowParser.all()).runUnchecked(c)
}