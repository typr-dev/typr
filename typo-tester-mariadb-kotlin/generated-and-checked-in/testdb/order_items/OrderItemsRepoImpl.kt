/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.order_items

import java.sql.Connection
import java.util.ArrayList
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableIterator
import kotlin.collections.MutableMap
import testdb.orders.OrdersId
import testdb.products.ProductsId
import testdb.warehouses.WarehousesId
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class OrderItemsRepoImpl() : OrderItemsRepo {
  override fun delete(): DeleteBuilder<OrderItemsFields, OrderItemsRow> = DeleteBuilder.of("`order_items`", OrderItemsFields.structure, Dialect.MARIADB)

  override fun deleteById(
    itemId: OrderItemsId,
    c: Connection
  ): Boolean = interpolate(
    typo.runtime.Fragment.lit("delete from `order_items` where `item_id` = "),
    OrderItemsId.pgType.encode(itemId),
    typo.runtime.Fragment.lit("")
  ).update().runUnchecked(c) > 0

  override fun deleteByIds(
    itemIds: Array<OrderItemsId>,
    c: Connection
  ): Int {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in itemIds) { fragments.add(OrderItemsId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `order_items` where `item_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override fun insert(
    unsaved: OrderItemsRow,
    c: Connection
  ): OrderItemsRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into `order_items`(`order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`)
      values (""".trimMargin()),
    OrdersId.pgType.encode(unsaved.orderId),
    typo.runtime.Fragment.lit(", "),
    ProductsId.pgType.encode(unsaved.productId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.sku),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.productName),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.int_.encode(unsaved.quantity),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.unitPrice),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.discountAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.taxAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.lineTotal),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.fulfillmentStatus),
    typo.runtime.Fragment.lit(", "),
    WarehousesId.pgType.opt().encode(unsaved.warehouseId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.notes),
    typo.runtime.Fragment.lit("""
      )
      returning `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`
    """.trimMargin())
  )
    .updateReturning(OrderItemsRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: OrderItemsRowUnsaved,
    c: Connection
  ): OrderItemsRow {
    val columns: ArrayList<Literal> = ArrayList<Literal>()
    val values: ArrayList<Fragment> = ArrayList<Fragment>()
    columns.add(Fragment.lit("`order_id`"))
    values.add(interpolate(
      OrdersId.pgType.encode(unsaved.orderId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`product_id`"))
    values.add(interpolate(
      ProductsId.pgType.encode(unsaved.productId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`sku`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.sku),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`product_name`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.productName),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`quantity`"))
    values.add(interpolate(
      MariaTypes.int_.encode(unsaved.quantity),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`unit_price`"))
    values.add(interpolate(
      MariaTypes.numeric.encode(unsaved.unitPrice),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`line_total`"))
    values.add(interpolate(
      MariaTypes.numeric.encode(unsaved.lineTotal),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    unsaved.discountAmount.visit(
      {  },
      { value -> columns.add(Fragment.lit("`discount_amount`"))
      values.add(interpolate(
        MariaTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.taxAmount.visit(
      {  },
      { value -> columns.add(Fragment.lit("`tax_amount`"))
      values.add(interpolate(
        MariaTypes.numeric.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.fulfillmentStatus.visit(
      {  },
      { value -> columns.add(Fragment.lit("`fulfillment_status`"))
      values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.warehouseId.visit(
      {  },
      { value -> columns.add(Fragment.lit("`warehouse_id`"))
      values.add(interpolate(
        WarehousesId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.notes.visit(
      {  },
      { value -> columns.add(Fragment.lit("`notes`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    val q: Fragment = interpolate(
      typo.runtime.Fragment.lit("insert into `order_items`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
        )
        values (""".trimMargin()),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
        )
        returning `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`
      """.trimMargin())
    )
    return q.updateReturning(OrderItemsRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<OrderItemsFields, OrderItemsRow> = SelectBuilder.of("`order_items`", OrderItemsFields.structure, OrderItemsRow._rowParser, Dialect.MARIADB)

  override fun selectAll(c: Connection): List<OrderItemsRow> = interpolate(typo.runtime.Fragment.lit("""
    select `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`
    from `order_items`
  """.trimMargin())).query(OrderItemsRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    itemId: OrderItemsId,
    c: Connection
  ): Optional<OrderItemsRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`
      from `order_items`
      where `item_id` = """.trimMargin()),
    OrderItemsId.pgType.encode(itemId),
    typo.runtime.Fragment.lit("")
  ).query(OrderItemsRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    itemIds: Array<OrderItemsId>,
    c: Connection
  ): List<OrderItemsRow> {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in itemIds) { fragments.add(OrderItemsId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes` from `order_items` where `item_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(OrderItemsRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    itemIds: Array<OrderItemsId>,
    c: Connection
  ): Map<OrderItemsId, OrderItemsRow> {
    val ret: MutableMap<OrderItemsId, OrderItemsRow> = mutableMapOf<OrderItemsId, OrderItemsRow>()
    selectByIds(itemIds, c).forEach({ row -> ret.put(row.itemId, row) })
    return ret
  }

  override fun update(): UpdateBuilder<OrderItemsFields, OrderItemsRow> = UpdateBuilder.of("`order_items`", OrderItemsFields.structure, OrderItemsRow._rowParser.all(), Dialect.MARIADB)

  override fun update(
    row: OrderItemsRow,
    c: Connection
  ): Boolean {
    val itemId: OrderItemsId = row.itemId
    return interpolate(
      typo.runtime.Fragment.lit("""
        update `order_items`
        set `order_id` = """.trimMargin()),
      OrdersId.pgType.encode(row.orderId),
      typo.runtime.Fragment.lit("""
        ,
        `product_id` = """.trimMargin()),
      ProductsId.pgType.encode(row.productId),
      typo.runtime.Fragment.lit("""
        ,
        `sku` = """.trimMargin()),
      MariaTypes.text.encode(row.sku),
      typo.runtime.Fragment.lit("""
        ,
        `product_name` = """.trimMargin()),
      MariaTypes.text.encode(row.productName),
      typo.runtime.Fragment.lit("""
        ,
        `quantity` = """.trimMargin()),
      MariaTypes.int_.encode(row.quantity),
      typo.runtime.Fragment.lit("""
        ,
        `unit_price` = """.trimMargin()),
      MariaTypes.numeric.encode(row.unitPrice),
      typo.runtime.Fragment.lit("""
        ,
        `discount_amount` = """.trimMargin()),
      MariaTypes.numeric.encode(row.discountAmount),
      typo.runtime.Fragment.lit("""
        ,
        `tax_amount` = """.trimMargin()),
      MariaTypes.numeric.encode(row.taxAmount),
      typo.runtime.Fragment.lit("""
        ,
        `line_total` = """.trimMargin()),
      MariaTypes.numeric.encode(row.lineTotal),
      typo.runtime.Fragment.lit("""
        ,
        `fulfillment_status` = """.trimMargin()),
      MariaTypes.text.encode(row.fulfillmentStatus),
      typo.runtime.Fragment.lit("""
        ,
        `warehouse_id` = """.trimMargin()),
      WarehousesId.pgType.opt().encode(row.warehouseId),
      typo.runtime.Fragment.lit("""
        ,
        `notes` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.notes),
      typo.runtime.Fragment.lit("""
  
        where `item_id` = """.trimMargin()),
      OrderItemsId.pgType.encode(itemId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0
  }

  override fun upsert(
    unsaved: OrderItemsRow,
    c: Connection
  ): OrderItemsRow = interpolate(
    typo.runtime.Fragment.lit("""
      INSERT INTO `order_items`(`order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`)
      VALUES (""".trimMargin()),
    OrdersId.pgType.encode(unsaved.orderId),
    typo.runtime.Fragment.lit(", "),
    ProductsId.pgType.encode(unsaved.productId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.sku),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.productName),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.int_.encode(unsaved.quantity),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.unitPrice),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.discountAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.taxAmount),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.lineTotal),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.fulfillmentStatus),
    typo.runtime.Fragment.lit(", "),
    WarehousesId.pgType.opt().encode(unsaved.warehouseId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.notes),
    typo.runtime.Fragment.lit("""
      )
      ON DUPLICATE KEY UPDATE `order_id` = VALUES(`order_id`),
      `product_id` = VALUES(`product_id`),
      `sku` = VALUES(`sku`),
      `product_name` = VALUES(`product_name`),
      `quantity` = VALUES(`quantity`),
      `unit_price` = VALUES(`unit_price`),
      `discount_amount` = VALUES(`discount_amount`),
      `tax_amount` = VALUES(`tax_amount`),
      `line_total` = VALUES(`line_total`),
      `fulfillment_status` = VALUES(`fulfillment_status`),
      `warehouse_id` = VALUES(`warehouse_id`),
      `notes` = VALUES(`notes`)
      RETURNING `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`""".trimMargin())
  )
    .updateReturning(OrderItemsRow._rowParser.exactlyOne())
    .runUnchecked(c)

  override fun upsertBatch(
    unsaved: MutableIterator<OrderItemsRow>,
    c: Connection
  ): List<OrderItemsRow> = interpolate(typo.runtime.Fragment.lit("""
                             INSERT INTO `order_items`(`item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`)
                             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                             ON DUPLICATE KEY UPDATE `order_id` = VALUES(`order_id`),
                             `product_id` = VALUES(`product_id`),
                             `sku` = VALUES(`sku`),
                             `product_name` = VALUES(`product_name`),
                             `quantity` = VALUES(`quantity`),
                             `unit_price` = VALUES(`unit_price`),
                             `discount_amount` = VALUES(`discount_amount`),
                             `tax_amount` = VALUES(`tax_amount`),
                             `line_total` = VALUES(`line_total`),
                             `fulfillment_status` = VALUES(`fulfillment_status`),
                             `warehouse_id` = VALUES(`warehouse_id`),
                             `notes` = VALUES(`notes`)
                             RETURNING `item_id`, `order_id`, `product_id`, `sku`, `product_name`, `quantity`, `unit_price`, `discount_amount`, `tax_amount`, `line_total`, `fulfillment_status`, `warehouse_id`, `notes`""".trimMargin()))
    .updateReturningEach(OrderItemsRow._rowParser, unsaved)
    .runUnchecked(c)
}