/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.shipments

import java.sql.Connection
import java.util.ArrayList
import java.util.Optional
import kotlin.collections.List
import kotlin.collections.Map
import kotlin.collections.MutableIterator
import kotlin.collections.MutableMap
import testdb.orders.OrdersId
import testdb.shipping_carriers.ShippingCarriersId
import testdb.warehouses.WarehousesId
import typo.dsl.DeleteBuilder
import typo.dsl.Dialect
import typo.dsl.SelectBuilder
import typo.dsl.UpdateBuilder
import typo.runtime.Fragment
import typo.runtime.Fragment.Literal
import typo.runtime.MariaTypes
import typo.runtime.Fragment.interpolate

class ShipmentsRepoImpl() : ShipmentsRepo {
  override fun delete(): DeleteBuilder<ShipmentsFields, ShipmentsRow> = DeleteBuilder.of("`shipments`", ShipmentsFields.structure, Dialect.MARIADB)

  override fun deleteById(
    shipmentId: ShipmentsId,
    c: Connection
  ): Boolean = interpolate(
    typo.runtime.Fragment.lit("delete from `shipments` where `shipment_id` = "),
    ShipmentsId.pgType.encode(shipmentId),
    typo.runtime.Fragment.lit("")
  ).update().runUnchecked(c) > 0

  override fun deleteByIds(
    shipmentIds: Array<ShipmentsId>,
    c: Connection
  ): Int {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in shipmentIds) { fragments.add(ShipmentsId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("delete from `shipments` where `shipment_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override fun insert(
    unsaved: ShipmentsRow,
    c: Connection
  ): ShipmentsRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into `shipments`(`order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`)
      values (""".trimMargin()),
    OrdersId.pgType.encode(unsaved.orderId),
    typo.runtime.Fragment.lit(", "),
    ShippingCarriersId.pgType.encode(unsaved.carrierId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.trackingNumber),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.shippingMethod),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.opt().encode(unsaved.weightKg),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.dimensionsJson),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.blob.opt().encode(unsaved.labelData),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.status),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.date.opt().encode(unsaved.estimatedDeliveryDate),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.actualDeliveryAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.shippingCost),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.opt().encode(unsaved.insuranceAmount),
    typo.runtime.Fragment.lit(", "),
    WarehousesId.pgType.opt().encode(unsaved.originWarehouseId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.shippedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.createdAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.updatedAt),
    typo.runtime.Fragment.lit("""
      )
      returning `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
    """.trimMargin())
  )
    .updateReturning(ShipmentsRow._rowParser.exactlyOne()).runUnchecked(c)

  override fun insert(
    unsaved: ShipmentsRowUnsaved,
    c: Connection
  ): ShipmentsRow {
    val columns: ArrayList<Literal> = ArrayList<Literal>()
    val values: ArrayList<Fragment> = ArrayList<Fragment>()
    columns.add(Fragment.lit("`order_id`"))
    values.add(interpolate(
      OrdersId.pgType.encode(unsaved.orderId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`carrier_id`"))
    values.add(interpolate(
      ShippingCarriersId.pgType.encode(unsaved.carrierId),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`shipping_method`"))
    values.add(interpolate(
      MariaTypes.text.encode(unsaved.shippingMethod),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    columns.add(Fragment.lit("`shipping_cost`"))
    values.add(interpolate(
      MariaTypes.numeric.encode(unsaved.shippingCost),
      typo.runtime.Fragment.lit("""
      """.trimMargin())
    ))
    unsaved.trackingNumber.visit(
      {  },
      { value -> columns.add(Fragment.lit("`tracking_number`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.weightKg.visit(
      {  },
      { value -> columns.add(Fragment.lit("`weight_kg`"))
      values.add(interpolate(
        MariaTypes.numeric.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.dimensionsJson.visit(
      {  },
      { value -> columns.add(Fragment.lit("`dimensions_json`"))
      values.add(interpolate(
        MariaTypes.text.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.labelData.visit(
      {  },
      { value -> columns.add(Fragment.lit("`label_data`"))
      values.add(interpolate(
        MariaTypes.blob.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.status.visit(
      {  },
      { value -> columns.add(Fragment.lit("`status`"))
      values.add(interpolate(
        MariaTypes.text.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.estimatedDeliveryDate.visit(
      {  },
      { value -> columns.add(Fragment.lit("`estimated_delivery_date`"))
      values.add(interpolate(
        MariaTypes.date.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.actualDeliveryAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`actual_delivery_at`"))
      values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.insuranceAmount.visit(
      {  },
      { value -> columns.add(Fragment.lit("`insurance_amount`"))
      values.add(interpolate(
        MariaTypes.numeric.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.originWarehouseId.visit(
      {  },
      { value -> columns.add(Fragment.lit("`origin_warehouse_id`"))
      values.add(interpolate(
        WarehousesId.pgType.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.shippedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`shipped_at`"))
      values.add(interpolate(
        MariaTypes.datetime.opt().encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.createdAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`created_at`"))
      values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    unsaved.updatedAt.visit(
      {  },
      { value -> columns.add(Fragment.lit("`updated_at`"))
      values.add(interpolate(
        MariaTypes.datetime.encode(value),
        typo.runtime.Fragment.lit("""
        """.trimMargin())
      )) }
    );
    val q: Fragment = interpolate(
      typo.runtime.Fragment.lit("insert into `shipments`("),
      Fragment.comma(columns),
      typo.runtime.Fragment.lit("""
        )
        values (""".trimMargin()),
      Fragment.comma(values),
      typo.runtime.Fragment.lit("""
        )
        returning `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
      """.trimMargin())
    )
    return q.updateReturning(ShipmentsRow._rowParser.exactlyOne()).runUnchecked(c)
  }

  override fun select(): SelectBuilder<ShipmentsFields, ShipmentsRow> = SelectBuilder.of("`shipments`", ShipmentsFields.structure, ShipmentsRow._rowParser, Dialect.MARIADB)

  override fun selectAll(c: Connection): List<ShipmentsRow> = interpolate(typo.runtime.Fragment.lit("""
    select `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
    from `shipments`
  """.trimMargin())).query(ShipmentsRow._rowParser.all()).runUnchecked(c)

  override fun selectById(
    shipmentId: ShipmentsId,
    c: Connection
  ): Optional<ShipmentsRow> = interpolate(
    typo.runtime.Fragment.lit("""
      select `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`
      from `shipments`
      where `shipment_id` = """.trimMargin()),
    ShipmentsId.pgType.encode(shipmentId),
    typo.runtime.Fragment.lit("")
  ).query(ShipmentsRow._rowParser.first()).runUnchecked(c)

  override fun selectByIds(
    shipmentIds: Array<ShipmentsId>,
    c: Connection
  ): List<ShipmentsRow> {
    val fragments: ArrayList<Fragment> = ArrayList<Fragment>()
    for (id in shipmentIds) { fragments.add(ShipmentsId.pgType.encode(id)) }
    return Fragment.interpolate(Fragment.lit("select `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at` from `shipments` where `shipment_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(ShipmentsRow._rowParser.all()).runUnchecked(c)
  }

  override fun selectByIdsTracked(
    shipmentIds: Array<ShipmentsId>,
    c: Connection
  ): Map<ShipmentsId, ShipmentsRow> {
    val ret: MutableMap<ShipmentsId, ShipmentsRow> = mutableMapOf<ShipmentsId, ShipmentsRow>()
    selectByIds(shipmentIds, c).forEach({ row -> ret.put(row.shipmentId, row) })
    return ret
  }

  override fun update(): UpdateBuilder<ShipmentsFields, ShipmentsRow> = UpdateBuilder.of("`shipments`", ShipmentsFields.structure, ShipmentsRow._rowParser.all(), Dialect.MARIADB)

  override fun update(
    row: ShipmentsRow,
    c: Connection
  ): Boolean {
    val shipmentId: ShipmentsId = row.shipmentId
    return interpolate(
      typo.runtime.Fragment.lit("""
        update `shipments`
        set `order_id` = """.trimMargin()),
      OrdersId.pgType.encode(row.orderId),
      typo.runtime.Fragment.lit("""
        ,
        `carrier_id` = """.trimMargin()),
      ShippingCarriersId.pgType.encode(row.carrierId),
      typo.runtime.Fragment.lit("""
        ,
        `tracking_number` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.trackingNumber),
      typo.runtime.Fragment.lit("""
        ,
        `shipping_method` = """.trimMargin()),
      MariaTypes.text.encode(row.shippingMethod),
      typo.runtime.Fragment.lit("""
        ,
        `weight_kg` = """.trimMargin()),
      MariaTypes.numeric.opt().encode(row.weightKg),
      typo.runtime.Fragment.lit("""
        ,
        `dimensions_json` = """.trimMargin()),
      MariaTypes.text.opt().encode(row.dimensionsJson),
      typo.runtime.Fragment.lit("""
        ,
        `label_data` = """.trimMargin()),
      MariaTypes.blob.opt().encode(row.labelData),
      typo.runtime.Fragment.lit("""
        ,
        `status` = """.trimMargin()),
      MariaTypes.text.encode(row.status),
      typo.runtime.Fragment.lit("""
        ,
        `estimated_delivery_date` = """.trimMargin()),
      MariaTypes.date.opt().encode(row.estimatedDeliveryDate),
      typo.runtime.Fragment.lit("""
        ,
        `actual_delivery_at` = """.trimMargin()),
      MariaTypes.datetime.opt().encode(row.actualDeliveryAt),
      typo.runtime.Fragment.lit("""
        ,
        `shipping_cost` = """.trimMargin()),
      MariaTypes.numeric.encode(row.shippingCost),
      typo.runtime.Fragment.lit("""
        ,
        `insurance_amount` = """.trimMargin()),
      MariaTypes.numeric.opt().encode(row.insuranceAmount),
      typo.runtime.Fragment.lit("""
        ,
        `origin_warehouse_id` = """.trimMargin()),
      WarehousesId.pgType.opt().encode(row.originWarehouseId),
      typo.runtime.Fragment.lit("""
        ,
        `shipped_at` = """.trimMargin()),
      MariaTypes.datetime.opt().encode(row.shippedAt),
      typo.runtime.Fragment.lit("""
        ,
        `created_at` = """.trimMargin()),
      MariaTypes.datetime.encode(row.createdAt),
      typo.runtime.Fragment.lit("""
        ,
        `updated_at` = """.trimMargin()),
      MariaTypes.datetime.encode(row.updatedAt),
      typo.runtime.Fragment.lit("""
  
        where `shipment_id` = """.trimMargin()),
      ShipmentsId.pgType.encode(shipmentId),
      typo.runtime.Fragment.lit("")
    ).update().runUnchecked(c) > 0
  }

  override fun upsert(
    unsaved: ShipmentsRow,
    c: Connection
  ): ShipmentsRow = interpolate(
    typo.runtime.Fragment.lit("""
      INSERT INTO `shipments`(`order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`)
      VALUES (""".trimMargin()),
    OrdersId.pgType.encode(unsaved.orderId),
    typo.runtime.Fragment.lit(", "),
    ShippingCarriersId.pgType.encode(unsaved.carrierId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.trackingNumber),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.shippingMethod),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.opt().encode(unsaved.weightKg),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.opt().encode(unsaved.dimensionsJson),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.blob.opt().encode(unsaved.labelData),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.text.encode(unsaved.status),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.date.opt().encode(unsaved.estimatedDeliveryDate),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.actualDeliveryAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.encode(unsaved.shippingCost),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.numeric.opt().encode(unsaved.insuranceAmount),
    typo.runtime.Fragment.lit(", "),
    WarehousesId.pgType.opt().encode(unsaved.originWarehouseId),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.opt().encode(unsaved.shippedAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.createdAt),
    typo.runtime.Fragment.lit(", "),
    MariaTypes.datetime.encode(unsaved.updatedAt),
    typo.runtime.Fragment.lit("""
      )
      ON DUPLICATE KEY UPDATE `order_id` = VALUES(`order_id`),
      `carrier_id` = VALUES(`carrier_id`),
      `tracking_number` = VALUES(`tracking_number`),
      `shipping_method` = VALUES(`shipping_method`),
      `weight_kg` = VALUES(`weight_kg`),
      `dimensions_json` = VALUES(`dimensions_json`),
      `label_data` = VALUES(`label_data`),
      `status` = VALUES(`status`),
      `estimated_delivery_date` = VALUES(`estimated_delivery_date`),
      `actual_delivery_at` = VALUES(`actual_delivery_at`),
      `shipping_cost` = VALUES(`shipping_cost`),
      `insurance_amount` = VALUES(`insurance_amount`),
      `origin_warehouse_id` = VALUES(`origin_warehouse_id`),
      `shipped_at` = VALUES(`shipped_at`),
      `created_at` = VALUES(`created_at`),
      `updated_at` = VALUES(`updated_at`)
      RETURNING `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`""".trimMargin())
  )
    .updateReturning(ShipmentsRow._rowParser.exactlyOne())
    .runUnchecked(c)

  override fun upsertBatch(
    unsaved: MutableIterator<ShipmentsRow>,
    c: Connection
  ): List<ShipmentsRow> = interpolate(typo.runtime.Fragment.lit("""
                            INSERT INTO `shipments`(`shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`)
                            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                            ON DUPLICATE KEY UPDATE `order_id` = VALUES(`order_id`),
                            `carrier_id` = VALUES(`carrier_id`),
                            `tracking_number` = VALUES(`tracking_number`),
                            `shipping_method` = VALUES(`shipping_method`),
                            `weight_kg` = VALUES(`weight_kg`),
                            `dimensions_json` = VALUES(`dimensions_json`),
                            `label_data` = VALUES(`label_data`),
                            `status` = VALUES(`status`),
                            `estimated_delivery_date` = VALUES(`estimated_delivery_date`),
                            `actual_delivery_at` = VALUES(`actual_delivery_at`),
                            `shipping_cost` = VALUES(`shipping_cost`),
                            `insurance_amount` = VALUES(`insurance_amount`),
                            `origin_warehouse_id` = VALUES(`origin_warehouse_id`),
                            `shipped_at` = VALUES(`shipped_at`),
                            `created_at` = VALUES(`created_at`),
                            `updated_at` = VALUES(`updated_at`)
                            RETURNING `shipment_id`, `order_id`, `carrier_id`, `tracking_number`, `shipping_method`, `weight_kg`, `dimensions_json`, `label_data`, `status`, `estimated_delivery_date`, `actual_delivery_at`, `shipping_cost`, `insurance_amount`, `origin_warehouse_id`, `shipped_at`, `created_at`, `updated_at`""".trimMargin()))
    .updateReturningEach(ShipmentsRow._rowParser, unsaved)
    .runUnchecked(c)
}