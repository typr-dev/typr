/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.warehouses

import java.sql.Connection
import scala.collection.mutable.ListBuffer
import typr.runtime.MariaTypes
import typr.scaladsl.DeleteBuilder
import typr.scaladsl.Dialect
import typr.scaladsl.Fragment
import typr.scaladsl.MariaTypeOps
import typr.scaladsl.ScalaDbTypes
import typr.scaladsl.SelectBuilder
import typr.scaladsl.UpdateBuilder
import typr.scaladsl.Fragment.sql

class WarehousesRepoImpl extends WarehousesRepo {
  override def delete: DeleteBuilder[WarehousesFields, WarehousesRow] = DeleteBuilder.of("`warehouses`", WarehousesFields.structure, Dialect.MARIADB)

  override def deleteById(warehouseId: WarehousesId)(using c: Connection): Boolean = sql"delete from `warehouses` where `warehouse_id` = ${Fragment.encode(WarehousesId.pgType, warehouseId)}".update().runUnchecked(c) > 0

  override def deleteByIds(warehouseIds: Array[WarehousesId])(using c: Connection): Int = {
    val fragments: ListBuffer[Fragment] = ListBuffer()
    warehouseIds.foreach { id => fragments.addOne(Fragment.encode(WarehousesId.pgType, id)): @scala.annotation.nowarn }
    return Fragment.interpolate(Fragment.lit("delete from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override def insert(unsaved: WarehousesRow)(using c: Connection): WarehousesRow = {
  sql"""insert into `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
    values (${Fragment.encode(MariaTypes.char_, unsaved.code)}, ${Fragment.encode(MariaTypes.varchar, unsaved.name)}, ${Fragment.encode(MariaTypes.varchar, unsaved.address)}, ${Fragment.encode(MariaTypes.point, unsaved.location)}, ${Fragment.encode(MariaTypes.polygon.nullable, unsaved.serviceArea)}, ${Fragment.encode(MariaTypes.varchar, unsaved.timezone)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, unsaved.isActive)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.contactEmail)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.contactPhone)})
    RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    """
    .updateReturning(WarehousesRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: WarehousesRowUnsaved)(using c: Connection): WarehousesRow = {
    val columns: ListBuffer[Fragment] = ListBuffer()
    val values: ListBuffer[Fragment] = ListBuffer()
    columns.addOne(Fragment.lit("`code`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(MariaTypes.char_, unsaved.code)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`name`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(MariaTypes.varchar, unsaved.name)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`address`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(MariaTypes.varchar, unsaved.address)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`location`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(MariaTypes.point, unsaved.location)}"): @scala.annotation.nowarn
    unsaved.serviceArea.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`service_area`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.polygon.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.timezone.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`timezone`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.varchar, value)}"): @scala.annotation.nowarn }
    );
    unsaved.isActive.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`is_active`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.bool, value)}"): @scala.annotation.nowarn }
    );
    unsaved.contactEmail.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`contact_email`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.varchar.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.contactPhone.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`contact_phone`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.varchar.nullable, value)}"): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      sql"""insert into `warehouses`(${Fragment.comma(columns)})
      values (${Fragment.comma(values)})
      RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
      """
    }
    return q.updateReturning(WarehousesRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[WarehousesFields, WarehousesRow] = SelectBuilder.of("`warehouses`", WarehousesFields.structure, WarehousesRow.`_rowParser`, Dialect.MARIADB)

  override def selectAll(using c: Connection): List[WarehousesRow] = {
    sql"""select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
    """.query(WarehousesRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(warehouseId: WarehousesId)(using c: Connection): Option[WarehousesRow] = {
    sql"""select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
    where `warehouse_id` = ${Fragment.encode(WarehousesId.pgType, warehouseId)}""".query(WarehousesRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(warehouseIds: Array[WarehousesId])(using c: Connection): List[WarehousesRow] = {
    val fragments: ListBuffer[Fragment] = ListBuffer()
    warehouseIds.foreach { id => fragments.addOne(Fragment.encode(WarehousesId.pgType, id)): @scala.annotation.nowarn }
    return Fragment.interpolate(Fragment.lit("select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone` from `warehouses` where `warehouse_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(WarehousesRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(warehouseIds: Array[WarehousesId])(using c: Connection): Map[WarehousesId, WarehousesRow] = {
    val ret: scala.collection.mutable.Map[WarehousesId, WarehousesRow] = scala.collection.mutable.Map.empty[WarehousesId, WarehousesRow]
    selectByIds(warehouseIds)(using c).foreach(row => ret.put(row.warehouseId, row): @scala.annotation.nowarn)
    return ret.toMap
  }

  override def selectByUniqueCode(code: String)(using c: Connection): Option[WarehousesRow] = {
    sql"""select `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`
    from `warehouses`
    where `code` = ${Fragment.encode(MariaTypes.char_, code)}
    """.query(WarehousesRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def update: UpdateBuilder[WarehousesFields, WarehousesRow] = UpdateBuilder.of("`warehouses`", WarehousesFields.structure, WarehousesRow.`_rowParser`, Dialect.MARIADB)

  override def update(row: WarehousesRow)(using c: Connection): Boolean = {
    val warehouseId: WarehousesId = row.warehouseId
    return sql"""update `warehouses`
    set `code` = ${Fragment.encode(MariaTypes.char_, row.code)},
    `name` = ${Fragment.encode(MariaTypes.varchar, row.name)},
    `address` = ${Fragment.encode(MariaTypes.varchar, row.address)},
    `location` = ${Fragment.encode(MariaTypes.point, row.location)},
    `service_area` = ${Fragment.encode(MariaTypes.polygon.nullable, row.serviceArea)},
    `timezone` = ${Fragment.encode(MariaTypes.varchar, row.timezone)},
    `is_active` = ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, row.isActive)},
    `contact_email` = ${Fragment.encode(MariaTypes.varchar.nullable, row.contactEmail)},
    `contact_phone` = ${Fragment.encode(MariaTypes.varchar.nullable, row.contactPhone)}
    where `warehouse_id` = ${Fragment.encode(WarehousesId.pgType, warehouseId)}""".update().runUnchecked(c) > 0
  }

  override def upsert(unsaved: WarehousesRow)(using c: Connection): WarehousesRow = {
  sql"""INSERT INTO `warehouses`(`code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
    VALUES (${Fragment.encode(MariaTypes.char_, unsaved.code)}, ${Fragment.encode(MariaTypes.varchar, unsaved.name)}, ${Fragment.encode(MariaTypes.varchar, unsaved.address)}, ${Fragment.encode(MariaTypes.point, unsaved.location)}, ${Fragment.encode(MariaTypes.polygon.nullable, unsaved.serviceArea)}, ${Fragment.encode(MariaTypes.varchar, unsaved.timezone)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, unsaved.isActive)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.contactEmail)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.contactPhone)})
    ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
    `name` = VALUES(`name`),
    `address` = VALUES(`address`),
    `location` = VALUES(`location`),
    `service_area` = VALUES(`service_area`),
    `timezone` = VALUES(`timezone`),
    `is_active` = VALUES(`is_active`),
    `contact_email` = VALUES(`contact_email`),
    `contact_phone` = VALUES(`contact_phone`)
    RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`"""
    .updateReturning(WarehousesRow.`_rowParser`.exactlyOne())
    .runUnchecked(c)
  }

  override def upsertBatch(unsaved: Iterator[WarehousesRow])(using c: Connection): List[WarehousesRow] = {
    sql"""INSERT INTO `warehouses`(`warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ON DUPLICATE KEY UPDATE `code` = VALUES(`code`),
    `name` = VALUES(`name`),
    `address` = VALUES(`address`),
    `location` = VALUES(`location`),
    `service_area` = VALUES(`service_area`),
    `timezone` = VALUES(`timezone`),
    `is_active` = VALUES(`is_active`),
    `contact_email` = VALUES(`contact_email`),
    `contact_phone` = VALUES(`contact_phone`)
    RETURNING `warehouse_id`, `code`, `name`, `address`, `location`, `service_area`, `timezone`, `is_active`, `contact_email`, `contact_phone`"""
      .updateReturningEach(WarehousesRow.`_rowParser`, unsaved)
    .runUnchecked(c)
  }
}