/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.orders

import java.sql.Connection
import scala.collection.mutable.ListBuffer
import testdb.customer_addresses.CustomerAddressesId
import testdb.customers.CustomersId
import testdb.promotions.PromotionsId
import typr.runtime.MariaTypes
import typr.scaladsl.DeleteBuilder
import typr.scaladsl.Dialect
import typr.scaladsl.Fragment
import typr.scaladsl.MariaTypeOps
import typr.scaladsl.ScalaDbTypes
import typr.scaladsl.SelectBuilder
import typr.scaladsl.UpdateBuilder
import typr.scaladsl.Fragment.sql

class OrdersRepoImpl extends OrdersRepo {
  override def delete: DeleteBuilder[OrdersFields, OrdersRow] = DeleteBuilder.of("`orders`", OrdersFields.structure, Dialect.MARIADB)

  override def deleteById(orderId: OrdersId)(using c: Connection): Boolean = sql"delete from `orders` where `order_id` = ${Fragment.encode(OrdersId.pgType, orderId)}".update().runUnchecked(c) > 0

  override def deleteByIds(orderIds: Array[OrdersId])(using c: Connection): Int = {
    val fragments: ListBuffer[Fragment] = ListBuffer()
    orderIds.foreach { id => fragments.addOne(Fragment.encode(OrdersId.pgType, id)): @scala.annotation.nowarn }
    return Fragment.interpolate(Fragment.lit("delete from `orders` where `order_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override def insert(unsaved: OrdersRow)(using c: Connection): OrdersRow = {
  sql"""insert into `orders`(`order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
    values (${Fragment.encode(MariaTypes.varchar, unsaved.orderNumber)}, ${Fragment.encode(CustomersId.pgType, unsaved.customerId)}, ${Fragment.encode(MariaTypes.text, unsaved.orderStatus)}, ${Fragment.encode(MariaTypes.text, unsaved.paymentStatus)}, ${Fragment.encode(CustomerAddressesId.pgType.nullable, unsaved.shippingAddressId)}, ${Fragment.encode(CustomerAddressesId.pgType.nullable, unsaved.billingAddressId)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.subtotal)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.shippingCost)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.taxAmount)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.discountAmount)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.totalAmount)}, ${Fragment.encode(MariaTypes.char_, unsaved.currencyCode)}, ${Fragment.encode(PromotionsId.pgType.nullable, unsaved.promotionId)}, ${Fragment.encode(MariaTypes.text.nullable, unsaved.notes)}, ${Fragment.encode(MariaTypes.mediumtext.nullable, unsaved.internalNotes)}, ${Fragment.encode(MariaTypes.inet6.nullable, unsaved.ipAddress)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.userAgent)}, ${Fragment.encode(MariaTypes.datetime, unsaved.orderedAt)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.confirmedAt)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.shippedAt)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.deliveredAt)})
    RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    """
    .updateReturning(OrdersRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: OrdersRowUnsaved)(using c: Connection): OrdersRow = {
    val columns: ListBuffer[Fragment] = ListBuffer()
    val values: ListBuffer[Fragment] = ListBuffer()
    columns.addOne(Fragment.lit("`order_number`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(MariaTypes.varchar, unsaved.orderNumber)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`customer_id`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(CustomersId.pgType, unsaved.customerId)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`subtotal`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.subtotal)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`total_amount`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.totalAmount)}"): @scala.annotation.nowarn
    unsaved.orderStatus.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`order_status`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.text, value)}"): @scala.annotation.nowarn }
    );
    unsaved.paymentStatus.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`payment_status`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.text, value)}"): @scala.annotation.nowarn }
    );
    unsaved.shippingAddressId.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`shipping_address_id`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(CustomerAddressesId.pgType.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.billingAddressId.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`billing_address_id`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(CustomerAddressesId.pgType.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.shippingCost.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`shipping_cost`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, value)}"): @scala.annotation.nowarn }
    );
    unsaved.taxAmount.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`tax_amount`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, value)}"): @scala.annotation.nowarn }
    );
    unsaved.discountAmount.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`discount_amount`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, value)}"): @scala.annotation.nowarn }
    );
    unsaved.currencyCode.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`currency_code`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.char_, value)}"): @scala.annotation.nowarn }
    );
    unsaved.promotionId.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`promotion_id`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(PromotionsId.pgType.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.notes.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`notes`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.text.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.internalNotes.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`internal_notes`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.mediumtext.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.ipAddress.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`ip_address`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.inet6.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.userAgent.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`user_agent`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.varchar.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.orderedAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`ordered_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime, value)}"): @scala.annotation.nowarn }
    );
    unsaved.confirmedAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`confirmed_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.shippedAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`shipped_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.deliveredAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`delivered_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime.nullable, value)}"): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      sql"""insert into `orders`(${Fragment.comma(columns)})
      values (${Fragment.comma(values)})
      RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
      """
    }
    return q.updateReturning(OrdersRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[OrdersFields, OrdersRow] = SelectBuilder.of("`orders`", OrdersFields.structure, OrdersRow.`_rowParser`, Dialect.MARIADB)

  override def selectAll(using c: Connection): List[OrdersRow] = {
    sql"""select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
    """.query(OrdersRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(orderId: OrdersId)(using c: Connection): Option[OrdersRow] = {
    sql"""select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
    where `order_id` = ${Fragment.encode(OrdersId.pgType, orderId)}""".query(OrdersRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(orderIds: Array[OrdersId])(using c: Connection): List[OrdersRow] = {
    val fragments: ListBuffer[Fragment] = ListBuffer()
    orderIds.foreach { id => fragments.addOne(Fragment.encode(OrdersId.pgType, id)): @scala.annotation.nowarn }
    return Fragment.interpolate(Fragment.lit("select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at` from `orders` where `order_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(OrdersRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(orderIds: Array[OrdersId])(using c: Connection): Map[OrdersId, OrdersRow] = {
    val ret: scala.collection.mutable.Map[OrdersId, OrdersRow] = scala.collection.mutable.Map.empty[OrdersId, OrdersRow]
    selectByIds(orderIds)(using c).foreach(row => ret.put(row.orderId, row): @scala.annotation.nowarn)
    return ret.toMap
  }

  override def selectByUniqueOrderNumber(orderNumber: String)(using c: Connection): Option[OrdersRow] = {
    sql"""select `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`
    from `orders`
    where `order_number` = ${Fragment.encode(MariaTypes.varchar, orderNumber)}
    """.query(OrdersRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def update: UpdateBuilder[OrdersFields, OrdersRow] = UpdateBuilder.of("`orders`", OrdersFields.structure, OrdersRow.`_rowParser`, Dialect.MARIADB)

  override def update(row: OrdersRow)(using c: Connection): Boolean = {
    val orderId: OrdersId = row.orderId
    return sql"""update `orders`
    set `order_number` = ${Fragment.encode(MariaTypes.varchar, row.orderNumber)},
    `customer_id` = ${Fragment.encode(CustomersId.pgType, row.customerId)},
    `order_status` = ${Fragment.encode(MariaTypes.text, row.orderStatus)},
    `payment_status` = ${Fragment.encode(MariaTypes.text, row.paymentStatus)},
    `shipping_address_id` = ${Fragment.encode(CustomerAddressesId.pgType.nullable, row.shippingAddressId)},
    `billing_address_id` = ${Fragment.encode(CustomerAddressesId.pgType.nullable, row.billingAddressId)},
    `subtotal` = ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, row.subtotal)},
    `shipping_cost` = ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, row.shippingCost)},
    `tax_amount` = ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, row.taxAmount)},
    `discount_amount` = ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, row.discountAmount)},
    `total_amount` = ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, row.totalAmount)},
    `currency_code` = ${Fragment.encode(MariaTypes.char_, row.currencyCode)},
    `promotion_id` = ${Fragment.encode(PromotionsId.pgType.nullable, row.promotionId)},
    `notes` = ${Fragment.encode(MariaTypes.text.nullable, row.notes)},
    `internal_notes` = ${Fragment.encode(MariaTypes.mediumtext.nullable, row.internalNotes)},
    `ip_address` = ${Fragment.encode(MariaTypes.inet6.nullable, row.ipAddress)},
    `user_agent` = ${Fragment.encode(MariaTypes.varchar.nullable, row.userAgent)},
    `ordered_at` = ${Fragment.encode(MariaTypes.datetime, row.orderedAt)},
    `confirmed_at` = ${Fragment.encode(MariaTypes.datetime.nullable, row.confirmedAt)},
    `shipped_at` = ${Fragment.encode(MariaTypes.datetime.nullable, row.shippedAt)},
    `delivered_at` = ${Fragment.encode(MariaTypes.datetime.nullable, row.deliveredAt)}
    where `order_id` = ${Fragment.encode(OrdersId.pgType, orderId)}""".update().runUnchecked(c) > 0
  }

  override def upsert(unsaved: OrdersRow)(using c: Connection): OrdersRow = {
  sql"""INSERT INTO `orders`(`order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
    VALUES (${Fragment.encode(MariaTypes.varchar, unsaved.orderNumber)}, ${Fragment.encode(CustomersId.pgType, unsaved.customerId)}, ${Fragment.encode(MariaTypes.text, unsaved.orderStatus)}, ${Fragment.encode(MariaTypes.text, unsaved.paymentStatus)}, ${Fragment.encode(CustomerAddressesId.pgType.nullable, unsaved.shippingAddressId)}, ${Fragment.encode(CustomerAddressesId.pgType.nullable, unsaved.billingAddressId)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.subtotal)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.shippingCost)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.taxAmount)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.discountAmount)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.numeric, unsaved.totalAmount)}, ${Fragment.encode(MariaTypes.char_, unsaved.currencyCode)}, ${Fragment.encode(PromotionsId.pgType.nullable, unsaved.promotionId)}, ${Fragment.encode(MariaTypes.text.nullable, unsaved.notes)}, ${Fragment.encode(MariaTypes.mediumtext.nullable, unsaved.internalNotes)}, ${Fragment.encode(MariaTypes.inet6.nullable, unsaved.ipAddress)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.userAgent)}, ${Fragment.encode(MariaTypes.datetime, unsaved.orderedAt)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.confirmedAt)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.shippedAt)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.deliveredAt)})
    ON DUPLICATE KEY UPDATE `order_number` = VALUES(`order_number`),
    `customer_id` = VALUES(`customer_id`),
    `order_status` = VALUES(`order_status`),
    `payment_status` = VALUES(`payment_status`),
    `shipping_address_id` = VALUES(`shipping_address_id`),
    `billing_address_id` = VALUES(`billing_address_id`),
    `subtotal` = VALUES(`subtotal`),
    `shipping_cost` = VALUES(`shipping_cost`),
    `tax_amount` = VALUES(`tax_amount`),
    `discount_amount` = VALUES(`discount_amount`),
    `total_amount` = VALUES(`total_amount`),
    `currency_code` = VALUES(`currency_code`),
    `promotion_id` = VALUES(`promotion_id`),
    `notes` = VALUES(`notes`),
    `internal_notes` = VALUES(`internal_notes`),
    `ip_address` = VALUES(`ip_address`),
    `user_agent` = VALUES(`user_agent`),
    `ordered_at` = VALUES(`ordered_at`),
    `confirmed_at` = VALUES(`confirmed_at`),
    `shipped_at` = VALUES(`shipped_at`),
    `delivered_at` = VALUES(`delivered_at`)
    RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`"""
    .updateReturning(OrdersRow.`_rowParser`.exactlyOne())
    .runUnchecked(c)
  }

  override def upsertBatch(unsaved: Iterator[OrdersRow])(using c: Connection): List[OrdersRow] = {
    sql"""INSERT INTO `orders`(`order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ON DUPLICATE KEY UPDATE `order_number` = VALUES(`order_number`),
    `customer_id` = VALUES(`customer_id`),
    `order_status` = VALUES(`order_status`),
    `payment_status` = VALUES(`payment_status`),
    `shipping_address_id` = VALUES(`shipping_address_id`),
    `billing_address_id` = VALUES(`billing_address_id`),
    `subtotal` = VALUES(`subtotal`),
    `shipping_cost` = VALUES(`shipping_cost`),
    `tax_amount` = VALUES(`tax_amount`),
    `discount_amount` = VALUES(`discount_amount`),
    `total_amount` = VALUES(`total_amount`),
    `currency_code` = VALUES(`currency_code`),
    `promotion_id` = VALUES(`promotion_id`),
    `notes` = VALUES(`notes`),
    `internal_notes` = VALUES(`internal_notes`),
    `ip_address` = VALUES(`ip_address`),
    `user_agent` = VALUES(`user_agent`),
    `ordered_at` = VALUES(`ordered_at`),
    `confirmed_at` = VALUES(`confirmed_at`),
    `shipped_at` = VALUES(`shipped_at`),
    `delivered_at` = VALUES(`delivered_at`)
    RETURNING `order_id`, `order_number`, `customer_id`, `order_status`, `payment_status`, `shipping_address_id`, `billing_address_id`, `subtotal`, `shipping_cost`, `tax_amount`, `discount_amount`, `total_amount`, `currency_code`, `promotion_id`, `notes`, `internal_notes`, `ip_address`, `user_agent`, `ordered_at`, `confirmed_at`, `shipped_at`, `delivered_at`"""
      .updateReturningEach(OrdersRow.`_rowParser`, unsaved)
    .runUnchecked(c)
  }
}