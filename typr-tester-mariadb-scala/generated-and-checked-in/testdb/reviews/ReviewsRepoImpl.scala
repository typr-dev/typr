/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package testdb.reviews

import java.sql.Connection
import scala.collection.mutable.ListBuffer
import testdb.customers.CustomersId
import testdb.order_items.OrderItemsId
import testdb.products.ProductsId
import typr.runtime.MariaTypes
import typr.scaladsl.DeleteBuilder
import typr.scaladsl.Dialect
import typr.scaladsl.Fragment
import typr.scaladsl.MariaTypeOps
import typr.scaladsl.ScalaDbTypes
import typr.scaladsl.SelectBuilder
import typr.scaladsl.UpdateBuilder
import typr.scaladsl.Fragment.sql

class ReviewsRepoImpl extends ReviewsRepo {
  override def delete: DeleteBuilder[ReviewsFields, ReviewsRow] = DeleteBuilder.of("`reviews`", ReviewsFields.structure, Dialect.MARIADB)

  override def deleteById(reviewId: ReviewsId)(using c: Connection): Boolean = sql"delete from `reviews` where `review_id` = ${Fragment.encode(ReviewsId.pgType, reviewId)}".update().runUnchecked(c) > 0

  override def deleteByIds(reviewIds: Array[ReviewsId])(using c: Connection): Int = {
    val fragments: ListBuffer[Fragment] = ListBuffer()
    reviewIds.foreach { id => fragments.addOne(Fragment.encode(ReviewsId.pgType, id)): @scala.annotation.nowarn }
    return Fragment.interpolate(Fragment.lit("delete from `reviews` where `review_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).update().runUnchecked(c)
  }

  override def insert(unsaved: ReviewsRow)(using c: Connection): ReviewsRow = {
  sql"""insert into `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
    values (${Fragment.encode(ProductsId.pgType, unsaved.productId)}, ${Fragment.encode(CustomersId.pgType, unsaved.customerId)}, ${Fragment.encode(OrderItemsId.pgType.nullable, unsaved.orderItemId)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.tinyintUnsigned, unsaved.rating)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.title)}, ${Fragment.encode(MariaTypes.text.nullable, unsaved.content)}, ${Fragment.encode(MariaTypes.longtext.nullable, unsaved.pros)}, ${Fragment.encode(MariaTypes.longtext.nullable, unsaved.cons)}, ${Fragment.encode(MariaTypes.longtext.nullable, unsaved.images)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, unsaved.isVerifiedPurchase)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, unsaved.isApproved)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, unsaved.helpfulVotes)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, unsaved.unhelpfulVotes)}, ${Fragment.encode(MariaTypes.text.nullable, unsaved.adminResponse)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.respondedAt)}, ${Fragment.encode(MariaTypes.datetime, unsaved.createdAt)}, ${Fragment.encode(MariaTypes.datetime, unsaved.updatedAt)})
    RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
    """
    .updateReturning(ReviewsRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insert(unsaved: ReviewsRowUnsaved)(using c: Connection): ReviewsRow = {
    val columns: ListBuffer[Fragment] = ListBuffer()
    val values: ListBuffer[Fragment] = ListBuffer()
    columns.addOne(Fragment.lit("`product_id`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(ProductsId.pgType, unsaved.productId)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`customer_id`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(CustomersId.pgType, unsaved.customerId)}"): @scala.annotation.nowarn
    columns.addOne(Fragment.lit("`rating`")): @scala.annotation.nowarn
    values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.tinyintUnsigned, unsaved.rating)}"): @scala.annotation.nowarn
    unsaved.orderItemId.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`order_item_id`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(OrderItemsId.pgType.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.title.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`title`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.varchar.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.content.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`content`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.text.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.pros.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`pros`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.longtext.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.cons.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`cons`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.longtext.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.images.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`images`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.longtext.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.isVerifiedPurchase.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`is_verified_purchase`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.bool, value)}"): @scala.annotation.nowarn }
    );
    unsaved.isApproved.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`is_approved`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.bool, value)}"): @scala.annotation.nowarn }
    );
    unsaved.helpfulVotes.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`helpful_votes`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, value)}"): @scala.annotation.nowarn }
    );
    unsaved.unhelpfulVotes.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`unhelpful_votes`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, value)}"): @scala.annotation.nowarn }
    );
    unsaved.adminResponse.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`admin_response`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.text.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.respondedAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`responded_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime.nullable, value)}"): @scala.annotation.nowarn }
    );
    unsaved.createdAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`created_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime, value)}"): @scala.annotation.nowarn }
    );
    unsaved.updatedAt.visit(
      {  },
      value => { columns.addOne(Fragment.lit("`updated_at`")): @scala.annotation.nowarn; values.addOne(sql"${Fragment.encode(MariaTypes.datetime, value)}"): @scala.annotation.nowarn }
    );
    val q: Fragment = {
      sql"""insert into `reviews`(${Fragment.comma(columns)})
      values (${Fragment.comma(values)})
      RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
      """
    }
    return q.updateReturning(ReviewsRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def select: SelectBuilder[ReviewsFields, ReviewsRow] = SelectBuilder.of("`reviews`", ReviewsFields.structure, ReviewsRow.`_rowParser`, Dialect.MARIADB)

  override def selectAll(using c: Connection): List[ReviewsRow] = {
    sql"""select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
    from `reviews`
    """.query(ReviewsRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(reviewId: ReviewsId)(using c: Connection): Option[ReviewsRow] = {
    sql"""select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`
    from `reviews`
    where `review_id` = ${Fragment.encode(ReviewsId.pgType, reviewId)}""".query(ReviewsRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(reviewIds: Array[ReviewsId])(using c: Connection): List[ReviewsRow] = {
    val fragments: ListBuffer[Fragment] = ListBuffer()
    reviewIds.foreach { id => fragments.addOne(Fragment.encode(ReviewsId.pgType, id)): @scala.annotation.nowarn }
    return Fragment.interpolate(Fragment.lit("select `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at` from `reviews` where `review_id` in ("), Fragment.comma(fragments), Fragment.lit(")")).query(ReviewsRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(reviewIds: Array[ReviewsId])(using c: Connection): Map[ReviewsId, ReviewsRow] = {
    val ret: scala.collection.mutable.Map[ReviewsId, ReviewsRow] = scala.collection.mutable.Map.empty[ReviewsId, ReviewsRow]
    selectByIds(reviewIds)(using c).foreach(row => ret.put(row.reviewId, row): @scala.annotation.nowarn)
    return ret.toMap
  }

  override def update: UpdateBuilder[ReviewsFields, ReviewsRow] = UpdateBuilder.of("`reviews`", ReviewsFields.structure, ReviewsRow.`_rowParser`, Dialect.MARIADB)

  override def update(row: ReviewsRow)(using c: Connection): Boolean = {
    val reviewId: ReviewsId = row.reviewId
    return sql"""update `reviews`
    set `product_id` = ${Fragment.encode(ProductsId.pgType, row.productId)},
    `customer_id` = ${Fragment.encode(CustomersId.pgType, row.customerId)},
    `order_item_id` = ${Fragment.encode(OrderItemsId.pgType.nullable, row.orderItemId)},
    `rating` = ${Fragment.encode(ScalaDbTypes.MariaTypes.tinyintUnsigned, row.rating)},
    `title` = ${Fragment.encode(MariaTypes.varchar.nullable, row.title)},
    `content` = ${Fragment.encode(MariaTypes.text.nullable, row.content)},
    `pros` = ${Fragment.encode(MariaTypes.longtext.nullable, row.pros)},
    `cons` = ${Fragment.encode(MariaTypes.longtext.nullable, row.cons)},
    `images` = ${Fragment.encode(MariaTypes.longtext.nullable, row.images)},
    `is_verified_purchase` = ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, row.isVerifiedPurchase)},
    `is_approved` = ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, row.isApproved)},
    `helpful_votes` = ${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, row.helpfulVotes)},
    `unhelpful_votes` = ${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, row.unhelpfulVotes)},
    `admin_response` = ${Fragment.encode(MariaTypes.text.nullable, row.adminResponse)},
    `responded_at` = ${Fragment.encode(MariaTypes.datetime.nullable, row.respondedAt)},
    `created_at` = ${Fragment.encode(MariaTypes.datetime, row.createdAt)},
    `updated_at` = ${Fragment.encode(MariaTypes.datetime, row.updatedAt)}
    where `review_id` = ${Fragment.encode(ReviewsId.pgType, reviewId)}""".update().runUnchecked(c) > 0
  }

  override def upsert(unsaved: ReviewsRow)(using c: Connection): ReviewsRow = {
  sql"""INSERT INTO `reviews`(`product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
    VALUES (${Fragment.encode(ProductsId.pgType, unsaved.productId)}, ${Fragment.encode(CustomersId.pgType, unsaved.customerId)}, ${Fragment.encode(OrderItemsId.pgType.nullable, unsaved.orderItemId)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.tinyintUnsigned, unsaved.rating)}, ${Fragment.encode(MariaTypes.varchar.nullable, unsaved.title)}, ${Fragment.encode(MariaTypes.text.nullable, unsaved.content)}, ${Fragment.encode(MariaTypes.longtext.nullable, unsaved.pros)}, ${Fragment.encode(MariaTypes.longtext.nullable, unsaved.cons)}, ${Fragment.encode(MariaTypes.longtext.nullable, unsaved.images)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, unsaved.isVerifiedPurchase)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.bool, unsaved.isApproved)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, unsaved.helpfulVotes)}, ${Fragment.encode(ScalaDbTypes.MariaTypes.intUnsigned, unsaved.unhelpfulVotes)}, ${Fragment.encode(MariaTypes.text.nullable, unsaved.adminResponse)}, ${Fragment.encode(MariaTypes.datetime.nullable, unsaved.respondedAt)}, ${Fragment.encode(MariaTypes.datetime, unsaved.createdAt)}, ${Fragment.encode(MariaTypes.datetime, unsaved.updatedAt)})
    ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),
    `customer_id` = VALUES(`customer_id`),
    `order_item_id` = VALUES(`order_item_id`),
    `rating` = VALUES(`rating`),
    `title` = VALUES(`title`),
    `content` = VALUES(`content`),
    `pros` = VALUES(`pros`),
    `cons` = VALUES(`cons`),
    `images` = VALUES(`images`),
    `is_verified_purchase` = VALUES(`is_verified_purchase`),
    `is_approved` = VALUES(`is_approved`),
    `helpful_votes` = VALUES(`helpful_votes`),
    `unhelpful_votes` = VALUES(`unhelpful_votes`),
    `admin_response` = VALUES(`admin_response`),
    `responded_at` = VALUES(`responded_at`),
    `created_at` = VALUES(`created_at`),
    `updated_at` = VALUES(`updated_at`)
    RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`"""
    .updateReturning(ReviewsRow.`_rowParser`.exactlyOne())
    .runUnchecked(c)
  }

  override def upsertBatch(unsaved: Iterator[ReviewsRow])(using c: Connection): List[ReviewsRow] = {
    sql"""INSERT INTO `reviews`(`review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`)
    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    ON DUPLICATE KEY UPDATE `product_id` = VALUES(`product_id`),
    `customer_id` = VALUES(`customer_id`),
    `order_item_id` = VALUES(`order_item_id`),
    `rating` = VALUES(`rating`),
    `title` = VALUES(`title`),
    `content` = VALUES(`content`),
    `pros` = VALUES(`pros`),
    `cons` = VALUES(`cons`),
    `images` = VALUES(`images`),
    `is_verified_purchase` = VALUES(`is_verified_purchase`),
    `is_approved` = VALUES(`is_approved`),
    `helpful_votes` = VALUES(`helpful_votes`),
    `unhelpful_votes` = VALUES(`unhelpful_votes`),
    `admin_response` = VALUES(`admin_response`),
    `responded_at` = VALUES(`responded_at`),
    `created_at` = VALUES(`created_at`),
    `updated_at` = VALUES(`updated_at`)
    RETURNING `review_id`, `product_id`, `customer_id`, `order_item_id`, `rating`, `title`, `content`, `pros`, `cons`, `images`, `is_verified_purchase`, `is_approved`, `helpful_votes`, `unhelpful_votes`, `admin_response`, `responded_at`, `created_at`, `updated_at`"""
      .updateReturningEach(ReviewsRow.`_rowParser`, unsaved)
    .runUnchecked(c)
  }
}