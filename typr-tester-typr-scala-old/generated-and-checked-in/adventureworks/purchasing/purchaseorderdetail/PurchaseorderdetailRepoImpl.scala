/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId
import java.sql.Connection
import java.util.HashMap
import java.util.Optional
import typr.dsl.Dialect
import typr.dsl.SelectBuilder
import typr.runtime.Fragment
import typr.runtime.PgTypes
import typr.runtime.Fragment.interpolate

class PurchaseorderdetailRepoImpl extends PurchaseorderdetailRepo {
  override def select: SelectBuilder[PurchaseorderdetailFields, PurchaseorderdetailRow] = SelectBuilder.of(""""purchasing"."purchaseorderdetail"""", PurchaseorderdetailFields.structure, PurchaseorderdetailRow.`_rowParser`, Dialect.POSTGRESQL)

  override def selectAll(using c: Connection): java.util.List[PurchaseorderdetailRow] = {
    interpolate(Fragment.lit("""select "purchaseorderid", "purchaseorderdetailid", "duedate", "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"
    from "purchasing"."purchaseorderdetail"
    """)).query(PurchaseorderdetailRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectById(compositeId: PurchaseorderdetailId)(using c: Connection): Optional[PurchaseorderdetailRow] = {
    interpolate(Fragment.lit("""select "purchaseorderid", "purchaseorderdetailid", "duedate", "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"
    from "purchasing"."purchaseorderdetail"
    where "purchaseorderid" = """), Fragment.encode(PurchaseorderheaderId.pgType, compositeId.purchaseorderid), Fragment.lit(""" AND "purchaseorderdetailid" = """), Fragment.encode(PgTypes.int4, compositeId.purchaseorderdetailid), Fragment.lit("")).query(PurchaseorderdetailRow.`_rowParser`.first()).runUnchecked(c)
  }

  override def selectByIds(compositeIds: Array[PurchaseorderdetailId])(using c: Connection): java.util.List[PurchaseorderdetailRow] = {
    val purchaseorderid: Array[PurchaseorderheaderId] = compositeIds.map(_.purchaseorderid)
    val purchaseorderdetailid: Array[Integer] = compositeIds.map(_.purchaseorderdetailid)
    return interpolate(Fragment.lit("""select "purchaseorderid", "purchaseorderdetailid", "duedate", "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"
    from "purchasing"."purchaseorderdetail"
    where ("purchaseorderid", "purchaseorderdetailid")
    in (select * from unnest("""), Fragment.encode(PurchaseorderheaderId.pgTypeArray, purchaseorderid), Fragment.lit(", "), Fragment.encode(PgTypes.int4Array, purchaseorderdetailid), Fragment.lit("""))
    """)).query(PurchaseorderdetailRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def selectByIdsTracked(compositeIds: Array[PurchaseorderdetailId])(using c: Connection): java.util.Map[PurchaseorderdetailId, PurchaseorderdetailRow] = {
    val ret: HashMap[PurchaseorderdetailId, PurchaseorderdetailRow] = new HashMap[PurchaseorderdetailId, PurchaseorderdetailRow]()
    selectByIds(compositeIds)(using c).forEach(row => ret.put(row.compositeId, row): @scala.annotation.nowarn)
    return ret
  }
}