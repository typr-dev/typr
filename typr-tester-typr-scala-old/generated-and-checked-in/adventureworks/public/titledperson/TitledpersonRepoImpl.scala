/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.titledperson

import adventureworks.public.title.TitleId
import adventureworks.public.title_domain.TitleDomainId
import java.sql.Connection
import typr.dsl.DeleteBuilder
import typr.dsl.Dialect
import typr.dsl.SelectBuilder
import typr.dsl.UpdateBuilder
import typr.runtime.Fragment
import typr.runtime.PgTypes
import typr.runtime.streamingInsert
import typr.runtime.Fragment.interpolate

class TitledpersonRepoImpl extends TitledpersonRepo {
  override def delete: DeleteBuilder[TitledpersonFields, TitledpersonRow] = DeleteBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, Dialect.POSTGRESQL)

  override def insert(unsaved: TitledpersonRow)(using c: Connection): TitledpersonRow = {
  interpolate(Fragment.lit("""insert into "public"."titledperson"("title_short", "title", "name")
    values ("""), Fragment.encode(TitleDomainId.pgType, unsaved.titleShort), Fragment.lit("::text, "), Fragment.encode(TitleId.pgType, unsaved.title), Fragment.lit(", "), Fragment.encode(PgTypes.text, unsaved.name), Fragment.lit(""")
    RETURNING "title_short", "title", "name"
    """))
    .updateReturning(TitledpersonRow.`_rowParser`.exactlyOne()).runUnchecked(c)
  }

  override def insertStreaming(
    unsaved: java.util.Iterator[TitledpersonRow],
    batchSize: Integer = 10000
  )(using c: Connection): java.lang.Long = streamingInsert.insertUnchecked(s"""COPY "public"."titledperson"("title_short", "title", "name") FROM STDIN""", batchSize, unsaved, c, TitledpersonRow.pgText)

  override def select: SelectBuilder[TitledpersonFields, TitledpersonRow] = SelectBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.`_rowParser`, Dialect.POSTGRESQL)

  override def selectAll(using c: Connection): java.util.List[TitledpersonRow] = {
    interpolate(Fragment.lit("""select "title_short", "title", "name"
    from "public"."titledperson"
    """)).query(TitledpersonRow.`_rowParser`.all()).runUnchecked(c)
  }

  override def update: UpdateBuilder[TitledpersonFields, TitledpersonRow] = UpdateBuilder.of(""""public"."titledperson"""", TitledpersonFields.structure, TitledpersonRow.`_rowParser`, Dialect.POSTGRESQL)
}