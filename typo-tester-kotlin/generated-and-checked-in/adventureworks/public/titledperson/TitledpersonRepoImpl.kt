/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.public.titledperson

import adventureworks.public.title.TitleId
import adventureworks.public.title_domain.TitleDomainId
import java.sql.Connection
import java.util.Iterator
import kotlin.collections.List
import typo.runtime.PgTypes
import typo.runtime.streamingInsert
import typo.runtime.Fragment.interpolate
import typo.runtime.internal.stringInterpolator.str

data class TitledpersonRepoImpl() : TitledpersonRepo {
  fun insert(
    unsaved: TitledpersonRow,
    c: Connection
  ): TitledpersonRow = interpolate(
    typo.runtime.Fragment.lit("""
      insert into "public"."titledperson"("title_short", "title", "name")
      values (""".trimMargin()),
    TitleDomainId.pgType.encode(unsaved.titleShort),
    typo.runtime.Fragment.lit("::text, "),
    TitleId.pgType.encode(unsaved.title),
    typo.runtime.Fragment.lit(", "),
    PgTypes.text.encode(unsaved.name),
    typo.runtime.Fragment.lit("""
      )
      returning "title_short", "title", "name"
    """.trimMargin())
  )
    .updateReturning(TitledpersonRow._rowParser.exactlyOne()).runUnchecked(c)

  fun insertStreaming(
    unsaved: Iterator<TitledpersonRow>,
    batchSize: Int,
    c: Connection
  ): Long = streamingInsert.insertUnchecked(str("""
  COPY "public"."titledperson"("title_short", "title", "name") FROM STDIN
  """.trimMargin()), batchSize, unsaved, c, TitledpersonRow.pgText)

  fun selectAll(c: Connection): List<TitledpersonRow> = interpolate(typo.runtime.Fragment.lit("""
    select "title_short", "title", "name"
    from "public"."titledperson"
  """.trimMargin())).as(TitledpersonRow._rowParser.all()).runUnchecked(c)
}