/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package adventureworks.purchasing.purchaseorderdetail

import adventureworks.purchasing.purchaseorderheader.PurchaseorderheaderId
import java.sql.Connection
import java.util.HashMap
import kotlin.collections.List
import kotlin.collections.Map
import typo.runtime.PgTypes
import typo.runtime.internal.arrayMap
import typo.runtime.Fragment.interpolate

data class PurchaseorderdetailRepoImpl() : PurchaseorderdetailRepo {
  fun selectAll(c: Connection): List<PurchaseorderdetailRow> = interpolate(typo.runtime.Fragment.lit("""
    select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
    from "purchasing"."purchaseorderdetail"
  """.trimMargin())).as(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c)

  fun selectById(
    compositeId: PurchaseorderdetailId,
    c: Connection
  ): PurchaseorderdetailRow? = interpolate(
    typo.runtime.Fragment.lit("""
      select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
      from "purchasing"."purchaseorderdetail"
      where "purchaseorderid" = """.trimMargin()),
    PurchaseorderheaderId.pgType.encode(compositeId.purchaseorderid),
    typo.runtime.Fragment.lit("""
     AND "purchaseorderdetailid" = 
    """.trimMargin()),
    PgTypes.int4.encode(compositeId.purchaseorderdetailid),
    typo.runtime.Fragment.lit("")
  ).as(PurchaseorderdetailRow._rowParser.first()).runUnchecked(c)

  fun selectByIds(
    compositeIds: Array<PurchaseorderdetailId>,
    c: Connection
  ): List<PurchaseorderdetailRow> {
    val purchaseorderid: Array<PurchaseorderheaderId> = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderid, PurchaseorderheaderId::class.java)
      val purchaseorderdetailid: Array<Int> = arrayMap.map(compositeIds, PurchaseorderdetailId::purchaseorderdetailid, Int::class.java)
    return interpolate(
             typo.runtime.Fragment.lit("""
               select "purchaseorderid", "purchaseorderdetailid", "duedate"::text, "orderqty", "productid", "unitprice", "receivedqty", "rejectedqty", "modifieddate"::text
               from "purchasing"."purchaseorderdetail"
               where ("purchaseorderid", "purchaseorderdetailid")
               in (select unnest(""".trimMargin()),
             PurchaseorderheaderId.pgTypeArray.encode(purchaseorderid),
             typo.runtime.Fragment.lit("::int4[]), unnest("),
             PgTypes.int4Array.encode(purchaseorderdetailid),
             typo.runtime.Fragment.lit("""
             ::int4[]))

             """.trimMargin())
           ).as(PurchaseorderdetailRow._rowParser.all()).runUnchecked(c)
  }

  fun selectByIdsTracked(
    compositeIds: Array<PurchaseorderdetailId>,
    c: Connection
  ): Map<PurchaseorderdetailId, PurchaseorderdetailRow> {
    val ret: java.util.Map<PurchaseorderdetailId, PurchaseorderdetailRow> = HashMap()
      for (var row : selectByIds(compositeIds, c)) {
          ret.put(row.id(), row);
      }
    return ret
  }
}